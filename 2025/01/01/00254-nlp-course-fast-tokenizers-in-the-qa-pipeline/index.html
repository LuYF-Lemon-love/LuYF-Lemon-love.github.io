<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="00254 NLP Course - Fast tokenizers in the QA pipeline, NLP LLM DeepLearning LuYF-Lemon-love è‡ªç„¶è¯­è¨€å¤„ç† æ·±åº¦å­¦ä¹  å¤§è¯­è¨€æ¨¡å‹">
    <meta name="description" content="å‰è¨€æˆ‘ä»¬ç°åœ¨å°†æ·±å…¥é—®ç­”ç®¡é“ï¼Œçœ‹çœ‹å¦‚ä½•åˆ©ç”¨åç§»é‡ä»ä¸Šä¸‹æ–‡ä¸­æŠ“å–æ‰‹å¤´é—®é¢˜çš„ç­”æ¡ˆï¼Œå°±åƒæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­å¯¹åˆ†ç»„å®ä½“æ‰€åšçš„é‚£æ ·ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•å¤„ç†è¢«æˆªæ–­çš„éå¸¸é•¿çš„ä¸Šä¸‹æ–‡ã€‚å¦‚æœä½ å¯¹é—®ç­”ä»»åŠ¡ä¸æ„Ÿå…´è¶£ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€èŠ‚ã€‚
src link: https:">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>00254 NLP Course - Fast tokenizers in the QA pipeline | LuYF-Lemon-love ã® Blog</title>
    <link rel="icon" type="image/jpeg" href="https://cos.luyf-lemon-love.space/images/è‹è‹1.jpeg">
    
    <style>
        body{
            background-image: url(https://cos.luyf-lemon-love.space/images/016-%E6%8A%A5%E7%BA%B8%E5%A2%99%E9%BA%BB%E8%A1%A3%E5%AD%A6%E5%A7%90.jpg);
            background-repeat:no-repeat;
            background-size: 100% 100%;
            background-attachment:fixed;
        }
    </style>



    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <span class="logo-span">LuYF-Lemon-love ã® Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>é¦–é¡µ</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>å½’æ¡£</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>æ ‡ç­¾</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>åˆ†ç±»</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>å…³äº</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>å‹æƒ…é“¾æ¥</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>List</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/galleries">
          
          <i class="fas fa-image" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Image</span>
        </a>
      </li>
      
      <li>
        <a href="/verse">
          
          <i class="fas fa-comments" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Verse</span>
        </a>
      </li>
      
      <li>
        <a href="/bilibili">
          
          <i class="fas fa-video" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Bilibili</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="æœç´¢" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="æ·±è‰²/æµ…è‰²æ¨¡å¼" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <div class="logo-name">LuYF-Lemon-love ã® Blog</div>
        <div class="logo-desc">
            
            å¤©ä¹‹é“ï¼ŒæŸæœ‰ä½™è€Œè¡¥ä¸è¶³ï¼Œäººä¹‹é“åˆ™ä¸ç„¶ï¼ŒæŸä¸è¶³ä»¥å¥‰æœ‰ä½™ã€‚
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			é¦–é¡µ
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			å½’æ¡£
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			æ ‡ç­¾
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			åˆ†ç±»
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			å…³äº
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			å‹æƒ…é“¾æ¥
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			List
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/galleries " style="margin-left:75px">
				  
				   <i class="fa fas fa-image" style="position: absolute;left:50px" ></i>
			      
		          <span>Image</span>
                  </a>
                </li>
              
                <li>

                  <a href="/verse " style="margin-left:75px">
				  
				   <i class="fa fas fa-comments" style="position: absolute;left:50px" ></i>
			      
		          <span>Verse</span>
                  </a>
                </li>
              
                <li>

                  <a href="/bilibili " style="margin-left:75px">
				  
				   <i class="fa fas fa-video" style="position: absolute;left:50px" ></i>
			      
		          <span>Bilibili</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/yanfeng98/paper-is-all-you-need" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/yanfeng98/paper-is-all-you-need" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('è¯·è¾“å…¥è®¿é—®æœ¬æ–‡ç« çš„å¯†ç ')).toString(CryptoJS.enc.Hex)) {
                alert('å¯†ç é”™è¯¯ï¼Œå°†è¿”å›ä¸»é¡µï¼');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cos.luyf-lemon-love.space/images/055-%E8%8B%B1%E9%9B%84%E8%81%94%E7%9B%9FLOL-%E5%8F%8C%E5%9F%8E%E4%B9%8B%E6%88%982%E4%B8%8D%E6%9C%BD%E9%87%91%E5%85%8B%E4%B8%9D.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">00254 NLP Course - Fast tokenizers in the QA pipeline</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- æ–‡ç« å†…å®¹è¯¦æƒ… -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">
                                <span class="chip bg-color">æ·±åº¦å­¦ä¹ </span>
                            </a>
                        
                            <a href="/tags/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/">
                                <span class="chip bg-color">å¤§è¯­è¨€æ¨¡å‹</span>
                            </a>
                        
                            <a href="/tags/huggingface/">
                                <span class="chip bg-color">huggingface</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/" class="post-category">
                                å¤§è¯­è¨€æ¨¡å‹
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp;
                    2025-01-01
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>æ›´æ–°æ—¥æœŸ:&nbsp;&nbsp;
                    2025-01-11
                </div>
                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- æ˜¯å¦åŠ è½½ä½¿ç”¨è‡ªå¸¦çš„ prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        
        <!-- ä»£ç å—æŠ˜è¡Œ -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘ä»¬ç°åœ¨å°†æ·±å…¥é—®ç­”ç®¡é“ï¼Œçœ‹çœ‹å¦‚ä½•åˆ©ç”¨åç§»é‡ä»ä¸Šä¸‹æ–‡ä¸­æŠ“å–æ‰‹å¤´é—®é¢˜çš„ç­”æ¡ˆï¼Œå°±åƒæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­å¯¹åˆ†ç»„å®ä½“æ‰€åšçš„é‚£æ ·ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•å¤„ç†è¢«æˆªæ–­çš„éå¸¸é•¿çš„ä¸Šä¸‹æ–‡ã€‚å¦‚æœä½ å¯¹é—®ç­”ä»»åŠ¡ä¸æ„Ÿå…´è¶£ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€èŠ‚ã€‚</p>
<p>src link: <a href="https://huggingface.co/learn/nlp-course/chapter6/3b">https://huggingface.co/learn/nlp-course/chapter6/3b</a></p>
<p>Operating System: Ubuntu 22.04.4 LTS</p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><ol>
<li><a href="https://huggingface.co/learn/nlp-course/chapter6/3b">NLP Course - Fast tokenizers in the QA pipeline</a></li>
</ol>
<h2 id="ä½¿ç”¨é—®ç­”ç®¡é“"><a href="#ä½¿ç”¨é—®ç­”ç®¡é“" class="headerlink" title="ä½¿ç”¨é—®ç­”ç®¡é“"></a>ä½¿ç”¨é—®ç­”ç®¡é“</h2><p>æ­£å¦‚æˆ‘ä»¬åœ¨ç¬¬ä¸€ç« ä¸­çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ç§é—®ç­”æµç¨‹æ¥è·å–é—®é¢˜çš„ç­”æ¡ˆã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> transformers <span class="token keyword">import</span> pipeline

question_answerer <span class="token operator">=</span> pipeline<span class="token punctuation">(</span><span class="token string">"question-answering"</span><span class="token punctuation">)</span>
context <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
ğŸ¤— Transformers is backed by the three most popular deep learning libraries â€” Jax, PyTorch, and TensorFlow â€” with a seamless integration
between them. It's straightforward to train your models with one before loading them for inference with the other.
"""</span>
question <span class="token operator">=</span> <span class="token string">"Which deep learning libraries back ğŸ¤— Transformers?"</span>
question_answerer<span class="token punctuation">(</span>question<span class="token operator">=</span>question<span class="token punctuation">,</span> context<span class="token operator">=</span>context<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token string">'score'</span><span class="token punctuation">:</span> <span class="token number">0.97773</span><span class="token punctuation">,</span>
 <span class="token string">'start'</span><span class="token punctuation">:</span> <span class="token number">78</span><span class="token punctuation">,</span>
 <span class="token string">'end'</span><span class="token punctuation">:</span> <span class="token number">105</span><span class="token punctuation">,</span>
 <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">'Jax, PyTorch and TensorFlow'</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸å…¶ä»–ç®¡é“ä¸åŒï¼Œå®ƒä¸èƒ½æˆªæ–­å’Œåˆ†å‰²è¶…è¿‡æ¨¡å‹æ¥å—çš„æœ€å¤§é•¿åº¦çš„æ–‡æœ¬ï¼ˆå› æ­¤å¯èƒ½ä¼šé”™è¿‡æ–‡æ¡£æœ«å°¾çš„ä¿¡æ¯ï¼‰ï¼Œè¿™ä¸ªç®¡é“å¯ä»¥å¤„ç†éå¸¸é•¿çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”å³ä½¿ç­”æ¡ˆåœ¨æœ«å°¾ä¹Ÿä¼šè¿”å›é—®é¢˜çš„ç­”æ¡ˆã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">long_context <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
ğŸ¤— Transformers: State of the Art NLP

ğŸ¤— Transformers provides thousands of pretrained models to perform tasks on texts such as classification, information extraction,
question answering, summarization, translation, text generation and more in over 100 languages.
Its aim is to make cutting-edge NLP easier to use for everyone.

ğŸ¤— Transformers provides APIs to quickly download and use those pretrained models on a given text, fine-tune them on your own datasets and
then share them with the community on our model hub. At the same time, each python module defining an architecture is fully standalone and
can be modified to enable quick research experiments.

Why should I use transformers?

1. Easy-to-use state-of-the-art models:
  - High performance on NLU and NLG tasks.
  - Low barrier to entry for educators and practitioners.
  - Few user-facing abstractions with just three classes to learn.
  - A unified API for using all our pretrained models.
  - Lower compute costs, smaller carbon footprint:

2. Researchers can share trained models instead of always retraining.
  - Practitioners can reduce compute time and production costs.
  - Dozens of architectures with over 10,000 pretrained models, some in more than 100 languages.

3. Choose the right framework for every part of a model's lifetime:
  - Train state-of-the-art models in 3 lines of code.
  - Move a single model between TF2.0/PyTorch frameworks at will.
  - Seamlessly pick the right framework for training, evaluation and production.

4. Easily customize a model or an example to your needs:
  - We provide examples for each architecture to reproduce the results published by its original authors.
  - Model internals are exposed as consistently as possible.
  - Model files can be used independently of the library for quick experiments.

ğŸ¤— Transformers is backed by the three most popular deep learning libraries â€” Jax, PyTorch and TensorFlow â€” with a seamless integration
between them. It's straightforward to train your models with one before loading them for inference with the other.
"""</span>
question_answerer<span class="token punctuation">(</span>question<span class="token operator">=</span>question<span class="token punctuation">,</span> context<span class="token operator">=</span>long_context<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token string">'score'</span><span class="token punctuation">:</span> <span class="token number">0.97149</span><span class="token punctuation">,</span>
 <span class="token string">'start'</span><span class="token punctuation">:</span> <span class="token number">1892</span><span class="token punctuation">,</span>
 <span class="token string">'end'</span><span class="token punctuation">:</span> <span class="token number">1919</span><span class="token punctuation">,</span>
 <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">'Jax, PyTorch and TensorFlow'</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€åˆ‡çš„ï¼</p>
<h2 id="ä½¿ç”¨æ¨¡å‹è¿›è¡Œé—®ç­”"><a href="#ä½¿ç”¨æ¨¡å‹è¿›è¡Œé—®ç­”" class="headerlink" title="ä½¿ç”¨æ¨¡å‹è¿›è¡Œé—®ç­”"></a>ä½¿ç”¨æ¨¡å‹è¿›è¡Œé—®ç­”</h2><p>ä¸ä»»ä½•å…¶ä»–ç®¡é“ä¸€æ ·ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¹è¾“å…¥è¿›è¡Œåˆ†è¯ï¼Œç„¶åå°†å…¶å‘é€åˆ°æ¨¡å‹ä¸­ã€‚é—®ç­”ç®¡é“é»˜è®¤ä½¿ç”¨çš„æ£€æŸ¥ç‚¹æ˜¯ <a href="https://huggingface.co/distilbert-base-cased-distilled-squad">distilbert-base-cased-distilled-squad</a>ï¼ˆåç§°ä¸­çš„â€œsquadâ€æ¥è‡ªæ¨¡å‹å¾®è°ƒçš„æ•°æ®é›†ï¼›æˆ‘ä»¬å°†åœ¨ç¬¬7ç« ä¸­æ›´è¯¦ç»†åœ°è®¨è®ºSQuADæ•°æ®é›†ï¼‰ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> transformers <span class="token keyword">import</span> AutoTokenizer<span class="token punctuation">,</span> AutoModelForQuestionAnswering

model_checkpoint <span class="token operator">=</span> <span class="token string">"distilbert-base-cased-distilled-squad"</span>
tokenizer <span class="token operator">=</span> AutoTokenizer<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>model_checkpoint<span class="token punctuation">)</span>
model <span class="token operator">=</span> AutoModelForQuestionAnswering<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>model_checkpoint<span class="token punctuation">)</span>

inputs <span class="token operator">=</span> tokenizer<span class="token punctuation">(</span>question<span class="token punctuation">,</span> context<span class="token punctuation">,</span> return_tensors<span class="token operator">=</span><span class="token string">"pt"</span><span class="token punctuation">)</span>
outputs <span class="token operator">=</span> model<span class="token punctuation">(</span><span class="token operator">**</span>inputs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å°†é—®é¢˜å’Œä¸Šä¸‹æ–‡ä½œä¸ºä¸€å¯¹è¿›è¡Œåˆ†è¯ï¼Œé¦–å…ˆæ˜¯é—®é¢˜ã€‚</p>
<p><img src="https://cos.luyf-lemon-love.space/images/20250101225749.png"></p>
<p>é—®ç­”æ¨¡å‹çš„å·¥ä½œæ–¹å¼ä¸æˆ‘ä»¬è‡³ä»Šä¸ºæ­¢çœ‹åˆ°çš„æ¨¡å‹ç•¥æœ‰ä¸åŒã€‚ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œè¯¥æ¨¡å‹ç»è¿‡è®­ç»ƒèƒ½å¤Ÿé¢„æµ‹ç­”æ¡ˆå¼€å§‹ï¼ˆæ­¤å¤„ä¸º21ï¼‰å’Œç»“æŸï¼ˆæ­¤å¤„ä¸º24ï¼‰çš„æ ‡è®°çš„ç´¢å¼•ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™äº›æ¨¡å‹ä¸è¿”å›ä¸€ä¸ªå¼ é‡ï¼Œè€Œæ˜¯è¿”å›ä¸¤ä¸ªå¼ é‡ï¼šä¸€ä¸ªå¯¹åº”äºç­”æ¡ˆå¼€å§‹æ ‡è®°çš„logitsï¼Œå¦ä¸€ä¸ªå¯¹åº”äºç­”æ¡ˆç»“æŸæ ‡è®°çš„logitsã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªåŒ…å«66ä¸ªæ ‡è®°çš„è¾“å…¥ï¼Œå› æ­¤æˆ‘ä»¬å¾—åˆ°ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">start_logits <span class="token operator">=</span> outputs<span class="token punctuation">.</span>start_logits
end_logits <span class="token operator">=</span> outputs<span class="token punctuation">.</span>end_logits
<span class="token keyword">print</span><span class="token punctuation">(</span>start_logits<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> end_logits<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">)</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ä¸ºäº†å°†é‚£äº›logitsè½¬æ¢ä¸ºæ¦‚ç‡ï¼Œæˆ‘ä»¬å°†åº”ç”¨ä¸€ä¸ªsoftmaxå‡½æ•°â€”â€”ä½†åœ¨é‚£ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æˆ‘ä»¬å±è”½äº†ä¸å±äºä¸Šä¸‹æ–‡çš„ç´¢å¼•ã€‚æˆ‘ä»¬çš„è¾“å…¥æ˜¯[CLS]é—®é¢˜[SEP]ä¸Šä¸‹æ–‡[SEP]ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å±è”½é—®é¢˜ä¸­çš„æ ‡è®°ä»¥åŠ[SEP]æ ‡è®°ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å°†ä¿ç•™[CLS]æ ‡è®°ï¼Œå› ä¸ºæœ‰äº›æ¨¡å‹ç”¨å®ƒæ¥è¡¨ç¤ºç­”æ¡ˆä¸åœ¨ä¸Šä¸‹æ–‡ä¸­ã€‚</p>
<p>ç”±äºæˆ‘ä»¬éšåå°†åº”ç”¨softmaxï¼Œæˆ‘ä»¬åªéœ€è¦å°†æƒ³è¦å±è”½çš„logitsæ›¿æ¢ä¸ºä¸€ä¸ªå¤§çš„è´Ÿæ•°ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨-10000ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch

sequence_ids <span class="token operator">=</span> inputs<span class="token punctuation">.</span>sequence_ids<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Mask everything apart from the tokens of the context</span>
mask <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token operator">!=</span> <span class="token number">1</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> sequence_ids<span class="token punctuation">]</span>
<span class="token comment"># Unmask the [CLS] token</span>
mask<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
mask <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span>

start_logits<span class="token punctuation">[</span>mask<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10000</span>
end_logits<span class="token punctuation">[</span>mask<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç°åœ¨æˆ‘ä»¬å·²ç»æ­£ç¡®åœ°å±è”½äº†æˆ‘ä»¬ä¸æƒ³é¢„æµ‹çš„ä½ç½®å¯¹åº”çš„logitsï¼Œæˆ‘ä»¬å¯ä»¥åº”ç”¨softmaxäº†ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">start_probabilities <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>start_logits<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
end_probabilities <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>end_logits<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å–å¼€å§‹å’Œç»“æŸæ¦‚ç‡çš„argmaxâ€”â€”ä½†æˆ‘ä»¬å¯èƒ½ä¼šå¾—åˆ°ä¸€ä¸ªå¼€å§‹ç´¢å¼•å¤§äºç»“æŸç´¢å¼•çš„ç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é‡‡å–æ›´å¤šçš„é¢„é˜²æªæ–½ã€‚æˆ‘ä»¬å°†è®¡ç®—æ¯ä¸ªå¯èƒ½çš„start_indexå’Œend_indexçš„æ¦‚ç‡ï¼Œå…¶ä¸­start_index &lt;&#x3D; end_indexï¼Œç„¶åå–æ¦‚ç‡æœ€é«˜çš„(start_index, end_index)å…ƒç»„ã€‚</p>
<p>å‡è®¾äº‹ä»¶â€œThe answer starts at start_indexâ€ï¼ˆç­”æ¡ˆä»start_indexå¼€å§‹ï¼‰å’Œâ€œThe answer ends at end_indexâ€ï¼ˆç­”æ¡ˆåœ¨end_indexç»“æŸï¼‰æ˜¯ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆç­”æ¡ˆä»start_indexå¼€å§‹å¹¶åœ¨end_indexç»“æŸçš„æ¦‚ç‡æ˜¯ï¼š</p>
<p>$\mathrm{start_probabilities}[\mathrm{start_index}] \times \mathrm{end_probabilities}[\mathrm{end_index}]$</p>
<p>å› æ­¤ï¼Œä¸ºäº†è®¡ç®—æ‰€æœ‰å¾—åˆ†ï¼Œæˆ‘ä»¬åªéœ€è¦è®¡ç®—æ‰€æœ‰äº§å“çš„start_probabilities[start_index]Ã—end_probabilities[end_index]ï¼Œå…¶ä¸­start_index &lt;&#x3D; end_indexã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¡ç®—æ‰€æœ‰å¯èƒ½çš„äº§å“ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">scores <span class="token operator">=</span> start_probabilities<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">*</span> end_probabilities<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç„¶åï¼Œæˆ‘ä»¬å°†é€šè¿‡å°†å®ƒä»¬è®¾ç½®ä¸º0æ¥å±è”½start_index &gt; end_indexçš„å€¼ï¼ˆå…¶ä»–æ¦‚ç‡éƒ½æ˜¯æ­£æ•°ï¼‰ã€‚torch.triu()å‡½æ•°è¿”å›ä½œä¸ºå‚æ•°ä¼ é€’çš„2Då¼ é‡çš„ä¸Šä¸‰è§’éƒ¨åˆ†ï¼Œå› æ­¤å®ƒå°†ä¸ºæˆ‘ä»¬æ‰§è¡Œè¿™ç§å±è”½ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">scores <span class="token operator">=</span> torch<span class="token punctuation">.</span>triu<span class="token punctuation">(</span>scores<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç°åœ¨æˆ‘ä»¬åªéœ€è¦å¾—åˆ°æœ€å¤§å€¼çš„ç´¢å¼•ã€‚ç”±äºPyTorchå°†åœ¨æ‰å¹³åŒ–çš„å¼ é‡ä¸­è¿”å›ç´¢å¼•ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åœ°æ¿é™¤æ³•&#x2F;&#x2F;å’Œæ¨¡æ•°%è¿ç®—æ¥å¾—åˆ°start_indexå’Œend_indexï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">max_index <span class="token operator">=</span> scores<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
start_index <span class="token operator">=</span> max_index <span class="token operator">//</span> scores<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
end_index <span class="token operator">=</span> max_index <span class="token operator">%</span> scores<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>scores<span class="token punctuation">[</span>start_index<span class="token punctuation">,</span> end_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>æˆ‘ä»¬è¿˜æ²¡æœ‰å®Œå…¨å®Œæˆï¼Œä½†è‡³å°‘æˆ‘ä»¬å·²ç»æœ‰äº†ç­”æ¡ˆçš„æ­£ç¡®åˆ†æ•°ï¼ˆä½ å¯ä»¥é€šè¿‡å°†å…¶ä¸å‰ä¸€éƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªç»“æœè¿›è¡Œæ¯”è¾ƒæ¥æ£€æŸ¥ï¼‰ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">0.97773</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>âœï¸ å°è¯•ä¸€ä¸‹ï¼è®¡ç®—äº”ä¸ªæœ€å¯èƒ½çš„ç­”æ¡ˆçš„å¼€å§‹å’Œç»“æŸç´¢å¼•ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬æœ‰äº†ç­”æ¡ˆåœ¨ä»¤ç‰Œä¸­çš„å¼€å§‹ç´¢å¼•ï¼ˆstart_indexï¼‰å’Œç»“æŸç´¢å¼•ï¼ˆend_indexï¼‰ï¼Œç°åœ¨åªéœ€è¦å°†è¿™äº›ç´¢å¼•è½¬æ¢æˆä¸Šä¸‹æ–‡ä¸­çš„å­—ç¬¦ç´¢å¼•ã€‚è¿™æ—¶åç§»é‡å°±ä¼šéå¸¸æœ‰ç”¨ã€‚æˆ‘ä»¬å¯ä»¥è·å–è¿™äº›åç§»é‡ï¼Œå¹¶åƒåœ¨ä»¤ç‰Œåˆ†ç±»ä»»åŠ¡ä¸­é‚£æ ·ä½¿ç”¨å®ƒä»¬ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">inputs_with_offsets <span class="token operator">=</span> tokenizer<span class="token punctuation">(</span>question<span class="token punctuation">,</span> context<span class="token punctuation">,</span> return_offsets_mapping<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
offsets <span class="token operator">=</span> inputs_with_offsets<span class="token punctuation">[</span><span class="token string">"offset_mapping"</span><span class="token punctuation">]</span>

start_char<span class="token punctuation">,</span> _ <span class="token operator">=</span> offsets<span class="token punctuation">[</span>start_index<span class="token punctuation">]</span>
_<span class="token punctuation">,</span> end_char <span class="token operator">=</span> offsets<span class="token punctuation">[</span>end_index<span class="token punctuation">]</span>
answer <span class="token operator">=</span> context<span class="token punctuation">[</span>start_char<span class="token punctuation">:</span>end_char<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç°åœ¨æˆ‘ä»¬åªéœ€è¦æ ¼å¼åŒ–æ‰€æœ‰å†…å®¹ä»¥è·å¾—æˆ‘ä»¬çš„ç»“æœï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">result <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">"answer"</span><span class="token punctuation">:</span> answer<span class="token punctuation">,</span>
    <span class="token string">"start"</span><span class="token punctuation">:</span> start_char<span class="token punctuation">,</span>
    <span class="token string">"end"</span><span class="token punctuation">:</span> end_char<span class="token punctuation">,</span>
    <span class="token string">"score"</span><span class="token punctuation">:</span> scores<span class="token punctuation">[</span>start_index<span class="token punctuation">,</span> end_index<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">'Jax, PyTorch and TensorFlow'</span><span class="token punctuation">,</span>
 <span class="token string">'start'</span><span class="token punctuation">:</span> <span class="token number">78</span><span class="token punctuation">,</span>
 <span class="token string">'end'</span><span class="token punctuation">:</span> <span class="token number">105</span><span class="token punctuation">,</span>
 <span class="token string">'score'</span><span class="token punctuation">:</span> <span class="token number">0.97773</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¤ªå¥½äº†ï¼è¿™ä¸æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹ç›¸åŒï¼</p>
<blockquote>
<p>è¯•ä¸€è¯•ï¼ä½¿ç”¨ä½ ä¹‹å‰è®¡ç®—çš„æœ€ä½³å¾—åˆ†æ¥å±•ç¤ºæœ€å¯èƒ½çš„äº”ä¸ªç­”æ¡ˆã€‚ä¸ºäº†æ£€æŸ¥ä½ çš„ç»“æœï¼Œå›åˆ°ç¬¬ä¸€ä¸ªpipelineï¼Œå¹¶åœ¨è°ƒç”¨æ—¶ä¼ å…¥ top_k&#x3D;5ã€‚</p>
</blockquote>
<h2 id="å¤„ç†é•¿ä¸Šä¸‹æ–‡"><a href="#å¤„ç†é•¿ä¸Šä¸‹æ–‡" class="headerlink" title="å¤„ç†é•¿ä¸Šä¸‹æ–‡"></a>å¤„ç†é•¿ä¸Šä¸‹æ–‡</h2><p>å¦‚æœæˆ‘ä»¬å°è¯•å¯¹ä¹‹å‰ç”¨ä½œä¾‹å­çš„é•¿ä¸Šä¸‹æ–‡å’Œé—®é¢˜è¿›è¡Œåˆ†è¯ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°è¶…è¿‡é—®é¢˜å›ç­”æµç¨‹ä¸­ä½¿ç”¨çš„æœ€å¤§é•¿åº¦ï¼ˆ384ä¸ªä»¤ç‰Œï¼‰çš„ä»¤ç‰Œæ•°é‡ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">inputs <span class="token operator">=</span> tokenizer<span class="token punctuation">(</span>question<span class="token punctuation">,</span> long_context<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>inputs<span class="token punctuation">[</span><span class="token string">"input_ids"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">461</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†è¾“å…¥æˆªæ–­åˆ°è¿™ä¸ªæœ€å¤§é•¿åº¦ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å‡ ç§æ–¹æ³•æ¥åšè¿™ä»¶äº‹ï¼Œä½†æˆ‘ä»¬ä¸æƒ³æˆªæ–­é—®é¢˜ï¼Œåªæƒ³æˆªæ–­ä¸Šä¸‹æ–‡ã€‚ç”±äºä¸Šä¸‹æ–‡æ˜¯ç¬¬äºŒä¸ªå¥å­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨â€œonly_secondâ€æˆªæ–­ç­–ç•¥ã€‚ç„¶åå‡ºç°çš„é—®é¢˜æ˜¯ï¼Œé—®é¢˜çš„ç­”æ¡ˆå¯èƒ½ä¸åœ¨æˆªæ–­çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æŒ‘é€‰äº†ä¸€ä¸ªé—®é¢˜ï¼Œå…¶ç­”æ¡ˆä½äºä¸Šä¸‹æ–‡çš„æœ«å°¾ï¼Œå½“æˆ‘ä»¬æˆªæ–­å®ƒæ—¶ï¼Œè¿™ä¸ªç­”æ¡ˆå°±ä¸å­˜åœ¨äº†ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">inputs <span class="token operator">=</span> tokenizer<span class="token punctuation">(</span>question<span class="token punctuation">,</span> long_context<span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">384</span><span class="token punctuation">,</span> truncation<span class="token operator">=</span><span class="token string">"only_second"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tokenizer<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>inputs<span class="token punctuation">[</span><span class="token string">"input_ids"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""
[CLS] Which deep learning libraries back [UNK] Transformers? [SEP] [UNK] Transformers : State of the Art NLP

[UNK] Transformers provides thousands of pretrained models to perform tasks on texts such as classification, information extraction,
question answering, summarization, translation, text generation and more in over 100 languages.
Its aim is to make cutting-edge NLP easier to use for everyone.

[UNK] Transformers provides APIs to quickly download and use those pretrained models on a given text, fine-tune them on your own datasets and
then share them with the community on our model hub. At the same time, each python module defining an architecture is fully standalone and
can be modified to enable quick research experiments.

Why should I use transformers?

1. Easy-to-use state-of-the-art models:
  - High performance on NLU and NLG tasks.
  - Low barrier to entry for educators and practitioners.
  - Few user-facing abstractions with just three classes to learn.
  - A unified API for using all our pretrained models.
  - Lower compute costs, smaller carbon footprint:

2. Researchers can share trained models instead of always retraining.
  - Practitioners can reduce compute time and production costs.
  - Dozens of architectures with over 10,000 pretrained models, some in more than 100 languages.

3. Choose the right framework for every part of a model's lifetime:
  - Train state-of-the-art models in 3 lines of code.
  - Move a single model between TF2.0/PyTorch frameworks at will.
  - Seamlessly pick the right framework for training, evaluation and production.

4. Easily customize a model or an example to your needs:
  - We provide examples for each architecture to reproduce the results published by its original authors.
  - Model internal [SEP]
"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™æ„å‘³ç€æ¨¡å‹å°†éš¾ä»¥é€‰æ‹©æ­£ç¡®çš„ç­”æ¡ˆã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé—®é¢˜å›ç­”æµç¨‹å…è®¸æˆ‘ä»¬å°†ä¸Šä¸‹æ–‡åˆ†æˆæ›´å°çš„å—ï¼Œå¹¶æŒ‡å®šæœ€å¤§é•¿åº¦ã€‚ä¸ºäº†ç¡®ä¿æˆ‘ä»¬ä¸æ°å¥½åœ¨ä¸Šæ–‡é”™è¯¯çš„åœ°æ–¹åˆ†å‰²ï¼Œä½¿æ‰¾åˆ°ç­”æ¡ˆæˆä¸ºå¯èƒ½ï¼Œå®ƒè¿˜åœ¨å—ä¹‹é—´åŒ…å«ä¸€äº›é‡å ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ  return_overflowing_tokens&#x3D;True æ¥è®©åˆ†è¯å™¨ï¼ˆå¿«é€Ÿæˆ–æ…¢é€Ÿï¼‰ä¸ºæˆ‘ä»¬æ‰§è¡Œæ­¤æ“ä½œï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ stride å‚æ•°æŒ‡å®šæˆ‘ä»¬æƒ³è¦çš„é‡å ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ï¼Œä½¿ç”¨äº†è¾ƒçŸ­çš„å¥å­ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">sentence <span class="token operator">=</span> <span class="token string">"This sentence is not too long but we are going to split it anyway."</span>
inputs <span class="token operator">=</span> tokenizer<span class="token punctuation">(</span>
    sentence<span class="token punctuation">,</span> truncation<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> return_overflowing_tokens<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span>
<span class="token punctuation">)</span>

<span class="token keyword">for</span> ids <span class="token keyword">in</span> inputs<span class="token punctuation">[</span><span class="token string">"input_ids"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>tokenizer<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token string">'[CLS] This sentence is not [SEP]'</span>
<span class="token string">'[CLS] is not too long [SEP]'</span>
<span class="token string">'[CLS] too long but we [SEP]'</span>
<span class="token string">'[CLS] but we are going [SEP]'</span>
<span class="token string">'[CLS] are going to split [SEP]'</span>
<span class="token string">'[CLS] to split it anyway [SEP]'</span>
<span class="token string">'[CLS] it anyway. [SEP]'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œå¥å­å·²ç»è¢«åˆ†æˆå—ï¼Œä»¥ä¾¿ inputs[â€œinput_idsâ€] ä¸­çš„æ¯ä¸ªæ¡ç›®æœ€å¤šæœ‰ 6 ä¸ªä»¤ç‰Œï¼ˆæˆ‘ä»¬éœ€è¦æ·»åŠ å¡«å……ï¼Œä½¿æœ€åä¸€ä¸ªæ¡ç›®ä¸å…¶ä»–æ¡ç›®çš„å¤§å°ç›¸åŒï¼‰ï¼Œå¹¶ä¸”æ¯ä¸ªæ¡ç›®ä¹‹é—´æœ‰ 2 ä¸ªä»¤ç‰Œçš„é‡å ã€‚</p>
<p>è®©æˆ‘ä»¬æ›´ä»”ç»†åœ°çœ‹çœ‹åˆ†è¯çš„ç»“æœï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>inputs<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python">dict_keys<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'input_ids'</span><span class="token punctuation">,</span> <span class="token string">'attention_mask'</span><span class="token punctuation">,</span> <span class="token string">'overflow_to_sample_mapping'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œæˆ‘ä»¬å¾—åˆ°äº†è¾“å…¥ ID å’Œä¸€ä¸ªæ³¨æ„åŠ›æ©ç ã€‚æœ€åä¸€ä¸ªé”®ï¼Œoverflow_to_sample_mappingï¼Œæ˜¯ä¸€ä¸ªæ˜ å°„ï¼Œå‘Šè¯‰æˆ‘ä»¬æ¯ä¸ªç»“æœå¯¹åº”äºå“ªä¸ªå¥å­â€”â€”åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ 7 ä¸ªç»“æœï¼Œéƒ½æ¥è‡ªäºæˆ‘ä»¬ä¼ é€’ç»™åˆ†è¯å™¨çš„ï¼ˆå”¯ä¸€çš„ï¼‰å¥å­ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>inputs<span class="token punctuation">[</span><span class="token string">"overflow_to_sample_mapping"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>è¿™åœ¨å½“æˆ‘ä»¬ä¸€èµ·å¯¹å‡ ä¸ªå¥å­è¿›è¡Œåˆ†è¯æ—¶æ›´æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œåƒè¿™æ ·ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">sentences <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">"This sentence is not too long but we are going to split it anyway."</span><span class="token punctuation">,</span>
    <span class="token string">"This sentence is shorter but will still get split."</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
inputs <span class="token operator">=</span> tokenizer<span class="token punctuation">(</span>
    sentences<span class="token punctuation">,</span> truncation<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> return_overflowing_tokens<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span>
<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>inputs<span class="token punctuation">[</span><span class="token string">"overflow_to_sample_mapping"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¾—åˆ°æˆ‘ä»¬ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>è¿™æ„å‘³ç€ç¬¬ä¸€ä¸ªå¥å­åƒä¹‹å‰ä¸€æ ·è¢«åˆ†æˆ 7 ä¸ªå—ï¼Œæ¥ä¸‹æ¥çš„ 4 ä¸ªå—æ¥è‡ªç¬¬äºŒä¸ªå¥å­ã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„é•¿ä¸Šä¸‹æ–‡ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œé—®é¢˜å›ç­”æµç¨‹ä½¿ç”¨æœ€å¤§é•¿åº¦ 384ï¼Œä»¥åŠæ­¥é•¿ 128ï¼Œè¿™ä¸æ¨¡å‹çš„å¾®è°ƒæ–¹å¼ç›¸å¯¹åº”ï¼ˆä½ å¯ä»¥åœ¨è°ƒç”¨æµç¨‹æ—¶é€šè¿‡ä¼ é€’ max_seq_len å’Œ stride å‚æ•°æ¥è°ƒæ•´è¿™äº›å‚æ•°ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨åˆ†è¯æ—¶å°†ä½¿ç”¨è¿™äº›å‚æ•°ã€‚æˆ‘ä»¬è¿˜ä¼šæ·»åŠ å¡«å……ï¼ˆä»¥ä½¿æ ·æœ¬å…·æœ‰ç›¸åŒçš„é•¿åº¦ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ„å»ºå¼ é‡ï¼‰ï¼Œå¹¶è¯·æ±‚åç§»é‡ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">inputs <span class="token operator">=</span> tokenizer<span class="token punctuation">(</span>
    question<span class="token punctuation">,</span>
    long_context<span class="token punctuation">,</span>
    stride<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span>
    max_length<span class="token operator">=</span><span class="token number">384</span><span class="token punctuation">,</span>
    padding<span class="token operator">=</span><span class="token string">"longest"</span><span class="token punctuation">,</span>
    truncation<span class="token operator">=</span><span class="token string">"only_second"</span><span class="token punctuation">,</span>
    return_overflowing_tokens<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    return_offsets_mapping<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™äº›è¾“å…¥å°†åŒ…å«æ¨¡å‹æœŸæœ›çš„è¾“å…¥ ID å’Œæ³¨æ„åŠ›æ©ç ï¼Œä»¥åŠæˆ‘ä»¬åˆšæ‰è®¨è®ºçš„åç§»é‡å’Œ overflow_to_sample_mappingã€‚ç”±äºè¿™ä¸¤ä¸ªå‚æ•°ä¸æ˜¯æ¨¡å‹ä½¿ç”¨çš„å‚æ•°ï¼Œæˆ‘ä»¬å°†å®ƒä»¬ä»è¾“å…¥ä¸­åˆ é™¤ï¼ˆå¹¶ä¸”æˆ‘ä»¬ä¸å­˜å‚¨æ˜ å°„ï¼Œå› ä¸ºåœ¨è¿™é‡Œæ²¡æœ‰ç”¨å¤„ï¼‰ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸ºå¼ é‡ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">_ <span class="token operator">=</span> inputs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"overflow_to_sample_mapping"</span><span class="token punctuation">)</span>
offsets <span class="token operator">=</span> inputs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"offset_mapping"</span><span class="token punctuation">)</span>

inputs <span class="token operator">=</span> inputs<span class="token punctuation">.</span>convert_to_tensors<span class="token punctuation">(</span><span class="token string">"pt"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>inputs<span class="token punctuation">[</span><span class="token string">"input_ids"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æˆ‘ä»¬çš„é•¿ä¸Šä¸‹æ–‡è¢«åˆ†æˆäº†ä¸¤éƒ¨åˆ†ï¼Œè¿™æ„å‘³ç€åœ¨é€šè¿‡æ¨¡å‹å¤„ç†åï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸¤å¥—å¼€å§‹å’Œç»“æŸçš„ logitsï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">outputs <span class="token operator">=</span> model<span class="token punctuation">(</span><span class="token operator">**</span>inputs<span class="token punctuation">)</span>

start_logits <span class="token operator">=</span> outputs<span class="token punctuation">.</span>start_logits
end_logits <span class="token operator">=</span> outputs<span class="token punctuation">.</span>end_logits
<span class="token keyword">print</span><span class="token punctuation">(</span>start_logits<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> end_logits<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">]</span><span class="token punctuation">)</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>åƒä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨å¯¹ tokens å– softmax ä¹‹å‰ï¼Œé¦–å…ˆå±è”½æ‰ä¸å±äºä¸Šä¸‹æ–‡çš„ tokensã€‚æˆ‘ä»¬è¿˜å±è”½äº†æ‰€æœ‰çš„å¡«å…… tokensï¼ˆç”±æ³¨æ„åŠ›æ©ç æ ‡è®°ï¼‰ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">sequence_ids <span class="token operator">=</span> inputs<span class="token punctuation">.</span>sequence_ids<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Mask everything apart from the tokens of the context</span>
mask <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token operator">!=</span> <span class="token number">1</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> sequence_ids<span class="token punctuation">]</span>
<span class="token comment"># Unmask the [CLS] token</span>
mask<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token comment"># Mask all the [PAD] tokens</span>
mask <span class="token operator">=</span> torch<span class="token punctuation">.</span>logical_or<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>inputs<span class="token punctuation">[</span><span class="token string">"attention_mask"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

start_logits<span class="token punctuation">[</span>mask<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10000</span>
end_logits<span class="token punctuation">[</span>mask<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ softmax å°†æˆ‘ä»¬çš„ logits è½¬æ¢ä¸ºæ¦‚ç‡ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">start_probabilities <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>start_logits<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
end_probabilities <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>end_logits<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ä¸‹ä¸€æ­¥ä¸æˆ‘ä»¬å¯¹å°ä¸Šä¸‹æ–‡æ‰€åšçš„ç±»ä¼¼ï¼Œä½†æˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸¤ä¸ªå—ä¸­çš„æ¯ä¸€ä¸ªéƒ½é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚æˆ‘ä»¬ä¸ºæ‰€æœ‰å¯èƒ½çš„ç­”æ¡ˆè·¨åº¦åˆ†é…ä¸€ä¸ªåˆ†æ•°ï¼Œç„¶åé€‰æ‹©åˆ†æ•°æœ€é«˜çš„è·¨åº¦ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">candidates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> start_probs<span class="token punctuation">,</span> end_probs <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>start_probabilities<span class="token punctuation">,</span> end_probabilities<span class="token punctuation">)</span><span class="token punctuation">:</span>
    scores <span class="token operator">=</span> start_probs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">*</span> end_probs<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
    idx <span class="token operator">=</span> torch<span class="token punctuation">.</span>triu<span class="token punctuation">(</span>scores<span class="token punctuation">)</span><span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>

    start_idx <span class="token operator">=</span> idx <span class="token operator">//</span> scores<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    end_idx <span class="token operator">=</span> idx <span class="token operator">%</span> scores<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    score <span class="token operator">=</span> scores<span class="token punctuation">[</span>start_idx<span class="token punctuation">,</span> end_idx<span class="token punctuation">]</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
    candidates<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>start_idx<span class="token punctuation">,</span> end_idx<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>candidates<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">0.33867</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">173</span><span class="token punctuation">,</span> <span class="token number">184</span><span class="token punctuation">,</span> <span class="token number">0.97149</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>è¿™ä¸¤ä¸ªå€™é€‰ç­”æ¡ˆå¯¹åº”äºæ¨¡å‹èƒ½å¤Ÿåœ¨æ¯ä¸ªå—ä¸­æ‰¾åˆ°çš„æœ€ä½³ç­”æ¡ˆã€‚æ¨¡å‹æ›´æœ‰ä¿¡å¿ƒç¡®ä¿¡æ­£ç¡®ç­”æ¡ˆåœ¨ç¬¬äºŒéƒ¨åˆ†ï¼ˆè¿™æ˜¯ä¸€ä¸ªå¥½å…†å¤´ï¼ï¼‰ã€‚ç°åœ¨æˆ‘ä»¬åªéœ€è¦å°†è¿™ä¸¤ä¸ª token è·¨åº¦æ˜ å°„åˆ°ä¸Šä¸‹æ–‡ä¸­çš„å­—ç¬¦è·¨åº¦ï¼ˆæˆ‘ä»¬åªéœ€è¦æ˜ å°„ç¬¬äºŒä¸ªè·¨åº¦å°±èƒ½å¾—åˆ°ç­”æ¡ˆï¼Œä½†çœ‹çœ‹æ¨¡å‹åœ¨ç¬¬ä¸€å—ä¸­é€‰æ‹©äº†ä»€ä¹ˆä¹Ÿæ˜¯å¾ˆæœ‰è¶£çš„ï¼‰ã€‚</p>
<blockquote>
<p>âœï¸ è¯•ä¸€è¯•ï¼è°ƒæ•´ä¸Šé¢çš„ä»£ç ï¼Œä»¥è¿”å›äº”ä¸ªæœ€å¯èƒ½çš„ç­”æ¡ˆçš„åˆ†æ•°å’Œè·¨åº¦ï¼ˆæ€»å…±ï¼Œä¸æ˜¯æ¯ä¸ªå—çš„ï¼‰ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬ä¹‹å‰è·å–çš„åç§»é‡å®é™…ä¸Šæ˜¯ä¸€ä¸ªåç§»é‡åˆ—è¡¨ï¼Œæ¯ä¸ªæ–‡æœ¬å—éƒ½æœ‰ä¸€ä¸ªåˆ—è¡¨ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> candidate<span class="token punctuation">,</span> offset <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>candidates<span class="token punctuation">,</span> offsets<span class="token punctuation">)</span><span class="token punctuation">:</span>
    start_token<span class="token punctuation">,</span> end_token<span class="token punctuation">,</span> score <span class="token operator">=</span> candidate
    start_char<span class="token punctuation">,</span> _ <span class="token operator">=</span> offset<span class="token punctuation">[</span>start_token<span class="token punctuation">]</span>
    _<span class="token punctuation">,</span> end_char <span class="token operator">=</span> offset<span class="token punctuation">[</span>end_token<span class="token punctuation">]</span>
    answer <span class="token operator">=</span> long_context<span class="token punctuation">[</span>start_char<span class="token punctuation">:</span>end_char<span class="token punctuation">]</span>
    result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"answer"</span><span class="token punctuation">:</span> answer<span class="token punctuation">,</span> <span class="token string">"start"</span><span class="token punctuation">:</span> start_char<span class="token punctuation">,</span> <span class="token string">"end"</span><span class="token punctuation">:</span> end_char<span class="token punctuation">,</span> <span class="token string">"score"</span><span class="token punctuation">:</span> score<span class="token punctuation">&#125;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">'\nğŸ¤— Transformers: State of the Art NLP'</span><span class="token punctuation">,</span> <span class="token string">'start'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'end'</span><span class="token punctuation">:</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token string">'score'</span><span class="token punctuation">:</span> <span class="token number">0.33867</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">'Jax, PyTorch and TensorFlow'</span><span class="token punctuation">,</span> <span class="token string">'start'</span><span class="token punctuation">:</span> <span class="token number">1892</span><span class="token punctuation">,</span> <span class="token string">'end'</span><span class="token punctuation">:</span> <span class="token number">1919</span><span class="token punctuation">,</span> <span class="token string">'score'</span><span class="token punctuation">:</span> <span class="token number">0.97149</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>å¦‚æœæˆ‘ä»¬å¿½ç•¥ç¬¬ä¸€ä¸ªç»“æœï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸è¿™ä¸ªé•¿ä¸Šä¸‹æ–‡çš„æµç¨‹ç›¸åŒçš„ç»“æœâ€”â€”å¤ªå¥½äº†ï¼</p>
<blockquote>
<p>âœï¸ è¯•ä¸€è¯•ï¼ä½¿ç”¨ä½ ä¹‹å‰è®¡ç®—çš„æœ€ä½³å¾—åˆ†æ¥å±•ç¤ºæ•´ä¸ªä¸Šä¸‹æ–‡ä¸­æœ€å¯èƒ½çš„äº”ä¸ªç­”æ¡ˆï¼ˆä¸æ˜¯æ¯ä¸ªå—ï¼‰ã€‚ä¸ºäº†æ£€æŸ¥ä½ çš„ç»“æœï¼Œå›åˆ°ç¬¬ä¸€ä¸ªpipelineï¼Œå¹¶åœ¨è°ƒç”¨æ—¶ä¼ å…¥ top_k&#x3D;5ã€‚</p>
</blockquote>
<p>è¿™ç»“æŸäº†æˆ‘ä»¬å¯¹åˆ†è¯å™¨åŠŸèƒ½çš„æ·±å…¥æ¢è®¨ã€‚åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œå½“æˆ‘ä»¬å±•ç¤ºå¦‚ä½•åœ¨ä¸€ç³»åˆ—å¸¸è§çš„ NLP ä»»åŠ¡ä¸­å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒæ—¶ï¼Œæˆ‘ä»¬å°†ä¼šå†æ¬¡å®è·µæ‰€æœ‰è¿™äº›å†…å®¹ã€‚</p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ç¬¬äºŒç™¾äº”åå››ç¯‡åšæ–‡å†™å®Œï¼Œå¼€å¿ƒï¼ï¼ï¼ï¼</p>
<p>ä»Šå¤©ï¼Œä¹Ÿæ˜¯å……æ»¡å¸Œæœ›çš„ä¸€å¤©ã€‚</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        æ–‡ç« ä½œè€…:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">LuYF-Lemon-love</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        æ–‡ç« é“¾æ¥:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://luyf-lemon-love.space/2025/01/01/00254-nlp-course-fast-tokenizers-in-the-qa-pipeline/">https://luyf-lemon-love.space/2025/01/01/00254-nlp-course-fast-tokenizers-in-the-qa-pipeline/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        ç‰ˆæƒå£°æ˜:
                    </i>
                </span>
                <span class="reprint-info">
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº
                    <a href="/about" target="_blank">LuYF-Lemon-love</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">æŸ¥çœ‹</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">
                                    <span class="chip bg-color">æ·±åº¦å­¦ä¹ </span>
                                </a>
                            
                                <a href="/tags/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/">
                                    <span class="chip bg-color">å¤§è¯­è¨€æ¨¡å‹</span>
                                </a>
                            
                                <a href="/tags/huggingface/">
                                    <span class="chip bg-color">huggingface</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>å¾®ä¿¡æ‰«ä¸€æ‰«å³å¯åˆ†äº«ï¼</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">èµ</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">è°¢è°¢å°ä¸»ï¼</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">æ”¯ä»˜å®</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">å¾® ä¿¡</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="https://cos.luyf-lemon-love.space/images/20220511162303.png" class="reward-img" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
                    </div>
                    <div id="wechat">
                        <img src="https://cos.luyf-lemon-love.space/images/20220511162220.png" class="reward-img" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;ä¸Šä¸€ç¯‡</div>
            <div class="card">
                <a href="/2025/01/01/00255-python-shi-yong-zi-ding-yi-bian-li-han-shu/">
                    <div class="card-image">
                        
                        <img src="https://cos.luyf-lemon-love.space/images/056-%E5%8F%AF%E7%88%B1%E7%B2%89%E8%89%B2%E8%BF%9E%E5%B8%BD%E8%A1%AB%E5%8A%A8%E6%BC%AB%E5%A5%B3%E5%AD%A9.jpg" class="responsive-img" alt="00255 Python å®ç”¨è‡ªå®šä¹‰ä¾¿åˆ©å‡½æ•°">
                        
                        <span class="card-title">00255 Python å®ç”¨è‡ªå®šä¹‰ä¾¿åˆ©å‡½æ•°</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-01-01
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Python/" class="post-category">
                                    Python
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ä¸‹ä¸€ç¯‡&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/12/30/00253-monte-carlo-tree-search-suan-fa/">
                    <div class="card-image">
                        
                        <img src="https://cos.luyf-lemon-love.space/images/054-%E5%A4%A7%E8%83%B8.jpg" class="responsive-img" alt="00253 Monte Carlo Tree Searchç®—æ³•">
                        
                        <span class="card-title">00253 Monte Carlo Tree Searchç®—æ³•</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-12-30
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" class="post-category">
                                    äººå·¥æ™ºèƒ½
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/">
                        <span class="chip bg-color">å¼ºåŒ–å­¦ä¹ </span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- ä»£ç å—åŠŸèƒ½ä¾èµ– -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- æ˜¯å¦åŠ è½½ä½¿ç”¨è‡ªå¸¦çš„ prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- ä»£ç è¯­è¨€ -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- ä»£ç å—å¤åˆ¶ -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- ä»£ç å—æ”¶ç¼© -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC æ‚¬æµ®æŒ‰é’®. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* ä¿®å¤æ–‡ç« å¡ç‰‡ div çš„å®½åº¦. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // åˆ‡æ¢TOCç›®å½•å±•å¼€æ”¶ç¼©çš„ç›¸å…³æ“ä½œ.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
    });
</script>



    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022-2025</span>
            
            <a href="/about" target="_blank">LuYF-Lemon-love</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;æ€»è®¿é—®é‡:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;æ€»è®¿é—®äººæ•°:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- è¿è¡Œå¤©æ•°æé†’. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2022";
                        var startMonth = "5";
                        var startDate = "7";
                        var startHour = "4";
                        var startMinute = "53";
                        var startSecond = "32";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // åŒºåˆ†æ˜¯å¦æœ‰å¹´ä»½.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = 'æœ¬ç«™å·²è¿è¡Œ ' + diffDays + ' å¤©';
                            } else if (language === 'zh-HK') {
                                daysTip = 'æœ¬ç«™å·²é‹è¡Œ ' + diffDays + ' å¤©';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = 'æœ¬ç«™å·²è¿è¡Œ ' + diffYears + ' å¹´ ' + diffDays + ' å¤©';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = 'æœ¬ç«™å·²é‹è¡Œ ' + diffYears + ' å¹´ ' + diffDays + ' å¤©';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
                <span id="icp"><img src="/medias/icp.png"
                                    style="vertical-align: text-bottom;"/>
                <a href="https://beian.miit.gov.cn" target="_blank">å†€ICPå¤‡2022012632å·-1</a>
            </span>
            
            <br>
            
                <span id="gongan"><img src="https://cos.luyf-lemon-love.space/images/å¤‡æ¡ˆå›¾æ ‡.png"
                                    style="vertical-align: text-bottom;"/>
                <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=32011502011618" target="_blank">è‹å…¬ç½‘å®‰å¤‡ 32011502011618å·</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/yanfeng98" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:luyanfeng_nlp@qq.com" class="tooltipped" target="_blank" data-tooltip="é‚®ä»¶è”ç³»æˆ‘" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS è®¢é˜…" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- æœç´¢é®ç½©æ¡† -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;æœç´¢</span>
            <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- ç™½å¤©å’Œé»‘å¤œä¸»é¢˜ -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- é›ªèŠ±ç‰¹æ•ˆ -->
    

    <!-- é¼ æ ‡æ˜Ÿæ˜Ÿç‰¹æ•ˆ -->
     
        <script type="text/javascript">
            // åªåœ¨æ¡Œé¢ç‰ˆç½‘é¡µå¯ç”¨ç‰¹æ•ˆ
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/star.js"><\/script>');
            }
        </script>
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--è…¾è®¯å…”å°å·¢-->
    
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
