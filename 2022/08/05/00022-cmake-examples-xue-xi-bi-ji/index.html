<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="00022-CMake Examples 学习笔记, NLP LLM DeepLearning LuYF-Lemon-love 自然语言处理 深度学习 大语言模型">
    <meta name="description" content="前言CMake 是一个跨平台开源构建系统，可以构建、测试和打包软件。它可用于支持多个本地构建环境，包括 make，Apple 的 xcode 和 Microsoft Visual Studio。
CMake Examples 是一个包括现代">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>00022-CMake Examples 学习笔记 | LuYF-Lemon-love の Blog</title>
    <link rel="icon" type="image/jpeg" href="https://cos.luyf-lemon-love.space/images/苏苏1.jpeg">
    
    <style>
        body{
            background-image: url(https://cos.luyf-lemon-love.space/images/016-%E6%8A%A5%E7%BA%B8%E5%A2%99%E9%BA%BB%E8%A1%A3%E5%AD%A6%E5%A7%90.jpg);
            background-repeat:no-repeat;
            background-size: 100% 100%;
            background-attachment:fixed;
        }
    </style>



    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <span class="logo-span">LuYF-Lemon-love の Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>List</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/galleries">
          
          <i class="fas fa-image" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Image</span>
        </a>
      </li>
      
      <li>
        <a href="/verse">
          
          <i class="fas fa-comments" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Verse</span>
        </a>
      </li>
      
      <li>
        <a href="/bilibili">
          
          <i class="fas fa-video" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Bilibili</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <div class="logo-name">LuYF-Lemon-love の Blog</div>
        <div class="logo-desc">
            
            天之道，损有余而补不足，人之道则不然，损不足以奉有余。
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			List
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/galleries " style="margin-left:75px">
				  
				   <i class="fa fas fa-image" style="position: absolute;left:50px" ></i>
			      
		          <span>Image</span>
                  </a>
                </li>
              
                <li>

                  <a href="/verse " style="margin-left:75px">
				  
				   <i class="fa fas fa-comments" style="position: absolute;left:50px" ></i>
			      
		          <span>Verse</span>
                  </a>
                </li>
              
                <li>

                  <a href="/bilibili " style="margin-left:75px">
				  
				   <i class="fa fas fa-video" style="position: absolute;left:50px" ></i>
			      
		          <span>Bilibili</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/yanfeng98/paper-is-all-you-need" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/yanfeng98/paper-is-all-you-need" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cos.luyf-lemon-love.space/images/弗雷尔卓德.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">00022-CMake Examples 学习笔记</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/C/">
                                <span class="chip bg-color">C++</span>
                            </a>
                        
                            <a href="/tags/make/">
                                <span class="chip bg-color">make</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" class="post-category">
                                计算机基础
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-08-05
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2024-12-28
                </div>
                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p><a href="https://cmake.org/">CMake</a> 是一个跨平台开源构建系统，可以构建、测试和打包软件。它可用于支持多个本地构建环境，包括 <code>make</code>，Apple 的 <code>xcode</code> 和 <code>Microsoft Visual Studio</code>。</p>
<p><a href="https://github.com/ttroy50/cmake-examples">CMake Examples</a> 是一个包括现代 <code>CMake</code> 的配置例子的仓库。这些示例以类似教程的格式列出。第一个示例非常基本，并且利用前面的示例来缓慢增加复杂性，以显示更复杂的用例。</p>
<p><a href="https://github.com/SFUMECJF/cmake-examples-Chinese">cmake-examples-Chinese</a> 是 <a href="https://github.com/ttroy50/cmake-examples">CMake Examples</a> 项目的中文版。</p>
<p>该学习笔记只介绍了 <code>CMake Examples</code> 项目的一部分例子。</p>
<p>操作系统（本地）：Windows 10 专业版</p>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol>
<li><p><a href="https://github.com/ttroy50/cmake-examples">CMake Examples</a></p>
</li>
<li><p><a href="https://github.com/SFUMECJF/cmake-examples-Chinese">cmake-examples-Chinese</a></p>
</li>
<li><p><a href="https://www.msys2.org/docs/cmake/">Using CMake in MSYS2</a></p>
</li>
<li><p><a href="https://cmake.org/cmake/help/latest/guide/tutorial/Installing%20and%20Testing.html">Step 4: Installing and Testing</a></p>
</li>
<li><p><a href="https://cmake.org/cmake/help/latest/guide/tutorial/Packaging%20an%20Installer.html">Step 7: Packaging an Installer</a></p>
</li>
</ol>
<h3 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h3><p>本博文使用 <code>MSYS2</code> 作为运行 <code>C++</code> 和 <code>CMake</code> 的工作环境。</p>
<p>关于如何安装 <code>MSYS2</code> 可以参考官方文档 <a href="https://www.msys2.org/">MSYS2</a> 或者 00020-GCC-on-Windows。</p>
<p>运行开始菜单的 “MSYS2 MSYS”。安装 CMake。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman <span class="token parameter variable">-S</span> mingw-w64-x86_64-cmake
pacman <span class="token parameter variable">-S</span> <span class="token function">make</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>MSYS2</code> 的 <code>CMake</code> 可以参考 <a href="https://www.msys2.org/docs/cmake/">Using CMake in MSYS2</a>。</p>
<p><code>MSYS2</code> 的 <code>CMake</code> 默认使用 <code>Ninja</code> 作为构建工具。可以通过 <code>-G</code> 指定。</p>
<p>When running the CMake configuration command, it’s recommended to explicitly specify the desired build file generator with the <code>-G</code> option. MSYS2 provided CMake defaults to Ninja (but this is not the default in upstream CMake, so it’s safest to explicitly specify it).</p>
<p>Thus, to configure and build a CMake based project, you can run the following commands:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ cmake <span class="token parameter variable">-G</span> Ninja <span class="token operator">&lt;</span>path-to-source<span class="token operator">></span> <span class="token parameter variable">-DCMAKE_BUILD_TYPE</span><span class="token operator">=</span>Release
$ cmake <span class="token parameter variable">--build</span> <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>The relevant generator alternatives are:</p>
<ul>
<li><p><code>-G Ninja</code></p>
</li>
<li><p><code>-G &quot;MSYS Makefiles&quot;</code></p>
</li>
<li><p><code>-G &quot;MinGW Makefiles&quot;</code></p>
</li>
</ul>
<p>If building by invoking <code>cmake --build</code>, the same command works for all generator choices. Alternatively, to build by directly invoking the build tool, you can call <code>ninja</code>, <code>make</code> or <code>mingw32-make</code> respectively for those three alternatives.</p>
<h4 id="version"><a href="#version" class="headerlink" title="version"></a>version</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 ~
$ cmake <span class="token parameter variable">--version</span>
cmake version <span class="token number">3.23</span>.2

CMake suite maintained and supported by Kitware <span class="token punctuation">(</span>kitware.com/cmake<span class="token punctuation">)</span>.

lyf@DESKTOP-GV2QHKN MINGW64 ~
$ <span class="token function">make</span> <span class="token parameter variable">--version</span>
GNU Make <span class="token number">4.3</span>
为 x86_64-pc-msys 编译
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">1988</span>-2020 Free Software Foundation, Inc.
许可证：GPLv3+：GNU 通用公共许可证第 <span class="token number">3</span> 版或更新版本<span class="token operator">&lt;</span>http://gnu.org/licenses/gpl.html<span class="token operator">></span>。
本软件是自由软件：您可以自由修改和重新发布它。
在法律允许的范围内没有其他保证。

lyf@DESKTOP-GV2QHKN MINGW64 ~
$ <span class="token function">which</span> cmake
/mingw64/bin/cmake

lyf@DESKTOP-GV2QHKN MINGW64 ~
$ <span class="token function">which</span> <span class="token function">make</span>
/usr/bin/make

lyf@DESKTOP-GV2QHKN MINGW64 ~
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="01-basic"><a href="#01-basic" class="headerlink" title="01-basic"></a>01-basic</h3><h4 id="A-hello-cmake"><a href="#A-hello-cmake" class="headerlink" title="A-hello-cmake"></a>A-hello-cmake</h4><h5 id="Files"><a href="#Files" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> cmake-examples
<span class="token builtin class-name">cd</span> cmake-examples
<span class="token function">mkdir</span> 01-basic
<span class="token builtin class-name">cd</span> 01-basic
<span class="token function">mkdir</span> A-hello-cmake
<span class="token builtin class-name">cd</span> A-hello-cmake<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Set the minimum version of CMake that can be used</span>
<span class="token comment"># To find the cmake version run</span>
<span class="token comment"># $ cmake --version</span>
<span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>hello_cmake<span class="token punctuation">)</span>

<span class="token comment"># Add an executable</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span> main.cpp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

int main(int argc, char *argv[])
&#123;
        std::cout &lt;&lt; &quot;Hello CMake!&quot; &lt;&lt; std::endl;
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h5><p>这是一个基础的 <code>hello world</code> 例子。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
└── main.cpp

<span class="token number">0</span> directories, <span class="token number">2</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code>: <code>CMake</code> 的配置文件。</p>
</li>
<li><p><code>main.cpp</code>: 一个简单的 <code>Hello World</code> cpp 文件。</p>
</li>
</ul>
<h5 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="CMakeLists-txt"><a href="#CMakeLists-txt" class="headerlink" title="CMakeLists.txt"></a>CMakeLists.txt</h6><p><code>CMakeLists.txt</code> 是一个存储 <code>CMake commands</code> 的文件，当在一个目录中运行 <code>cmake</code> 时，它将要寻找这个文件。如果没有这个文件，<code>cmake</code> 将要报错。</p>
<h6 id="Minimum-CMake-version"><a href="#Minimum-CMake-version" class="headerlink" title="Minimum CMake version"></a>Minimum CMake version</h6><p>当使用 <code>CMake</code> 创建一个项目时，你能指定支持的 <code>CMake</code> 的最低版本。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="Projects"><a href="#Projects" class="headerlink" title="Projects"></a>Projects</h6><p><code>CMake</code> 生成可以包含项目名称，以便在使用多个项目时，更轻松地引用某些变量。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">project</span><span class="token punctuation">(</span>hello_cmake<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="Creating-an-Executable"><a href="#Creating-an-Executable" class="headerlink" title="Creating an Executable"></a>Creating an Executable</h6><p><code>add_executable()</code> 命令可以从指定的源文件生成可执行文件，在此示例中为 <code>main.cpp</code>。<code>add_executable()</code> 函数的第一个参数是要生成的可执行文件的名称，第二个参数是要编译的源文件的列表。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello_cmake main.cpp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>有些人经常使项目名称和可执行文件名称相同。这允许你指定 <code>CMakeLists.txt</code> 如下所示:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">2.6</span><span class="token punctuation">)</span>
<span class="token keyword">project</span> <span class="token punctuation">(</span>hello_cmake<span class="token punctuation">)</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span> main.cpp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>在此示例中，<code>project()</code> 函数将创建一个值为 <code>hello_cmake</code> 的变量 <code>$&#123;PROJECT_NAME&#125;</code>。然后，可以将其传递给 <code>add_executable()</code> 函数以输出 <code>hello_cmake</code> 可执行文件。</p>
<h6 id="Binary-Directory"><a href="#Binary-Directory" class="headerlink" title="Binary Directory"></a>Binary Directory</h6><p>运行 cmake 命令的根文件夹或顶级文件夹称为 <code>CMAKE_BINARY_DIR</code>，并且是所有二进制文件的根文件夹。CMake 支持<code>外部构建</code>和<code>内部构建</code>两种方式生成二进制文件。</p>
<p>内部构建</p>
<p><code>内部构建</code>在与源代码相同的目录结构中生成所有临时生成文件。这意味着所有 <code>Makefiles and object files</code> 都散布在源代码代码中。要<code>内部构建</code>目标，请在根目录中运行 <code>cmake</code> 命令。例如：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ <span class="token function">which</span> cmake
/mingw64/bin/cmake

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ <span class="token function">which</span> <span class="token function">make</span>
/usr/bin/make

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ <span class="token function">ls</span>
CMakeLists.txt  main.cpp

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ cmake <span class="token builtin class-name">.</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ tree
<span class="token builtin class-name">.</span>
├── cmake_install.cmake
├── CMakeCache.txt
├── CMakeFiles
│   ├── <span class="token number">3.23</span>.2
│   │   ├── CMakeCCompiler.cmake
│   │   ├── CMakeCXXCompiler.cmake
│   │   ├── CMakeDetermineCompilerABI_C.bin
│   │   ├── CMakeDetermineCompilerABI_CXX.bin
│   │   ├── CMakeRCCompiler.cmake
│   │   ├── CMakeSystem.cmake
│   │   ├── CompilerIdC
│   │   │   ├── a.exe
│   │   │   ├── CMakeCCompilerId.c
│   │   │   └── tmp
│   │   └── CompilerIdCXX
│   │       ├── a.exe
│   │       ├── CMakeCXXCompilerId.cpp
│   │       └── tmp
│   ├── cmake.check_cache
│   ├── CMakeDirectoryInformation.cmake
│   ├── CMakeOutput.log
│   ├── CMakeTmp
│   ├── hello_cmake.dir
│   │   ├── build.make
│   │   ├── cmake_clean.cmake
│   │   ├── compiler_depend.make
│   │   ├── compiler_depend.ts
│   │   ├── depend.make
│   │   ├── DependInfo.cmake
│   │   ├── flags.make
│   │   └── progress.make
│   ├── Makefile.cmake
│   ├── Makefile2
│   ├── progress.marks
│   └── TargetDirectories.txt
├── CMakeLists.txt
├── main.cpp
└── Makefile

<span class="token number">8</span> directories, <span class="token number">30</span> files

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ <span class="token function">make</span>
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello_cmake.dir/main.cpp.obj
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable hello_cmake.exe
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target hello_cmake

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeFiles      hello_cmake.exe  Makefile
CMakeCache.txt       CMakeLists.txt  main.cpp

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ ./hello_cmake.exe
Hello CMake<span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>外部构建</p>
<p><code>外部构建</code>允许您创建<code>单个构建文件夹</code>，该文件夹可以位于文件系统上的任何位置。所有临时构建文件和对象文件都位于此目录中，保持源代码目录的清洁。若要<code>外部构建</code>，请在<code>the build folder</code>中运行 <code>cmake</code> 命令，并将其指向包含根 <code>CMakeLists.txt</code> 文件的目录。如果要从头开始重新创建 cmake 环境，请使用外部构建，只需删除上面<code>内部构建</code>生成的文件，然后重新运行 <code>cmake</code>。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ <span class="token function">ls</span>
CMakeLists.txt  main.cpp

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ <span class="token function">ls</span>
build  CMakeLists.txt  main.cpp

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake/build
$ <span class="token function">ls</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake/build
$ cmake <span class="token punctuation">..</span>
-- Building for: Ninja
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake/build
$ cmake <span class="token parameter variable">--build</span> <span class="token builtin class-name">.</span>
<span class="token punctuation">[</span><span class="token number">2</span>/2<span class="token punctuation">]</span> Linking CXX executable hello_cmake.exe

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake/build
$ <span class="token function">ls</span>
build.ninja          CMakeCache.txt  hello_cmake.exe
cmake_install.cmake  CMakeFiles

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake/build
$ ./hello_cmake.exe
Hello CMake<span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake/build
$ <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$ tree
<span class="token builtin class-name">.</span>
├── build
│   ├── build.ninja
│   ├── cmake_install.cmake
│   ├── CMakeCache.txt
│   ├── CMakeFiles
│   │   ├── <span class="token number">3.23</span>.2
│   │   │   ├── CMakeCCompiler.cmake
│   │   │   ├── CMakeCXXCompiler.cmake
│   │   │   ├── CMakeDetermineCompilerABI_C.bin
│   │   │   ├── CMakeDetermineCompilerABI_CXX.bin
│   │   │   ├── CMakeRCCompiler.cmake
│   │   │   ├── CMakeSystem.cmake
│   │   │   ├── CompilerIdC
│   │   │   │   ├── a.exe
│   │   │   │   ├── CMakeCCompilerId.c
│   │   │   │   └── tmp
│   │   │   └── CompilerIdCXX
│   │   │       ├── a.exe
│   │   │       ├── CMakeCXXCompilerId.cpp
│   │   │       └── tmp
│   │   ├── cmake.check_cache
│   │   ├── CMakeOutput.log
│   │   ├── CMakeTmp
│   │   ├── hello_cmake.dir
│   │   │   └── main.cpp.obj
│   │   ├── rules.ninja
│   │   └── TargetDirectories.txt
│   └── hello_cmake.exe
├── CMakeLists.txt
└── main.cpp

<span class="token number">9</span> directories, <span class="token number">21</span> files

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/A-hello-cmake
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="B-hello-headers"><a href="#B-hello-headers" class="headerlink" title="B-hello-headers"></a>B-hello-headers</h4><h5 id="Files-1"><a href="#Files-1" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
<span class="token function">mkdir</span> B-hello-headers
<span class="token builtin class-name">cd</span> B-hello-headers<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Set the minimum version of CMake that can be used</span>
<span class="token comment"># To find the cmake version run</span>
<span class="token comment"># $ cmake --version</span>
<span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>hello_headers<span class="token punctuation">)</span>

<span class="token comment"># Create a sources variable with a link to all cpp files to compile</span>
<span class="token keyword">file</span><span class="token punctuation">(</span>GLOB <span class="token property">SOURCES</span> <span class="token string">"src/*.cpp"</span><span class="token punctuation">)</span>

<span class="token comment"># Add an executable with the above sources</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello_headers <span class="token punctuation">$&#123;</span><span class="token property">SOURCES</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment"># Set the directories that should be included in the build command for this target</span>
<span class="token comment"># when running g++ these will be included as -I/directory/path/</span>
<span class="token keyword">target_include_directories</span><span class="token punctuation">(</span>hello_headers
        <span class="token namespace">PRIVATE</span>
        <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/include
        <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>include/Hello.h</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#ifndef __HELLO_H__
#define __HELLO_H__

class Hello
&#123;
public:
        void print();
&#125;;

#endif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>创建 <code>src/Hello.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

#include &quot;Hello.h&quot;

void Hello::print()
&#123;
        std::cout &lt;&lt; &quot;Hello Headers!&quot; &lt;&lt; std::endl;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>创建 <code>src/main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &quot;Hello.h&quot;

int main(int argc, char *argv[])
&#123;
        Hello hi;
        hi.print();
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-1"><a href="#Introduction-1" class="headerlink" title="Introduction"></a>Introduction</h5><p>该例子使用不同目录包含头文件和源文件。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
├── include
│   └── Hello.h
└── src
    ├── Hello.cpp
    └── main.cpp

<span class="token number">2</span> directories, <span class="token number">4</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code>: <code>CMake</code> 的配置文件。</p>
</li>
<li><p><code>include/Hello.h</code>: 头文件。</p>
</li>
<li><p><code>src/Hello.cpp</code>: 源文件。</p>
</li>
<li><p><code>src/main.cpp</code>: main 文件。</p>
</li>
</ul>
<h5 id="Concepts-1"><a href="#Concepts-1" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="Directory-Paths"><a href="#Directory-Paths" class="headerlink" title="Directory Paths"></a>Directory Paths</h6><p><code>CMake</code> 语法指定了许多变量，这些变量可用于帮助在项目或源代码树中查找有用的目录。其中一些包括：</p>
<table>
<thead>
<tr>
<th align="center">Variable</th>
<th align="center">Info</th>
</tr>
</thead>
<tbody><tr>
<td align="center">CMAKE_SOURCE_DIR</td>
<td align="center">The root source directory.</td>
</tr>
<tr>
<td align="center">CMAKE_CURRENT_SOURCE_DIR</td>
<td align="center">The current source directory if using sub-projects and directories.</td>
</tr>
<tr>
<td align="center">PROJECT_SOURCE_DIR</td>
<td align="center">The source directory of the current cmake project.</td>
</tr>
<tr>
<td align="center">CMAKE_BINARY_DIR</td>
<td align="center">The root binary &#x2F; build directory. This is the directory where you run the cmake command.</td>
</tr>
<tr>
<td align="center">CMAKE_CURRENT_BINARY_DIR</td>
<td align="center">The build directory you are currently in.</td>
</tr>
<tr>
<td align="center">PROJECT_BINARY_DIR</td>
<td align="center">The build directory for the current project.</td>
</tr>
</tbody></table>
<h6 id="Source-Files-Variable"><a href="#Source-Files-Variable" class="headerlink" title="Source Files Variable"></a>Source Files Variable</h6><p>通过创建包含源文件的变量，你可以更清楚地了解这些文件，并轻松地将它们添加到多个命令中，例如，add_executable() 函数。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Create a sources variable with a link to all cpp files to compile</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token property">SOURCES</span>
    src/Hello.cpp
    src/main.cpp
<span class="token punctuation">)</span>

<span class="token keyword">add_executable</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span> <span class="token punctuation">$&#123;</span><span class="token property">SOURCES</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在 <code>SOURCES</code> 变量中设置特定文件名的替代方法是使用 <code>GLOB</code> 命令通过通配符模式匹配来查找文件。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">file</span><span class="token punctuation">(</span>GLOB <span class="token property">SOURCES</span> <span class="token string">"src/*.cpp"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="Including-Directories"><a href="#Including-Directories" class="headerlink" title="Including Directories"></a>Including Directories</h6><p>当你有不同的文件夹时，可以使用 <code>target_include_directories()</code> 函数使编译器知道它们。在编译此目标时，这会将这些目录添加到具有 -I 标志的编译器中，例如 <code>-I /directory/path</code>。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">target_include_directories</span><span class="token punctuation">(</span>target
    <span class="token namespace">PRIVATE</span>
        <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/include
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Building-the-Example"><a href="#Building-the-Example" class="headerlink" title="Building the Example"></a>Building the Example</h5><h6 id="Standard-Output"><a href="#Standard-Output" class="headerlink" title="Standard Output"></a>Standard Output</h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build
$ <span class="token function">make</span>
<span class="token punctuation">[</span> <span class="token number">33</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello_headers.dir/src/Hello.cpp.obj
<span class="token punctuation">[</span> <span class="token number">66</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello_headers.dir/src/main.cpp.obj
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable hello_headers.exe
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target hello_headers

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeFiles         Makefile
CMakeCache.txt       hello_headers.exe

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build
$ ./hello_headers.exe
Hello Headers<span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="Verbose-Output"><a href="#Verbose-Output" class="headerlink" title="Verbose Output"></a>Verbose Output</h6><p>在前面的示例中，运行 <code>make</code> 命令时，输出仅显示生成的状态。若要查看用于调试目的的完整输出，可以在运行 <code>make</code> 时添加 <code>VERBOSE=1</code> 标志。</p>
<p>下面显示了 <code>VERBOSE</code> 输出，对输出的检查显示了要添加到 c++ 编译器命令中的 <code>include</code> 目录。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build
$ <span class="token function">make</span> clean

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeCache.txt  CMakeFiles  Makefile

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build
$ <span class="token function">make</span> <span class="token assign-left variable">VERBOSE</span><span class="token operator">=</span><span class="token number">1</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe -S/F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers -B/F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build --check-build-system CMakeFiles/Makefile.cmake <span class="token number">0</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build/CMakeFiles /F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build//CMakeFiles/progress.marks
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/Makefile2 all
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/hello_headers.dir/build.make CMakeFiles/hello_headers.dir/depend
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build”
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_depends <span class="token string">"MSYS Makefiles"</span> /F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers /F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers /F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build /F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build /F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build/CMakeFiles/hello_headers.dir/DependInfo.cmake <span class="token parameter variable">--color</span><span class="token operator">=</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/hello_headers.dir/build.make CMakeFiles/hello_headers.dir/build
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build”
<span class="token punctuation">[</span> <span class="token number">33</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello_headers.dir/src/Hello.cpp.obj
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe  -I/F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/include  <span class="token parameter variable">-MD</span> <span class="token parameter variable">-MT</span> CMakeFiles/hello_headers.dir/src/Hello.cpp.obj <span class="token parameter variable">-MF</span> CMakeFiles/hello_headers.dir/src/Hello.cpp.obj.d <span class="token parameter variable">-o</span> CMakeFiles/hello_headers.dir/src/Hello.cpp.obj <span class="token parameter variable">-c</span> /F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/src/Hello.cpp
<span class="token punctuation">[</span> <span class="token number">66</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello_headers.dir/src/main.cpp.obj
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe  -I/F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/include  <span class="token parameter variable">-MD</span> <span class="token parameter variable">-MT</span> CMakeFiles/hello_headers.dir/src/main.cpp.obj <span class="token parameter variable">-MF</span> CMakeFiles/hello_headers.dir/src/main.cpp.obj.d <span class="token parameter variable">-o</span> CMakeFiles/hello_headers.dir/src/main.cpp.obj <span class="token parameter variable">-c</span> /F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/src/main.cpp
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable hello_headers.exe
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> CMakeFiles/hello_headers.dir/objects.a
/D/lyf_computer_language/msys64/mingw64/bin/ar.exe qc CMakeFiles/hello_headers.dir/objects.a <span class="token string">"CMakeFiles/hello_headers.dir/src/Hello.cpp.obj"</span> <span class="token string">"CMakeFiles/hello_headers.dir/src/main.cpp.obj"</span>
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe -Wl,--whole-archive CMakeFiles/hello_headers.dir/objects.a -Wl,--no-whole-archive <span class="token parameter variable">-o</span> hello_headers.exe -Wl,--out-implib,libhello_headers.dll.a -Wl,--major-image-version,0,--minor-image-version,0  <span class="token parameter variable">-lkernel32</span> <span class="token parameter variable">-luser32</span> <span class="token parameter variable">-lgdi32</span> <span class="token parameter variable">-lwinspool</span> <span class="token parameter variable">-lshell32</span> <span class="token parameter variable">-lole32</span> <span class="token parameter variable">-loleaut32</span> <span class="token parameter variable">-luuid</span> <span class="token parameter variable">-lcomdlg32</span> <span class="token parameter variable">-ladvapi32</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build”
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target hello_headers
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build”
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build/CMakeFiles <span class="token number">0</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/B-hello-headers/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="C-static-library"><a href="#C-static-library" class="headerlink" title="C-static-library"></a>C-static-library</h4><h5 id="Files-2"><a href="#Files-2" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>
<span class="token function">mkdir</span> C-static-library
<span class="token builtin class-name">cd</span> C-static-library<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token keyword">project</span><span class="token punctuation">(</span>hello_library<span class="token punctuation">)</span>

<span class="token comment">##############################################</span>
<span class="token comment"># Create a library</span>
<span class="token comment">##############################################</span>

<span class="token comment"># Generate the static library from the library sources</span>
<span class="token keyword">add_library</span><span class="token punctuation">(</span>hello_library <span class="token namespace">STATIC</span>
        src/Hello.cpp
        <span class="token punctuation">)</span>

<span class="token keyword">target_include_directories</span><span class="token punctuation">(</span>hello_library
        <span class="token namespace">PUBLIC</span>
        <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/include
        <span class="token punctuation">)</span>

<span class="token comment">###############################################</span>
<span class="token comment"># Create an executable</span>
<span class="token comment">###############################################</span>

<span class="token comment"># Add an executable with the above sources</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello_binary
        src/main.cpp
        <span class="token punctuation">)</span>

<span class="token comment"># link the new hello_library target with the hello_binary target</span>
<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>hello_binary
        <span class="token namespace">PRIVATE</span>
        hello_library
        <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>include/static/Hello.h</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#ifndef __HELLO_H__
#define __HELLO_H__

class Hello
&#123;
public:
        void print();
&#125;;

#endif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>创建 <code>src/Hello.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

#include &quot;static&#x2F;Hello.h&quot;

void Hello::print()
&#123;
        std::cout &lt;&lt; &quot;Hello Static Library!&quot; &lt;&lt; std::endl;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>创建 <code>src/main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &quot;static&#x2F;Hello.h&quot;

int main(int argc, char *argv[])
&#123;
        Hello hi;
        hi.print();
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-2"><a href="#Introduction-2" class="headerlink" title="Introduction"></a>Introduction</h5><p>显示一个 <code>hello world</code> 示例，该示例首先创建并链接<code>静态链接库</code>。这是一个简化的示例，显示库和二进制文件位于同一文件夹中。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/C-static-library
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
├── include
│   └── static
│       └── Hello.h
└── src
    ├── Hello.cpp
    └── main.cpp

<span class="token number">3</span> directories, <span class="token number">4</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code>: <code>CMake</code> 的配置文件。</p>
</li>
<li><p><code>include/static/Hello.h</code>: 头文件。</p>
</li>
<li><p><code>src/Hello.cpp</code>: 源文件。</p>
</li>
<li><p><code>src/main.cpp</code>: main 文件。</p>
</li>
</ul>
<h5 id="Concepts-2"><a href="#Concepts-2" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="Adding-a-Static-Library"><a href="#Adding-a-Static-Library" class="headerlink" title="Adding a Static Library"></a>Adding a Static Library</h6><p><code>add_library()</code> 函数用于从某些源文件创建库。这称为：</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">add_library</span><span class="token punctuation">(</span>hello_library <span class="token namespace">STATIC</span>
    src/Hello.cpp
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这将用于创建一个名为 <code>libhello_library.a</code> 的静态库，其中包含 <code>add_library</code> 调用中的源文件。</p>
<h6 id="Populating-Including-Directories"><a href="#Populating-Including-Directories" class="headerlink" title="Populating Including Directories"></a>Populating Including Directories</h6><p>在此示例中，我们使用作用域设置为 <code>PUBLIC</code> 的 <code>target_include_directories()</code> 函数在库中包含目录。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">target_include_directories</span><span class="token punctuation">(</span>hello_library
    <span class="token namespace">PUBLIC</span>
        <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/include
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>This will cause the included directory used in the following places:</p>
<ul>
<li><p>When compiling the library.</p>
</li>
<li><p>When compiling any additional target that links the library.</p>
</li>
</ul>
<p>The meaning of scopes are:</p>
<ul>
<li><p><code>PRIVATE</code> - the directory is added to <code>this target</code>’s include directories</p>
</li>
<li><p><code>INTERFACE</code> - the directory is added to the include directories for <code>any targets</code> that link this library.</p>
</li>
<li><p><code>PUBLIC</code> - As above, it is included in this library and also any targets that link this library.</p>
</li>
</ul>
<p>For public headers it is often a good idea to have your include folder be “namespaced” with sub-directories.</p>
<p>The directory passed to target_include_directories will be the root of your include directory tree and your C++ files should include the path from there to your header.</p>
<p>For this example you can see that we do it as follows:</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &quot;static&#x2F;Hello.h&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Using this method means that there is less chance of header filename clashes when you use multiple libraries in your project.</p>
<h6 id="Linking-a-Library"><a href="#Linking-a-Library" class="headerlink" title="Linking a Library"></a>Linking a Library</h6><p>创建将使用库的可执行文件时，必须告知编译器该库。这可以使用 <code>target_link_libraries()</code> 函数来完成。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello_binary
    src/main.cpp
<span class="token punctuation">)</span>

<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span> hello_binary
    <span class="token namespace">PRIVATE</span>
        hello_library
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>This tells CMake to link the hello_library against the hello_binary executable during link time. It will also propagate any include directories with <code>PUBLIC</code> or <code>INTERFACE</code> scope from the linked library target.</p>
<h5 id="Building-the-Example-1"><a href="#Building-the-Example-1" class="headerlink" title="Building the Example"></a>Building the Example</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/C-static-library
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/C-static-library
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/C-static-library/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/C-static-library/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/C-static-library/build
$ <span class="token function">make</span>
<span class="token punctuation">[</span> <span class="token number">25</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello_library.dir/src/Hello.cpp.obj
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Linking CXX static library libhello_library.a
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Built target hello_library
<span class="token punctuation">[</span> <span class="token number">75</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello_binary.dir/src/main.cpp.obj
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable hello_binary.exe
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target hello_binary

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/C-static-library/build
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeFiles        libhello_library.a
CMakeCache.txt       hello_binary.exe  Makefile

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/C-static-library/build
$ ./hello_binary.exe
Hello Static Library<span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/C-static-library/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="D-shared-library"><a href="#D-shared-library" class="headerlink" title="D-shared-library"></a>D-shared-library</h4><h5 id="Files-3"><a href="#Files-3" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>
<span class="token function">mkdir</span> D-shared-library
<span class="token builtin class-name">cd</span> D-shared-library/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token keyword">project</span><span class="token punctuation">(</span>hello_library<span class="token punctuation">)</span>

<span class="token comment">#########################################</span>
<span class="token comment"># Create a library</span>
<span class="token comment">#########################################</span>

<span class="token comment"># Generate the shared library from the library sources</span>
<span class="token keyword">add_library</span><span class="token punctuation">(</span>hello_library <span class="token namespace">SHARED</span>
        src/Hello.cpp
        <span class="token punctuation">)</span>

<span class="token keyword">add_library</span><span class="token punctuation">(</span><span class="token inserted class-name">hello::library</span> ALIAS hello_library<span class="token punctuation">)</span>

<span class="token keyword">target_include_directories</span><span class="token punctuation">(</span>hello_library
        <span class="token namespace">PUBLIC</span>
        <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/include
        <span class="token punctuation">)</span>

<span class="token comment">#########################################</span>
<span class="token comment"># Create an executable</span>
<span class="token comment">#########################################</span>

<span class="token comment"># Add an executable with the above sources</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello_binary
        src/main.cpp
        <span class="token punctuation">)</span>

<span class="token comment"># link the new hello_library target with the hello_binary target</span>
<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>hello_binary
        <span class="token namespace">PRIVATE</span>
        <span class="token inserted class-name">hello::library</span>
        <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>include/shared/Hello.h</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#ifndef __HELLO_H__
#define __HELLO_H__

class Hello
&#123;
public:
        void print();
&#125;;

#endif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>创建 <code>src/Hello.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

#include &quot;shared&#x2F;Hello.h&quot;

void Hello::print()
&#123;
        std::cout &lt;&lt; &quot;Hello Shared Library!&quot; &lt;&lt; std::endl;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>创建 <code>src/main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &quot;shared&#x2F;Hello.h&quot;

int main(int argc, char *argv[])
&#123;
        Hello hi;
        hi.print();
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-3"><a href="#Introduction-3" class="headerlink" title="Introduction"></a>Introduction</h5><p>该示例首先创建并链接共享库，然后显示了如何创建别名目标。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/D-shared-library
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
├── include
│   └── shared
│       └── Hello.h
└── src
    ├── Hello.cpp
    └── main.cpp

<span class="token number">3</span> directories, <span class="token number">4</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code>: <code>CMake</code> 的配置文件。</p>
</li>
<li><p><code>include/shared/Hello.h</code>: 头文件。</p>
</li>
<li><p><code>src/Hello.cpp</code>: 源文件。</p>
</li>
<li><p><code>src/main.cpp</code>: main 文件。</p>
</li>
</ul>
<h5 id="Concepts-3"><a href="#Concepts-3" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="Adding-a-Shared-Library"><a href="#Adding-a-Shared-Library" class="headerlink" title="Adding a Shared Library"></a>Adding a Shared Library</h6><p><code>add_library()</code> 函数也可以用于从某些源文件创建共享库。这称为：</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">add_library</span><span class="token punctuation">(</span>hello_library <span class="token namespace">SHARED</span>
    src/Hello.cpp
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这将用于创建一个名为 <code>libhello_library.so</code> 的共享库，并将源文件传递给 <code>add_library()</code> 函数。</p>
<h6 id="Alias-Target"><a href="#Alias-Target" class="headerlink" title="Alias Target"></a>Alias Target</h6><p>顾名思义，别名目标是目标的替代名称，可以在只读上下文中代替实际目标名称使用。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">add_library</span><span class="token punctuation">(</span><span class="token inserted class-name">hello::library</span> ALIAS hello_library<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如下所示，这允许你在将目标与其他目标链接时使用别名引用目标。</p>
<h6 id="Linking-a-Shared-Library"><a href="#Linking-a-Shared-Library" class="headerlink" title="Linking a Shared Library"></a>Linking a Shared Library</h6><p>链接共享库与链接静态库相同。创建可执行文件时，使用 <code>target_link_library()</code> 函数指向库。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello_binary
    src/main.cpp
<span class="token punctuation">)</span>

<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>hello_binary
    <span class="token namespace">PRIVATE</span>
        <span class="token inserted class-name">hello::library</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这将指示 <code>CMake</code> 使用别名目标名称将 <code>hello_library</code> 与 <code>hello_binary</code> 可执行文件链接起来。</p>
<h5 id="Building-the-Example-2"><a href="#Building-the-Example-2" class="headerlink" title="Building the Example"></a>Building the Example</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/D-shared-library
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/D-shared-library
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/D-shared-library/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/D-shared-library/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/D-shared-library/build
$ <span class="token function">make</span>
<span class="token punctuation">[</span> <span class="token number">25</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello_library.dir/src/Hello.cpp.obj
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Linking CXX shared library libhello_library.dll
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Built target hello_library
<span class="token punctuation">[</span> <span class="token number">75</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello_binary.dir/src/main.cpp.obj
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable hello_binary.exe
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target hello_binary

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/D-shared-library/build
$ <span class="token function">ls</span>
cmake_install.cmake  hello_binary.exe        Makefile
CMakeCache.txt       libhello_library.dll
CMakeFiles           libhello_library.dll.a

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/D-shared-library/build
$ ./hello_binary.exe
Hello Shared Library<span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/D-shared-library/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="E-installing"><a href="#E-installing" class="headerlink" title="E-installing"></a>E-installing</h4><h5 id="Files-4"><a href="#Files-4" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>
<span class="token function">mkdir</span> E-installing
<span class="token builtin class-name">cd</span> E-installing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>cmake-examples.conf</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-conf" data-language="conf"><code class="language-conf"># Sample configuration file that could be installed<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token keyword">project</span><span class="token punctuation">(</span>cmake_examples_install<span class="token punctuation">)</span>

<span class="token comment">#########################################</span>
<span class="token comment"># Create a library</span>
<span class="token comment">#########################################</span>

<span class="token comment"># Generate the shared library from the library sources</span>
<span class="token keyword">add_library</span><span class="token punctuation">(</span>cmake_examples_inst <span class="token namespace">SHARED</span>
        src/Hello.cpp
        <span class="token punctuation">)</span>

<span class="token keyword">target_include_directories</span><span class="token punctuation">(</span>cmake_examples_inst
        <span class="token namespace">PUBLIC</span>
        <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/include
        <span class="token punctuation">)</span>

<span class="token comment">###########################################</span>
<span class="token comment"># Create an executable</span>
<span class="token comment">###########################################</span>

<span class="token comment"># Add an executable with the above sources</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>cmake_examples_inst_bin
        src/main.cpp
        <span class="token punctuation">)</span>

<span class="token comment"># link the new hello_library target with the hello_binary target</span>
<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>cmake_examples_inst_bin
        <span class="token namespace">PRIVATE</span>
        cmake_examples_inst
        <span class="token punctuation">)</span>

<span class="token comment">###################################################</span>
<span class="token comment"># Install</span>
<span class="token comment">###################################################</span>

<span class="token comment"># Binaries</span>
<span class="token keyword">install</span><span class="token punctuation">(</span>TARGETS cmake_examples_inst_bin
        DESTINATION bin<span class="token punctuation">)</span>

<span class="token comment"># Library</span>
<span class="token comment"># Note: may not work on windows</span>
<span class="token keyword">install</span><span class="token punctuation">(</span>TARGETS cmake_examples_inst
        LIBRARY DESTINATION lib<span class="token punctuation">)</span>

<span class="token comment"># Header files</span>
<span class="token keyword">install</span><span class="token punctuation">(</span>DIRECTORY <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/include/
        DESTINATION include<span class="token punctuation">)</span>
<span class="token comment"># Cofig</span>
<span class="token keyword">install</span><span class="token punctuation">(</span>FILES cmake-examples.conf
        DESTINATION etc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>创建 <code>include/installing/Hello.h</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#ifndef __HELLO_H__
#define __HELLO_H__

class Hello
&#123;
public:
        void print();
&#125;;

#endif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>创建 <code>src/Hello.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

#include &quot;installing&#x2F;Hello.h&quot;

void Hello::print()
&#123;
        std::cout &lt;&lt; &quot;Hello Install!&quot; &lt;&lt; std::endl;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="6">
<li>创建 <code>src/main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &quot;installing&#x2F;Hello.h&quot;

int main(int argc, char *argv[])
&#123;
        Hello hi;
        hi.print();
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-4"><a href="#Introduction-4" class="headerlink" title="Introduction"></a>Introduction</h5><p>此示例演示如何生成 <code>make install</code> 目标以在系统上安装文件和二进制文件。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/E-installing
$ tree
<span class="token builtin class-name">.</span>
├── cmake-examples.conf
├── CMakeLists.txt
├── include
│   └── installing
│       └── Hello.h
└── src
    ├── Hello.cpp
    └── main.cpp

<span class="token number">3</span> directories, <span class="token number">5</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code>: <code>CMake</code> 的配置文件。</p>
</li>
<li><p><code>cmake-examples.conf</code>: 配置文件。</p>
</li>
<li><p><code>include/installing/Hello.h</code>: 头文件。</p>
</li>
<li><p><code>src/Hello.cpp</code>: 源文件。</p>
</li>
<li><p><code>src/main.cpp</code>: main 文件。</p>
</li>
</ul>
<h5 id="Concepts-4"><a href="#Concepts-4" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="Installing"><a href="#Installing" class="headerlink" title="Installing"></a>Installing</h6><p><code>CMake</code> 提供了添加 <code>make install</code> 目标的功能，以允许用户安装 <code>二进制文件</code>，<code>库</code> 和 <code>其他文件</code>。基本安装位置由变量 <code>CMAKE_INSTALL_PREFIX</code> 控制，该变量可以使用 <code>ccmake</code> 或通过调用 <code>cmake</code> (<code>cmake .. -DCMAKE_INSTALL_PREFIX=/install/location</code>) 来设置。</p>
<p>安装的文件由 <code>install()</code> 函数控制。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">install</span> <span class="token punctuation">(</span>TARGETS cmake_examples_inst_bin
    DESTINATION bin<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>将从目标 <code>cmake_examples_inst_bin</code> 生成的 <code>二进制文件</code> 安装到 <code>$&#123;CMAKE_INSTALL_PREFIX&#125;/bin</code> 目录中。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">install</span> <span class="token punctuation">(</span>TARGETS cmake_examples_inst
    LIBRARY DESTINATION lib<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>将从目标 <code>cmake_examples_inst</code> 生成的 <code>共享库</code> 安装到 <code>$&#123;CMAKE_INSTALL_PREFIX&#125;/lib</code> 目录中。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">install</span><span class="token punctuation">(</span>DIRECTORY <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/include/
    DESTINATION include<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>将用于针对 <code>cmake_examples_inst</code> 库进行开发的 <code>头文件</code> 安装到 <code>$&#123;CMAKE_INSTALL_PREFIX&#125;/include</code> 目录中。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">install</span> <span class="token punctuation">(</span>FILES cmake-examples.conf
    DESTINATION etc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>将 <code>配置文件</code> 安装到 <code>$&#123;CMAKE_INSTALL_PREFIX&#125;/etc</code> 目录中。</p>
<h5 id="Building-the-Example-3"><a href="#Building-the-Example-3" class="headerlink" title="Building the Example"></a>Building the Example</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/E-installing
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/E-installing
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/E-installing/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/E-installing/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/E-installing/build
$ <span class="token function">make</span>
<span class="token punctuation">[</span> <span class="token number">25</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/cmake_examples_inst.dir/src/Hello.cpp.obj
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Linking CXX shared library libcmake_examples_inst.dll
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Built target cmake_examples_inst
<span class="token punctuation">[</span> <span class="token number">75</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/cmake_examples_inst_bin.dir/src/main.cpp.obj
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable cmake_examples_inst_bin.exe
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target cmake_examples_inst_bin

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/E-installing/build
$ cmake <span class="token parameter variable">--install</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">--prefix</span> <span class="token string">"/f/home/lyf/installdir/"</span>
-- Install configuration: <span class="token string">""</span>
-- Installing: F:/home/lyf/installdir/bin/cmake_examples_inst_bin.exe
-- Installing: F:/home/lyf/installdir/lib/libcmake_examples_inst.dll.a
-- Installing: F:/home/lyf/installdir/bin/libcmake_examples_inst.dll
-- Installing: F:/home/lyf/installdir/include
-- Installing: F:/home/lyf/installdir/include/installing
-- Installing: F:/home/lyf/installdir/include/installing/Hello.h
-- Installing: F:/home/lyf/installdir/etc/cmake-examples.conf

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/E-installing/build
$ <span class="token function">ls</span>
cmake_examples_inst_bin.exe  install_manifest.txt
cmake_install.cmake          libcmake_examples_inst.dll
CMakeCache.txt               libcmake_examples_inst.dll.a
CMakeFiles                   Makefile

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/E-installing/build
$ ./cmake_examples_inst_bin.exe
Hello Install<span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/E-installing/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>The CMake variable <code>CMAKE_INSTALL_PREFIX</code> is used to determine the root of where the files will be installed. If using the <code>cmake --install</code> command, the installation prefix can be overridden via the <code>--prefix</code> argument. For example:</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cmake <span class="token parameter variable">--install</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">--prefix</span> <span class="token string">"/home/myuser/installdir"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Navigate to the install directory and verify that the installed <code>cmake_examples_inst_bin</code> runs.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/home/lyf/installdir
$ tree
<span class="token builtin class-name">.</span>
├── bin
│   ├── cmake_examples_inst_bin.exe
│   └── libcmake_examples_inst.dll
├── etc
│   └── cmake-examples.conf
├── include
│   └── installing
│       └── Hello.h
└── lib
    └── libcmake_examples_inst.dll.a

<span class="token number">5</span> directories, <span class="token number">5</span> files

lyf@DESKTOP-GV2QHKN MINGW64 /f/home/lyf/installdir
$ <span class="token builtin class-name">cd</span> bin/

lyf@DESKTOP-GV2QHKN MINGW64 /f/home/lyf/installdir/bin
$ ./cmake_examples_inst_bin.exe
Hello Install<span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/home/lyf/installdir/bin
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="F-build-type"><a href="#F-build-type" class="headerlink" title="F-build-type"></a>F-build-type</h4><h5 id="Files-5"><a href="#Files-5" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>
<span class="token function">mkdir</span> F-build-type
<span class="token builtin class-name">cd</span> F-build-type<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Set the minimum version of CMake that can be used</span>
<span class="token comment"># To find the cmake version run</span>
<span class="token comment"># $ cmake --version</span>
<span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token comment"># Set a default build type if none was specified</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">NOT</span> <span class="token variable">CMAKE_BUILD_TYPE</span> <span class="token operator">AND</span> <span class="token operator">NOT</span> <span class="token variable">CMAKE_CONFIGURATION_TYPES</span><span class="token punctuation">)</span>
        <span class="token keyword">message</span><span class="token punctuation">(</span><span class="token string">"Setting build type to 'RelWithDebInfo' as none was specified."</span><span class="token punctuation">)</span>
        <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_BUILD_TYPE</span> RelWithDebInfo <span class="token variable">CACHE</span> STRING <span class="token string">"Choose the type of build."</span> FORCE<span class="token punctuation">)</span>
        <span class="token comment"># Set the possible values of build type for cmake-gui</span>
        <span class="token keyword">set_property</span><span class="token punctuation">(</span><span class="token variable">CACHE</span> <span class="token variable">CMAKE_BUILD_TYPE</span> PROPERTY <span class="token property">STRINGS</span> <span class="token string">"Debug"</span> <span class="token string">"Release"</span> <span class="token string">"MinSizeRel"</span> <span class="token string">"RelWithDebInfo"</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>build_type<span class="token punctuation">)</span>

<span class="token comment"># Add an executable</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>cmake_examples_build_type main.cpp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

int main(int argc, char *argv[])
&#123;
        std::cout &lt;&lt; &quot;Hello Build Type!&quot; &lt;&lt; std::endl;
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-5"><a href="#Introduction-5" class="headerlink" title="Introduction"></a>Introduction</h5><p><code>CMake</code> 具有许多内置的生成配置，可用于编译项目。它们指定优化级别以及调试信息是否要包含在二进制文件中。</p>
<p>提供的级别包括：</p>
<ul>
<li><p><code>Release</code> - Adds the <code>-O3 -DNDEBUG</code> flags to the compiler.</p>
</li>
<li><p><code>Debug</code> - Adds the <code>-g</code> flag.</p>
</li>
<li><p><code>MinSizeRel</code> - Adds <code>-Os -DNDEBUG</code>.</p>
</li>
<li><p><code>RelWithDebInfo</code> - Adds <code>-O2 -g -DNDEBUG</code> flags.</p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
└── main.cpp

<span class="token number">0</span> directories, <span class="token number">2</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code>: <code>CMake</code> 的配置文件。</p>
</li>
<li><p><code>main.cpp</code>: main 文件。</p>
</li>
</ul>
<h5 id="Concepts-5"><a href="#Concepts-5" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="Set-Build-Type"><a href="#Set-Build-Type" class="headerlink" title="Set Build Type"></a>Set Build Type</h6><p><code>Passing into cmake</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cmake <span class="token punctuation">..</span> <span class="token parameter variable">-DCMAKE_BUILD_TYPE</span><span class="token operator">=</span>Release<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="Set-Default-Build-Type"><a href="#Set-Default-Build-Type" class="headerlink" title="Set Default Build Type"></a>Set Default Build Type</h6><p><code>CMake</code> 提供的默认生成类型是不包含用于优化的编译器标志。对于某些项目，您可能希望设置默认生成类型，这样就不必记得设置它。</p>
<p>为此，你可以将以下内容添加到顶级 <code>CMakeLists.txt</code>。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">NOT</span> <span class="token variable">CMAKE_BUILD_TYPE</span> <span class="token operator">AND</span> <span class="token operator">NOT</span> <span class="token variable">CMAKE_CONFIGURATION_TYPES</span><span class="token punctuation">)</span>
  <span class="token keyword">message</span><span class="token punctuation">(</span><span class="token string">"Setting build type to 'RelWithDebInfo' as none was specified."</span><span class="token punctuation">)</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_BUILD_TYPE</span> RelWithDebInfo <span class="token variable">CACHE</span> STRING <span class="token string">"Choose the type of build."</span> FORCE<span class="token punctuation">)</span>
  <span class="token comment"># Set the possible values of build type for cmake-gui</span>
  <span class="token keyword">set_property</span><span class="token punctuation">(</span><span class="token variable">CACHE</span> <span class="token variable">CMAKE_BUILD_TYPE</span> PROPERTY <span class="token property">STRINGS</span> <span class="token string">"Debug"</span> <span class="token string">"Release"</span>
    <span class="token string">"MinSizeRel"</span> <span class="token string">"RelWithDebInfo"</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Building-the-Example-4"><a href="#Building-the-Example-4" class="headerlink" title="Building the Example"></a>Building the Example</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
Setting build <span class="token builtin class-name">type</span> to <span class="token string">'RelWithDebInfo'</span> as none was specified.
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build
$ <span class="token function">make</span> <span class="token assign-left variable">VERBOSE</span><span class="token operator">=</span><span class="token number">1</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe -S/F/vscode/cpp_projects/cmake-examples/01-basic/F-build-type -B/F/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build --check-build-system CMakeFiles/Makefile.cmake <span class="token number">0</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build/CMakeFiles /F/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build//CMakeFiles/progress.marks
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/Makefile2 all
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/cmake_examples_build_type.dir/build.make CMakeFiles/cmake_examples_build_type.dir/depend
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build”
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_depends <span class="token string">"MSYS Makefiles"</span> /F/vscode/cpp_projects/cmake-examples/01-basic/F-build-type /F/vscode/cpp_projects/cmake-examples/01-basic/F-build-type /F/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build /F/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build /F/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build/CMakeFiles/cmake_examples_build_type.dir/DependInfo.cmake <span class="token parameter variable">--color</span><span class="token operator">=</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/cmake_examples_build_type.dir/build.make CMakeFiles/cmake_examples_build_type.dir/build
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build”
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/cmake_examples_build_type.dir/main.cpp.obj
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe   <span class="token parameter variable">-O2</span> <span class="token parameter variable">-g</span> <span class="token parameter variable">-DNDEBUG</span> <span class="token parameter variable">-MD</span> <span class="token parameter variable">-MT</span> CMakeFiles/cmake_examples_build_type.dir/main.cpp.obj <span class="token parameter variable">-MF</span> CMakeFiles/cmake_examples_build_type.dir/main.cpp.obj.d <span class="token parameter variable">-o</span> CMakeFiles/cmake_examples_build_type.dir/main.cpp.obj <span class="token parameter variable">-c</span> /F/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/main.cpp
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable cmake_examples_build_type.exe
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> CMakeFiles/cmake_examples_build_type.dir/objects.a
/D/lyf_computer_language/msys64/mingw64/bin/ar.exe qc CMakeFiles/cmake_examples_build_type.dir/objects.a <span class="token string">"CMakeFiles/cmake_examples_build_type.dir/main.cpp.obj"</span>
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe <span class="token parameter variable">-O2</span> <span class="token parameter variable">-g</span> <span class="token parameter variable">-DNDEBUG</span> -Wl,--whole-archive CMakeFiles/cmake_examples_build_type.dir/objects.a -Wl,--no-whole-archive <span class="token parameter variable">-o</span> cmake_examples_build_type.exe -Wl,--out-implib,libcmake_examples_build_type.dll.a -Wl,--major-image-version,0,--minor-image-version,0  <span class="token parameter variable">-lkernel32</span> <span class="token parameter variable">-luser32</span> <span class="token parameter variable">-lgdi32</span> <span class="token parameter variable">-lwinspool</span> <span class="token parameter variable">-lshell32</span> <span class="token parameter variable">-lole32</span> <span class="token parameter variable">-loleaut32</span> <span class="token parameter variable">-luuid</span> <span class="token parameter variable">-lcomdlg32</span> <span class="token parameter variable">-ladvapi32</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build”
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target cmake_examples_build_type
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build”
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build/CMakeFiles <span class="token number">0</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build
$ <span class="token function">ls</span>
cmake_examples_build_type.exe  CMakeCache.txt  Makefile
cmake_install.cmake            CMakeFiles

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build
$ ./cmake_examples_build_type.exe
Hello Build Type<span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/F-build-type/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="G-compile-flags"><a href="#G-compile-flags" class="headerlink" title="G-compile-flags"></a>G-compile-flags</h4><h5 id="Files-6"><a href="#Files-6" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>
<span class="token function">mkdir</span> G-compile-flags
<span class="token builtin class-name">cd</span> G-compile-flags<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token comment"># Set a default C++ compile flag</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_FLAGS</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_CXX_FLAGS</span><span class="token punctuation">&#125;</span></span> -DEX2"</span> <span class="token variable">CACHE</span> STRING <span class="token string">"Set C++ Compiler Flags"</span> FORCE<span class="token punctuation">)</span>

<span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>compile_flags<span class="token punctuation">)</span>

<span class="token comment"># Add an executable</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>cmake_examples_compile_flags main.cpp<span class="token punctuation">)</span>

<span class="token keyword">target_compile_definitions</span><span class="token punctuation">(</span>cmake_examples_compile_flags
        <span class="token namespace">PRIVATE</span> EX3<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include&lt;iostream&gt;

int main(int argc, char *argv[])
&#123;
        std::cout &lt;&lt; &quot;Hello Compile Flags!&quot; &lt;&lt; std::endl;

        &#x2F;&#x2F; only print if compile flag set
#ifdef EX2
        std::cout &lt;&lt; &quot;Hello Compile Flag EX2!&quot; &lt;&lt; std::endl;
#endif

#ifdef EX3
        std::cout &lt;&lt; &quot;Hello Compile Flag Ex3!&quot; &lt;&lt; std::endl;
#endif

        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-6"><a href="#Introduction-6" class="headerlink" title="Introduction"></a>Introduction</h5><p><code>CMake</code> 支持以多种不同的方式设置编译标志：</p>
<ul>
<li><p>使用 <code>target_compile_definitions()</code> 函数。</p>
</li>
<li><p>使用 <code>CMAKE_C_FLAGS</code> 和 <code>CMAKE_CXX_FLAGS</code> 变量。</p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
└── main.cpp

<span class="token number">0</span> directories, <span class="token number">2</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code>: <code>CMake</code> 的配置文件。</p>
</li>
<li><p><code>main.cpp</code>: main 文件。</p>
</li>
</ul>
<h5 id="Concepts-6"><a href="#Concepts-6" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="Set-Per-Target-C-Flags"><a href="#Set-Per-Target-C-Flags" class="headerlink" title="Set Per-Target C++ Flags"></a>Set Per-Target C++ Flags</h6><p>在现代 <code>CMake</code> 中设置 <code>C++</code> 标志的推荐方法是使用 <code>per-target flags</code>，这些标志可以通过 <code>target_compile_definitions()</code> 函数填充到其他目标。这将填充库的 <code>INTERFACE_COMPILE_DEFINITIONS</code>，并根据范围将定义推送到链接的目标。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">target_compile_definitions</span><span class="token punctuation">(</span>cmake_examples_compile_flags
    <span class="token namespace">PRIVATE</span> EX3
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这将导致编译器在编译目标时添加定义 <code>-DEX3</code>。</p>
<p>如果目标是一个库，并且已选择作用域 <code>PUBLIC</code> 或 <code>INTERFACE</code>，则该定义也将包含在链接此目标的任何可执行文件中。</p>
<p>对于编译器选项，您还可以使用 <code>target_compile_options()</code> 函数。</p>
<h6 id="Set-Default-C-Flags"><a href="#Set-Default-C-Flags" class="headerlink" title="Set Default C++ Flags"></a>Set Default C++ Flags</h6><p><code>CMAKE_CXX_FLAGS</code> 的默认值为空或包含生成类型的适当标志。</p>
<p>若要设置额外的默认编译标志，可以将以下内容添加到顶级 <code>CMakeLists.txt</code>。</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_FLAGS</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_CXX_FLAGS</span><span class="token punctuation">&#125;</span></span> -DEX2"</span> <span class="token variable">CACHE</span> STRING <span class="token string">"Set C++ Compiler Flags"</span> FORCE<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>与 <code>CMAKE_CXX_FLAGS</code> 类似，其他选项包括：</p>
<ul>
<li><p>使用 <code>CMAKE_C_FLAGS</code> 设置 <code>C</code> 编译器标志。</p>
</li>
<li><p>使用 <code>CMAKE_LINKER_FLAGS</code> 设置链接器标志。</p>
</li>
</ul>
<blockquote>
<p>The values <code>CACHE STRING &quot;Set C++ Compiler Flags&quot; FORCE</code> from the above command are used to force this variable to be set in the <code>CMakeCache.txt</code> file.</p>
</blockquote>
<p>Once set the <code>CMAKE_C_FLAGS</code> and <code>CMAKE_CXX_FLAGS</code> will set a compiler flag &#x2F; definition globally for all targets in this directory or any included sub-directories. This method is not recommended for general usage now and the <code>target_compile_definitions</code> function is preferred.</p>
<h6 id="Set-CMake-Flags"><a href="#Set-CMake-Flags" class="headerlink" title="Set CMake Flags"></a>Set CMake Flags</h6><p>Similar to the <code>build type</code> a global C++ compiler flag can be set using the following methods.</p>
<p><code>Passing into cmake</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cmake <span class="token punctuation">..</span> <span class="token parameter variable">-DCMAKE_CXX_FLAGS</span><span class="token operator">=</span><span class="token string">"-DEX3"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="Building-the-Example-5"><a href="#Building-the-Example-5" class="headerlink" title="Building the Example"></a>Building the Example</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build
$ <span class="token function">make</span> <span class="token assign-left variable">VERBOSE</span><span class="token operator">=</span><span class="token number">1</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe -S/F/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags -B/F/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build --check-build-system CMakeFiles/Makefile.cmake <span class="token number">0</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build/CMakeFiles /F/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build//CMakeFiles/progress.marks
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/Makefile2 all
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/cmake_examples_compile_flags.dir/build.make CMakeFiles/cmake_examples_compile_flags.dir/depend
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build”
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_depends <span class="token string">"MSYS Makefiles"</span> /F/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags /F/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags /F/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build /F/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build /F/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build/CMakeFiles/cmake_examples_compile_flags.dir/DependInfo.cmake <span class="token parameter variable">--color</span><span class="token operator">=</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/cmake_examples_compile_flags.dir/build.make CMakeFiles/cmake_examples_compile_flags.dir/build
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build”
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/cmake_examples_compile_flags.dir/main.cpp.obj
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe <span class="token parameter variable">-DEX3</span>  <span class="token parameter variable">-DEX2</span> <span class="token parameter variable">-MD</span> <span class="token parameter variable">-MT</span> CMakeFiles/cmake_examples_compile_flags.dir/main.cpp.obj <span class="token parameter variable">-MF</span> CMakeFiles/cmake_examples_compile_flags.dir/main.cpp.obj.d <span class="token parameter variable">-o</span> CMakeFiles/cmake_examples_compile_flags.dir/main.cpp.obj <span class="token parameter variable">-c</span> /F/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/main.cpp
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable cmake_examples_compile_flags.exe
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> CMakeFiles/cmake_examples_compile_flags.dir/objects.a
/D/lyf_computer_language/msys64/mingw64/bin/ar.exe qc CMakeFiles/cmake_examples_compile_flags.dir/objects.a <span class="token string">"CMakeFiles/cmake_examples_compile_flags.dir/main.cpp.obj"</span>
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe  <span class="token parameter variable">-DEX2</span> -Wl,--whole-archive CMakeFiles/cmake_examples_compile_flags.dir/objects.a -Wl,--no-whole-archive <span class="token parameter variable">-o</span> cmake_examples_compile_flags.exe -Wl,--out-implib,libcmake_examples_compile_flags.dll.a -Wl,--major-image-version,0,--minor-image-version,0  <span class="token parameter variable">-lkernel32</span> <span class="token parameter variable">-luser32</span> <span class="token parameter variable">-lgdi32</span> <span class="token parameter variable">-lwinspool</span> <span class="token parameter variable">-lshell32</span> <span class="token parameter variable">-lole32</span> <span class="token parameter variable">-loleaut32</span> <span class="token parameter variable">-luuid</span> <span class="token parameter variable">-lcomdlg32</span> <span class="token parameter variable">-ladvapi32</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build”
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target cmake_examples_compile_flags
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build”
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build/CMakeFiles <span class="token number">0</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build
$ <span class="token function">ls</span>
cmake_examples_compile_flags.exe  CMakeCache.txt  Makefile
cmake_install.cmake               CMakeFiles

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build
$ ./cmake_examples_compile_flags.exe
Hello Compile Flags<span class="token operator">!</span>
Hello Compile Flag EX2<span class="token operator">!</span>
Hello Compile Flag Ex3<span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/G-compile-flags/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="H-third-party-library"><a href="#H-third-party-library" class="headerlink" title="H-third-party-library"></a>H-third-party-library</h4><h5 id="Files-7"><a href="#Files-7" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>
<span class="token function">mkdir</span> H-third-party-library
<span class="token builtin class-name">cd</span> H-third-party-library<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>third_party_include<span class="token punctuation">)</span>

<span class="token comment"># find a boost install with the libraries filesystem and system</span>
<span class="token keyword">find_package</span><span class="token punctuation">(</span>Boost <span class="token number">1.46.1</span> REQUIRED COMPONENTS filesystem system<span class="token punctuation">)</span>

<span class="token comment"># check if boost was found</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>Boost_FOUND<span class="token punctuation">)</span>
        <span class="token keyword">message</span><span class="token punctuation">(</span><span class="token string">"boost found"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">message</span><span class="token punctuation">(</span>FATAL_ERROR <span class="token string">"Cannot find Boost"</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Add an executable</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>third_party_include main.cpp<span class="token punctuation">)</span>

<span class="token comment"># link against the boost libraries</span>
<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>third_party_include
        <span class="token namespace">PRIVATE</span>
        <span class="token inserted class-name">Boost::filesystem</span>
        <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;
#include &lt;boost&#x2F;shared_ptr.hpp&gt;
#include &lt;boost&#x2F;filesystem.hpp&gt;

int main(int argc, char *argv[])
&#123;
        std::cout &lt;&lt; &quot;Hello Third Party Include!&quot; &lt;&lt; std::endl;

        &#x2F;&#x2F; use a shared ptr
        boost::shared_ptr&lt;int&gt; isp(new int(4));

        &#x2F;&#x2F; trivial use of boost filesystem
        boost::filesystem::path path &#x3D; &quot;&#x2F;usr&#x2F;share&#x2F;cmake&#x2F;modules&quot;;
        if(path.is_relative())
        &#123;
                std::cout &lt;&lt; &quot;Path is relative&quot; &lt;&lt; std::endl;
        &#125;
        else
        &#123;
                std::cout &lt;&lt; &quot;Path is not relative&quot; &lt;&lt; std::endl;
        &#125;

        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-7"><a href="#Introduction-7" class="headerlink" title="Introduction"></a>Introduction</h5><p>几乎所有重要的项目都需要包含第三方库、头文件或程序。<code>CMake</code> 支持使用 <code>find_package()</code> 函数查找这些工具的路径。这将从 <code>CMAKE_MODULE_PATH</code> 中的文件夹列表中搜索格式为 <code>FindXXX.cmake</code> 的 <code>CMake</code> 模块。在 <code>linux</code> 上，默认搜索路径将包括 <code>/usr/share/cmake/Modules</code>。</p>
<p>本教程中的文件如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/H-third-party-library
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
└── main.cpp

<span class="token number">0</span> directories, <span class="token number">2</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code>: <code>CMake</code> 的配置文件。</p>
</li>
<li><p><code>main.cpp</code>: main 文件。</p>
</li>
</ul>
<h5 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h5><p>此示例要求 <code>boost</code> 安装在默认系统位置。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman <span class="token parameter variable">-S</span> mingw-w64-x86_64-boost<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="Concepts-7"><a href="#Concepts-7" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="Finding-a-Package"><a href="#Finding-a-Package" class="headerlink" title="Finding a Package"></a>Finding a Package</h6><p>As mentioned above the <code>find_package()</code> function will search for CMake modules in the formant “FindXXX.cmake” from the list of folders in <code>CMAKE_MODULE_PATH</code>. The exact format of the arguments to <code>find_package</code> will depend on the module you are looking for. This is typically documented at the top of the <code>FindXXX.cmake</code> file.</p>
<p>A basic example of finding <code>boost</code> is below:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">find_package</span><span class="token punctuation">(</span>Boost <span class="token number">1.46.1</span> REQUIRED COMPONENTS filesystem system<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>The arguments are:</p>
<ul>
<li><p><code>Boost</code> - Name of the library. This is part of used to find the module file <code>FindBoost.cmake</code>.</p>
</li>
<li><p><code>1.46.1</code> - The minimum version of <code>boost</code> to find.</p>
</li>
<li><p><code>REQUIRED</code> - Tells the module that this is required and to fail if it cannot be found.</p>
</li>
<li><p><code>COMPONENTS</code> - The list of components to find in the library.</p>
</li>
</ul>
<p><code>Boost</code> includes can take more arguments and also make use of other variables. </p>
<h6 id="Checking-if-the-package-is-found"><a href="#Checking-if-the-package-is-found" class="headerlink" title="Checking if the package is found"></a>Checking if the package is found</h6><p>Most included packages will set a variable <code>XXX_FOUND</code>, which can be used to check if the package is available on the system.</p>
<p>In this example the variable is <code>Boost_FOUND</code>:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">if</span><span class="token punctuation">(</span>Boost_FOUND<span class="token punctuation">)</span>
    <span class="token keyword">message</span> <span class="token punctuation">(</span><span class="token string">"boost found"</span><span class="token punctuation">)</span>
    <span class="token keyword">include_directories</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span>Boost_INCLUDE_DIRS<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">message</span> <span class="token punctuation">(</span>FATAL_ERROR <span class="token string">"Cannot find Boost"</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="Exported-Variables"><a href="#Exported-Variables" class="headerlink" title="Exported Variables"></a>Exported Variables</h6><p>After a package is found it will often export variables which can inform the user where to find the library, header, or executable files. Similar to the <code>XXX_FOUND</code> variable, these are package specific and are typically documented at the top of the <code>FindXXX.cmake</code> file.</p>
<p>The variables exported in this example include:</p>
<ul>
<li><code>Boost_INCLUDE_DIRS</code> - The path to the boost header files.</li>
</ul>
<p>In some cases you can also check these variables by examining the cache using ccmake or cmake-gui.</p>
<h6 id="Alias-Imported-targets"><a href="#Alias-Imported-targets" class="headerlink" title="Alias &#x2F; Imported targets"></a>Alias &#x2F; Imported targets</h6><p>Most modern CMake libraries export ALIAS targets in their module files. The benefit of imported targets are that they can also populate include directories and linked libraries.</p>
<p>For example, starting from v3.5+ of CMake, the Boost module supports this. Similar to using your own ALIAS target for libraires, an ALIAS in a module can make referencing found targets easier.</p>
<p>In the case of Boost, all targets are exported using the <code>Boost::</code> identifier and then the name of the subsystem. For example you can use:</p>
<ul>
<li><p><code>Boost::boost</code> for header only libraries</p>
</li>
<li><p><code>Boost::system</code> for the boost system library.</p>
</li>
<li><p><code>Boost::filesystem</code> for filesystem library.</p>
</li>
</ul>
<p>As with your own targets, these targets include their dependencies, so linking against <code>Boost::filesystem</code> will automatically add <code>Boost::boost</code> and <code>Boost::system</code> dependencies.</p>
<p>To link against an imported target you can use the following:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>third_party_include
        <span class="token namespace">PRIVATE</span>
        <span class="token inserted class-name">Boost::filesystem</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="Non-alias-targets"><a href="#Non-alias-targets" class="headerlink" title="Non-alias targets"></a>Non-alias targets</h6><p>While most modern libraries use imported targets, not all modules have been updated. In the case where a library hasn’t been updated you will often find the following variables available:</p>
<ul>
<li><p><code>xxx_INCLUDE_DIRS</code> - A variable pointing to the include directory for the library.</p>
</li>
<li><p><code>xxx_LIBRARY</code> - A variable pointing to the library path.</p>
</li>
</ul>
<p>These can then be added to your <code>target_include_directories</code> and <code>target_link_libraries</code> as:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Include the boost headers</span>
<span class="token keyword">target_include_directories</span><span class="token punctuation">(</span> third_party_include
    <span class="token namespace">PRIVATE</span> <span class="token punctuation">$&#123;</span>Boost_INCLUDE_DIRS<span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span>

<span class="token comment"># link against the boost libraries</span>
<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span> third_party_include
    <span class="token namespace">PRIVATE</span>
    <span class="token punctuation">$&#123;</span>Boost_SYSTEM_LIBRARY<span class="token punctuation">&#125;</span>
    <span class="token punctuation">$&#123;</span>Boost_FILESYSTEM_LIBRARY<span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Building-the-Example-6"><a href="#Building-the-Example-6" class="headerlink" title="Building the Example"></a>Building the Example</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/H-third-party-library
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/H-third-party-library
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/H-third-party-library/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Found Boost: D:/lyf_computer_language/msys64/mingw64/include <span class="token punctuation">(</span>found suitable version <span class="token string">"1.79.0"</span>, minimum required is <span class="token string">"1.46.1"</span><span class="token punctuation">)</span> found components: filesystem system
boost found
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/H-third-party-library/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/H-third-party-library/build
$ <span class="token function">make</span>
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/third_party_include.dir/main.cpp.obj
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable third_party_include.exe
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target third_party_include

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/H-third-party-library/build
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeFiles  third_party_include.exe
CMakeCache.txt       Makefile

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/H-third-party-library/build
$ ./third_party_include.exe
Hello Third Party Include<span class="token operator">!</span>
Path is relative

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/H-third-party-library/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="I-compiling-with-clang"><a href="#I-compiling-with-clang" class="headerlink" title="I-compiling-with-clang"></a>I-compiling-with-clang</h4><h5 id="Files-8"><a href="#Files-8" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MSYS”，安装 <code>Clang toolchain</code>。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman <span class="token parameter variable">-S</span> <span class="token parameter variable">--needed</span> base-devel mingw-w64-clang-x86_64-toolchain
pacman <span class="token parameter variable">-S</span> cmake<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="2">
<li>运行开始菜单的 “MSYS2 MinGW Clang x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /f/vscode/cpp_projects/cmake-examples/01-basic/
<span class="token function">mkdir</span> I-compiling-with-clang
<span class="token builtin class-name">cd</span> I-compiling-with-clang<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Set the minimum version of CMake that can be used</span>
<span class="token comment"># To find the cmake version run</span>
<span class="token comment"># $ cmake --version</span>
<span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>hello_cmake<span class="token punctuation">)</span>

<span class="token comment"># Add an executable</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello_cmake main.cpp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>创建 <code>main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

int main(int argc, char *argv[])
&#123;
        std::cout &lt;&lt; &quot;Hello CMake!&quot; &lt;&lt; std::endl;
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-8"><a href="#Introduction-8" class="headerlink" title="Introduction"></a>Introduction</h5><p>使用 <code>CMake</code> 构建时，可以设置 <code>C</code> 和 <code>C++</code> 编译器。</p>
<p>本教程中的文件如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/01-basic/I-compiling-with-clang
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
└── main.cpp

<span class="token number">0</span> directories, <span class="token number">2</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code>: <code>CMake</code> 的配置文件。</p>
</li>
<li><p><code>main.cpp</code>: main 文件。</p>
</li>
</ul>
<h5 id="Concepts-8"><a href="#Concepts-8" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="Compiler-Option"><a href="#Compiler-Option" class="headerlink" title="Compiler Option"></a>Compiler Option</h6><p><code>CMake</code> exposes options to control the programs used to compile and link your code. These programs include:</p>
<ul>
<li><p><code>CMAKE_C_COMPILER</code> - The program used to compile <code>c</code> code.</p>
</li>
<li><p><code>CMAKE_CXX_COMPILER</code> - The program used to compile <code>c++</code> code.</p>
</li>
<li><p><code>CMAKE_LINKER</code> - The program used to link your binary.</p>
</li>
</ul>
<h6 id="Setting-Flags"><a href="#Setting-Flags" class="headerlink" title="Setting Flags"></a>Setting Flags</h6><p>As described in the <code>Build Type</code> example, you can set <code>CMake options</code> using either a cmake gui or by passing from the command line.</p>
<p>Below is an example of passing the compiler via <code>the command line</code>.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cmake <span class="token punctuation">..</span> <span class="token parameter variable">-DCMAKE_C_COMPILER</span><span class="token operator">=</span>clang-3.6 <span class="token parameter variable">-DCMAKE_CXX_COMPILER</span><span class="token operator">=</span>clang++-3.6<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>After setting these options, when your run <code>make</code> clang will be used to compile your binary. </p>
<h5 id="Building-the-Examples"><a href="#Building-the-Examples" class="headerlink" title="Building the Examples"></a>Building the Examples</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/01-basic/I-compiling-with-clang
$ <span class="token function">mkdir</span> build.clang

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/01-basic/I-compiling-with-clang
$ <span class="token builtin class-name">cd</span> build.clang/

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/01-basic/I-compiling-with-clang/build.clang
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-DCMAKE_C_COMPILER</span><span class="token operator">=</span>clang <span class="token parameter variable">-DCMAKE_CXX_COMPILER</span><span class="token operator">=</span>clang++
-- The C compiler identification is Clang <span class="token number">14.0</span>.4
-- The CXX compiler identification is Clang <span class="token number">14.0</span>.4
System is unknown to cmake, create:
Platform/MINGW64_NT-10.0-19044 to use this system, please post your config <span class="token function">file</span> on discourse.cmake.org so it can be added to cmake
-- Detecting C compiler ABI info
System is unknown to cmake, create:
Platform/MINGW64_NT-10.0-19044 to use this system, please post your config <span class="token function">file</span> on discourse.cmake.org so it can be added to cmake
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: /clang64/bin/clang.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
System is unknown to cmake, create:
Platform/MINGW64_NT-10.0-19044 to use this system, please post your config <span class="token function">file</span> on discourse.cmake.org so it can be added to cmake
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: /clang64/bin/clang++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: /f/vscode/cpp_projects/cmake-examples/01-basic/I-compiling-with-clang/build.clang

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/01-basic/I-compiling-with-clang/build.clang
$ <span class="token function">make</span>
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello_cmake.dir/main.cpp.obj
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable hello_cmake
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target hello_cmake

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/01-basic/I-compiling-with-clang/build.clang
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeCache.txt  CMakeFiles  hello_cmake.exe  Makefile

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/01-basic/I-compiling-with-clang/build.clang
$ ./hello_cmake.exe
Hello CMake<span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/01-basic/I-compiling-with-clang/build.clang
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="J-building-with-ninja"><a href="#J-building-with-ninja" class="headerlink" title="J-building-with-ninja"></a>J-building-with-ninja</h4><h5 id="Files-9"><a href="#Files-9" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /f/vscode/cpp_projects/cmake-examples/01-basic/
<span class="token function">mkdir</span> J-building-with-ninja
<span class="token builtin class-name">cd</span> J-building-with-ninja<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Set the minimum version of CMake that can be used</span>
<span class="token comment"># To find the cmake version run</span>
<span class="token comment"># $ cmake --version</span>
<span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>hello_cmake<span class="token punctuation">)</span>

<span class="token comment"># Add an executable</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello_cmake main.cpp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

int main(int argc, char *argv[])
&#123;
        std::cout &lt;&lt; &quot;Hello CMake!&quot; &lt;&lt; std::endl;
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-9"><a href="#Introduction-9" class="headerlink" title="Introduction"></a>Introduction</h5><p>As mentioned, CMake is a meta-build system that can be used to create the build files for many other build tools. This example shows how to have CMake use the <code>ninja</code> build tool.</p>
<p>The files in this tutorial are below:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/J-building-with-ninja
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
└── main.cpp

<span class="token number">0</span> directories, <span class="token number">2</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code> - Contains the CMake commands you wish to run.</p>
</li>
<li><p><code>main.cpp</code> - A simple “Hello World” cpp file.</p>
</li>
</ul>
<h5 id="Concepts-9"><a href="#Concepts-9" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="Generators"><a href="#Generators" class="headerlink" title="Generators"></a>Generators</h6><p>CMake generators are responsible for writing the input files (e.g. Makefiles) for the underlying build system. Running <code>cmake --help</code> will show the generators available.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/J-building-with-ninja
$ cmake <span class="token parameter variable">--help</span>
Usage

  cmake <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>path-to-source<span class="token operator">></span>
  cmake <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>path-to-existing-build<span class="token operator">></span>
  cmake <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token parameter variable">-S</span> <span class="token operator">&lt;</span>path-to-source<span class="token operator">></span> <span class="token parameter variable">-B</span> <span class="token operator">&lt;</span>path-to-build<span class="token operator">></span>

Specify a <span class="token builtin class-name">source</span> directory to <span class="token punctuation">(</span>re-<span class="token punctuation">)</span>generate a build system <span class="token keyword">for</span> <span class="token for-or-select variable">it</span> <span class="token keyword">in</span> the
current working directory.  Specify an existing build directory to
re-generate its build system.

Options
  <span class="token parameter variable">-S</span> <span class="token operator">&lt;</span>path-to-source<span class="token operator">></span>          <span class="token operator">=</span> Explicitly specify a <span class="token builtin class-name">source</span> directory.
  <span class="token parameter variable">-B</span> <span class="token operator">&lt;</span>path-to-build<span class="token operator">></span>           <span class="token operator">=</span> Explicitly specify a build directory.
  <span class="token parameter variable">-C</span> <span class="token operator">&lt;</span>initial-cache<span class="token operator">></span>           <span class="token operator">=</span> Pre-load a script to populate the cache.
  <span class="token parameter variable">-D</span> <span class="token operator">&lt;</span>var<span class="token operator">></span><span class="token punctuation">[</span>:<span class="token operator">&lt;</span>type<span class="token operator">></span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&lt;</span>value<span class="token operator">></span>    <span class="token operator">=</span> Create or update a cmake cache entry.
  <span class="token parameter variable">-U</span> <span class="token operator">&lt;</span>globbing_expr<span class="token operator">></span>           <span class="token operator">=</span> Remove matching entries from CMake cache.
  <span class="token parameter variable">-G</span> <span class="token operator">&lt;</span>generator-name<span class="token operator">></span>          <span class="token operator">=</span> Specify a build system generator.
  <span class="token parameter variable">-T</span> <span class="token operator">&lt;</span>toolset-name<span class="token operator">></span>            <span class="token operator">=</span> Specify toolset name <span class="token keyword">if</span> supported by
                                 generator.
  <span class="token parameter variable">-A</span> <span class="token operator">&lt;</span>platform-name<span class="token operator">></span>           <span class="token operator">=</span> Specify platform name <span class="token keyword">if</span> supported by
                                 generator.
  <span class="token parameter variable">--toolchain</span> <span class="token operator">&lt;</span>file<span class="token operator">></span>           <span class="token operator">=</span> Specify toolchain <span class="token function">file</span>
                                 <span class="token punctuation">[</span>CMAKE_TOOLCHAIN_FILE<span class="token punctuation">]</span>.
  --install-prefix <span class="token operator">&lt;</span>directory<span class="token operator">></span> <span class="token operator">=</span> Specify <span class="token function">install</span> directory
                                 <span class="token punctuation">[</span>CMAKE_INSTALL_PREFIX<span class="token punctuation">]</span>.
  <span class="token parameter variable">-Wdev</span>                        <span class="token operator">=</span> Enable developer warnings.
  -Wno-dev                     <span class="token operator">=</span> Suppress developer warnings.
  <span class="token parameter variable">-Werror</span><span class="token operator">=</span>dev                  <span class="token operator">=</span> Make developer warnings errors.
  -Wno-error<span class="token operator">=</span>dev               <span class="token operator">=</span> Make developer warnings not errors.
  <span class="token parameter variable">-Wdeprecated</span>                 <span class="token operator">=</span> Enable deprecation warnings.
  -Wno-deprecated              <span class="token operator">=</span> Suppress deprecation warnings.
  <span class="token parameter variable">-Werror</span><span class="token operator">=</span>deprecated           <span class="token operator">=</span> Make deprecated macro and <span class="token keyword">function</span> warnings
                                 errors.
  -Wno-error<span class="token operator">=</span>deprecated        <span class="token operator">=</span> Make deprecated macro and <span class="token keyword">function</span> warnings
                                 not errors.
  <span class="token parameter variable">--preset</span> <span class="token operator">&lt;</span>preset<span class="token operator">></span>,--preset<span class="token operator">=</span><span class="token operator">&lt;</span>preset<span class="token operator">></span>
                               <span class="token operator">=</span> Specify a configure preset.
  --list-presets               <span class="token operator">=</span> List available presets.
  <span class="token parameter variable">-E</span>                           <span class="token operator">=</span> CMake <span class="token builtin class-name">command</span> mode.
  -L<span class="token punctuation">[</span>A<span class="token punctuation">]</span><span class="token punctuation">[</span>H<span class="token punctuation">]</span>                     <span class="token operator">=</span> List non-advanced cached variables.
  <span class="token parameter variable">--build</span> <span class="token operator">&lt;</span>dir<span class="token operator">></span>                <span class="token operator">=</span> Build a CMake-generated project binary tree.

  <span class="token parameter variable">--install</span> <span class="token operator">&lt;</span>dir<span class="token operator">></span>              <span class="token operator">=</span> Install a CMake-generated project binary
                                 tree.
  <span class="token parameter variable">--open</span> <span class="token operator">&lt;</span>dir<span class="token operator">></span>                 <span class="token operator">=</span> Open generated project <span class="token keyword">in</span> the associated
                                 application.
  <span class="token parameter variable">-N</span>                           <span class="token operator">=</span> View mode only.
  <span class="token parameter variable">-P</span> <span class="token operator">&lt;</span>file<span class="token operator">></span>                    <span class="token operator">=</span> Process script mode.
  --find-package               <span class="token operator">=</span> Legacy pkg-config like mode.  Do not use.
  <span class="token parameter variable">--graphviz</span><span class="token operator">=</span><span class="token punctuation">[</span>file<span class="token punctuation">]</span>            <span class="token operator">=</span> Generate graphviz of dependencies, see
                                 CMakeGraphVizOptions.cmake <span class="token keyword">for</span> more.
  --system-information <span class="token punctuation">[</span>file<span class="token punctuation">]</span>  <span class="token operator">=</span> Dump information about this system.
  --log-level<span class="token operator">=</span><span class="token operator">&lt;</span>ERROR<span class="token operator">|</span>WARNING<span class="token operator">|</span>NOTICE<span class="token operator">|</span>STATUS<span class="token operator">|</span>VERBOSE<span class="token operator">|</span>DEBUG<span class="token operator">|</span>TRACE<span class="token operator">></span>
                               <span class="token operator">=</span> Set the verbosity of messages from CMake
                                 files.  <span class="token parameter variable">--loglevel</span> is also accepted <span class="token keyword">for</span>
                                 backward compatibility reasons.
  --log-context                <span class="token operator">=</span> Prepend log messages with context, <span class="token keyword">if</span> given
  --debug-trycompile           <span class="token operator">=</span> Do not delete the try_compile build tree.
                                 Only useful on one try_compile at a time.
  --debug-output               <span class="token operator">=</span> Put cmake <span class="token keyword">in</span> a debug mode.
  --debug-find                 <span class="token operator">=</span> Put cmake <span class="token function">find</span> <span class="token keyword">in</span> a debug mode.
  --debug-find-pkg<span class="token operator">=</span><span class="token operator">&lt;</span>pkg-name<span class="token operator">></span><span class="token punctuation">[</span>,<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
                               <span class="token operator">=</span> Limit cmake debug-find to the
                                 comma-separated list of packages
  --debug-find-var<span class="token operator">=</span><span class="token operator">&lt;</span>var-name<span class="token operator">></span><span class="token punctuation">[</span>,<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
                               <span class="token operator">=</span> Limit cmake debug-find to the
                                 comma-separated list of result variables
  <span class="token parameter variable">--trace</span>                      <span class="token operator">=</span> Put cmake <span class="token keyword">in</span> trace mode.
  --trace-expand               <span class="token operator">=</span> Put cmake <span class="token keyword">in</span> trace mode with variable
                                 expansion.
  --trace-format<span class="token operator">=</span><span class="token operator">&lt;</span>human<span class="token operator">|</span>json-v<span class="token operator"><span class="token file-descriptor important">1</span>></span>
                               <span class="token operator">=</span> Set the output <span class="token function">format</span> of the trace.
  --trace-source<span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">></span>        <span class="token operator">=</span> Trace only this CMake file/module.  Multiple

                                 options allowed.
  --trace-redirect<span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">></span>      <span class="token operator">=</span> Redirect trace output to a <span class="token function">file</span> instead of
                                 stderr.
  --warn-uninitialized         <span class="token operator">=</span> Warn about uninitialized values.
  --no-warn-unused-cli         <span class="token operator">=</span> Don't warn about <span class="token builtin class-name">command</span> line options.
  --check-system-vars          <span class="token operator">=</span> Find problems with variable usage <span class="token keyword">in</span> system
                                 files.
  --profiling-format<span class="token operator">=</span><span class="token operator">&lt;</span>fmt<span class="token operator">></span>     <span class="token operator">=</span> Output data <span class="token keyword">for</span> profiling CMake scripts.
                                 Supported formats: google-trace
  --profiling-output<span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">></span>    <span class="token operator">=</span> Select an output path <span class="token keyword">for</span> the profiling data

                                 enabled through --profiling-format.
  --help,-help,-usage,-h,-H,/? <span class="token operator">=</span> Print usage information and exit.
  --version,-version,/V <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>  <span class="token operator">=</span> Print version number and exit.
  --help-full <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>            <span class="token operator">=</span> Print all <span class="token builtin class-name">help</span> manuals and exit.
  --help-manual <span class="token operator">&lt;</span>man<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>    <span class="token operator">=</span> Print one <span class="token builtin class-name">help</span> manual and exit.
  --help-manual-list <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>     <span class="token operator">=</span> List <span class="token builtin class-name">help</span> manuals available and exit.
  --help-command <span class="token operator">&lt;</span>cmd<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>   <span class="token operator">=</span> Print <span class="token builtin class-name">help</span> <span class="token keyword">for</span> one <span class="token builtin class-name">command</span> and exit.
  --help-command-list <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>    <span class="token operator">=</span> List commands with <span class="token builtin class-name">help</span> available and exit.
  --help-commands <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>        <span class="token operator">=</span> Print cmake-commands manual and exit.
  --help-module <span class="token operator">&lt;</span>mod<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>    <span class="token operator">=</span> Print <span class="token builtin class-name">help</span> <span class="token keyword">for</span> one module and exit.
  --help-module-list <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>     <span class="token operator">=</span> List modules with <span class="token builtin class-name">help</span> available and exit.
  --help-modules <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>         <span class="token operator">=</span> Print cmake-modules manual and exit.
  --help-policy <span class="token operator">&lt;</span>cmp<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>    <span class="token operator">=</span> Print <span class="token builtin class-name">help</span> <span class="token keyword">for</span> one policy and exit.
  --help-policy-list <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>     <span class="token operator">=</span> List policies with <span class="token builtin class-name">help</span> available and exit.
  --help-policies <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>        <span class="token operator">=</span> Print cmake-policies manual and exit.
  --help-property <span class="token operator">&lt;</span>prop<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span> <span class="token operator">=</span> Print <span class="token builtin class-name">help</span> <span class="token keyword">for</span> one property and exit.
  --help-property-list <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>   <span class="token operator">=</span> List properties with <span class="token builtin class-name">help</span> available and
                                 exit.
  --help-properties <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>      <span class="token operator">=</span> Print cmake-properties manual and exit.
  --help-variable var <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>    <span class="token operator">=</span> Print <span class="token builtin class-name">help</span> <span class="token keyword">for</span> one variable and exit.
  --help-variable-list <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>   <span class="token operator">=</span> List variables with <span class="token builtin class-name">help</span> available and exit.

  --help-variables <span class="token punctuation">[</span><span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token punctuation">]</span>       <span class="token operator">=</span> Print cmake-variables manual and exit.

Generators

The following generators are available on this platform <span class="token punctuation">(</span>* marks default<span class="token punctuation">)</span>:
  Visual Studio <span class="token number">17</span> <span class="token number">2022</span>        <span class="token operator">=</span> Generates Visual Studio <span class="token number">2022</span> project files.
                                 Use <span class="token parameter variable">-A</span> option to specify architecture.
  Visual Studio <span class="token number">16</span> <span class="token number">2019</span>        <span class="token operator">=</span> Generates Visual Studio <span class="token number">2019</span> project files.
                                 Use <span class="token parameter variable">-A</span> option to specify architecture.
  Visual Studio <span class="token number">15</span> <span class="token number">2017</span> <span class="token punctuation">[</span>arch<span class="token punctuation">]</span> <span class="token operator">=</span> Generates Visual Studio <span class="token number">2017</span> project files.
                                 Optional <span class="token punctuation">[</span>arch<span class="token punctuation">]</span> can be <span class="token string">"Win64"</span> or <span class="token string">"ARM"</span><span class="token builtin class-name">.</span>
  Visual Studio <span class="token number">14</span> <span class="token number">2015</span> <span class="token punctuation">[</span>arch<span class="token punctuation">]</span> <span class="token operator">=</span> Generates Visual Studio <span class="token number">2015</span> project files.
                                 Optional <span class="token punctuation">[</span>arch<span class="token punctuation">]</span> can be <span class="token string">"Win64"</span> or <span class="token string">"ARM"</span><span class="token builtin class-name">.</span>
  Visual Studio <span class="token number">12</span> <span class="token number">2013</span> <span class="token punctuation">[</span>arch<span class="token punctuation">]</span> <span class="token operator">=</span> Generates Visual Studio <span class="token number">2013</span> project files.
                                 Optional <span class="token punctuation">[</span>arch<span class="token punctuation">]</span> can be <span class="token string">"Win64"</span> or <span class="token string">"ARM"</span><span class="token builtin class-name">.</span>
  Visual Studio <span class="token number">11</span> <span class="token number">2012</span> <span class="token punctuation">[</span>arch<span class="token punctuation">]</span> <span class="token operator">=</span> Generates Visual Studio <span class="token number">2012</span> project files.
                                 Optional <span class="token punctuation">[</span>arch<span class="token punctuation">]</span> can be <span class="token string">"Win64"</span> or <span class="token string">"ARM"</span><span class="token builtin class-name">.</span>
  Visual Studio <span class="token number">10</span> <span class="token number">2010</span> <span class="token punctuation">[</span>arch<span class="token punctuation">]</span> <span class="token operator">=</span> Deprecated.  Generates Visual Studio <span class="token number">2010</span>
                                 project files.  Optional <span class="token punctuation">[</span>arch<span class="token punctuation">]</span> can be
                                 <span class="token string">"Win64"</span> or <span class="token string">"IA64"</span><span class="token builtin class-name">.</span>
  Visual Studio <span class="token number">9</span> <span class="token number">2008</span> <span class="token punctuation">[</span>arch<span class="token punctuation">]</span>  <span class="token operator">=</span> Generates Visual Studio <span class="token number">2008</span> project files.
                                 Optional <span class="token punctuation">[</span>arch<span class="token punctuation">]</span> can be <span class="token string">"Win64"</span> or <span class="token string">"IA64"</span><span class="token builtin class-name">.</span>
  Borland Makefiles            <span class="token operator">=</span> Generates Borland makefiles.
  NMake Makefiles              <span class="token operator">=</span> Generates NMake makefiles.
  NMake Makefiles JOM          <span class="token operator">=</span> Generates JOM makefiles.
  MSYS Makefiles               <span class="token operator">=</span> Generates MSYS makefiles.
  MinGW Makefiles              <span class="token operator">=</span> Generates a <span class="token function">make</span> <span class="token function">file</span> <span class="token keyword">for</span> use with
                                 mingw32-make.
  Green Hills MULTI            <span class="token operator">=</span> Generates Green Hills MULTI files
                                 <span class="token punctuation">(</span>experimental, work-in-progress<span class="token punctuation">)</span>.
  Unix Makefiles               <span class="token operator">=</span> Generates standard UNIX makefiles.
* Ninja                        <span class="token operator">=</span> Generates build.ninja files.
  Ninja Multi-Config           <span class="token operator">=</span> Generates build-<span class="token operator">&lt;</span>Config<span class="token operator">></span>.ninja files.
  Watcom WMake                 <span class="token operator">=</span> Generates Watcom WMake makefiles.
  CodeBlocks - MinGW Makefiles <span class="token operator">=</span> Generates CodeBlocks project files.
  CodeBlocks - NMake Makefiles <span class="token operator">=</span> Generates CodeBlocks project files.
  CodeBlocks - NMake Makefiles JOM
                               <span class="token operator">=</span> Generates CodeBlocks project files.
  CodeBlocks - Ninja           <span class="token operator">=</span> Generates CodeBlocks project files.
  CodeBlocks - Unix Makefiles  <span class="token operator">=</span> Generates CodeBlocks project files.
  CodeLite - MinGW Makefiles   <span class="token operator">=</span> Generates CodeLite project files.
  CodeLite - NMake Makefiles   <span class="token operator">=</span> Generates CodeLite project files.
  CodeLite - Ninja             <span class="token operator">=</span> Generates CodeLite project files.
  CodeLite - Unix Makefiles    <span class="token operator">=</span> Generates CodeLite project files.
  Eclipse CDT4 - NMake Makefiles
                               <span class="token operator">=</span> Generates Eclipse CDT <span class="token number">4.0</span> project files.
  Eclipse CDT4 - MinGW Makefiles
                               <span class="token operator">=</span> Generates Eclipse CDT <span class="token number">4.0</span> project files.
  Eclipse CDT4 - Ninja         <span class="token operator">=</span> Generates Eclipse CDT <span class="token number">4.0</span> project files.
  Eclipse CDT4 - Unix <span class="token assign-left variable">Makefiles</span><span class="token operator">=</span> Generates Eclipse CDT <span class="token number">4.0</span> project files.
  Kate - MinGW Makefiles       <span class="token operator">=</span> Generates Kate project files.
  Kate - NMake Makefiles       <span class="token operator">=</span> Generates Kate project files.
  Kate - Ninja                 <span class="token operator">=</span> Generates Kate project files.
  Kate - Unix Makefiles        <span class="token operator">=</span> Generates Kate project files.
  Sublime Text <span class="token number">2</span> - MinGW Makefiles
                               <span class="token operator">=</span> Generates Sublime Text <span class="token number">2</span> project files.
  Sublime Text <span class="token number">2</span> - NMake Makefiles
                               <span class="token operator">=</span> Generates Sublime Text <span class="token number">2</span> project files.
  Sublime Text <span class="token number">2</span> - Ninja       <span class="token operator">=</span> Generates Sublime Text <span class="token number">2</span> project files.
  Sublime Text <span class="token number">2</span> - Unix Makefiles
                               <span class="token operator">=</span> Generates Sublime Text <span class="token number">2</span> project files.


lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/J-building-with-ninja
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Calling-a-Generator"><a href="#Calling-a-Generator" class="headerlink" title="Calling a Generator"></a>Calling a Generator</h5><p>To call a CMake generator you can use the <code>-G</code> command line switch, for example:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> Ninja<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>After doing the above CMake will generate the required Ninja build files, which can be run from using the <code>ninja</code> command.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> Ninja

$ <span class="token function">ls</span>
build.ninja  CMakeCache.txt  CMakeFiles  cmake_install.cmake  rules.ninja<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Building-the-Examples-1"><a href="#Building-the-Examples-1" class="headerlink" title="Building the Examples"></a>Building the Examples</h5><p>Below is sample output from building this example.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/J-building-with-ninja
$ <span class="token function">mkdir</span> build.ninja

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/J-building-with-ninja
$ <span class="token builtin class-name">cd</span> build.ninja/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/J-building-with-ninja/build.ninja
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> Ninja
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/J-building-with-ninja/build.ninja

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/J-building-with-ninja/build.ninja
$ ninja
<span class="token punctuation">[</span><span class="token number">2</span>/2<span class="token punctuation">]</span> Linking CXX executable hello_cmake.exe

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/J-building-with-ninja/build.ninja
$ <span class="token function">ls</span>
build.ninja          CMakeCache.txt  hello_cmake.exe
cmake_install.cmake  CMakeFiles

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/J-building-with-ninja/build.ninja
$ ./hello_cmake.exe
Hello CMake<span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/J-building-with-ninja/build.ninja
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="K-imported-targets"><a href="#K-imported-targets" class="headerlink" title="K-imported-targets"></a>K-imported-targets</h4><h5 id="Files-10"><a href="#Files-10" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /f/vscode/cpp_projects/cmake-examples/01-basic/
<span class="token function">mkdir</span> K-imported-targets
<span class="token builtin class-name">cd</span> K-imported-targets<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>imported_targets<span class="token punctuation">)</span>

<span class="token comment"># find a boost install with the libraries filesystem and system</span>
<span class="token keyword">find_package</span><span class="token punctuation">(</span>Boost <span class="token number">1.46.1</span> REQUIRED COMPONENTS filesystem system<span class="token punctuation">)</span>

<span class="token comment"># check if boost was found</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>Boost_FOUND<span class="token punctuation">)</span>
        <span class="token keyword">message</span><span class="token punctuation">(</span><span class="token string">"boost found"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">message</span><span class="token punctuation">(</span>FATAL_ERROR <span class="token string">"Cannot find Boost"</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Add an executable</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>imported_targets main.cpp<span class="token punctuation">)</span>

<span class="token comment"># link against the boost libraries</span>
<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>imported_targets
        <span class="token namespace">PRIVATE</span>
        <span class="token inserted class-name">Boost::filesystem</span>
        <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;
#include &lt;boost&#x2F;shared_ptr.hpp&gt;
#include &lt;boost&#x2F;filesystem.hpp&gt;

int main(int argc, char *argv[])
&#123;
        std::cout &lt;&lt; &quot;Hello Third Party Include!&quot; &lt;&lt; std::endl;

        &#x2F;&#x2F; use a shared ptr
        boost::shared_ptr&lt;int&gt; isp(new int(4));

        &#x2F;&#x2F; trivial use of boost filesystem
        boost::filesystem::path path &#x3D; &quot;&#x2F;usr&#x2F;share&#x2F;cmake&#x2F;modules&quot;;
        if(path.is_relative())
        &#123;
                std::cout &lt;&lt; &quot;Path is relative&quot; &lt;&lt; std::endl;
        &#125;
        else
        &#123;
                std::cout &lt;&lt; &quot;Path is not relative&quot; &lt;&lt; std::endl;
        &#125;

        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-10"><a href="#Introduction-10" class="headerlink" title="Introduction"></a>Introduction</h5><p>As previously mentioned in <code>the third party library</code>, newer versions of CMake allow you to link third party libraries using <code>imported ALIAS targets</code>.</p>
<p>The files in this tutorial are below:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/K-imported-targets
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
└── main.cpp

<span class="token number">0</span> directories, <span class="token number">2</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code> - Contains the CMake commands you wish to run.</p>
</li>
<li><p><code>main.cpp</code> - The source file with main.</p>
</li>
</ul>
<h5 id="Requirements-1"><a href="#Requirements-1" class="headerlink" title="Requirements"></a>Requirements</h5><p>This example requires the following:</p>
<ul>
<li><p>CMake v3.5+</p>
</li>
<li><p>The boost libraries to be installed in a default system location.</p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman <span class="token parameter variable">-S</span> mingw-w64-x86_64-boost<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="Concepts-10"><a href="#Concepts-10" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="Imported-Target"><a href="#Imported-Target" class="headerlink" title="Imported Target"></a>Imported Target</h6><p>Imported targets are <code>read-only targets</code> that are exported by <code>FindXXX modules</code>.</p>
<p>To include <code>boost filesystem</code> you can do the following:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span> imported_targets
        <span class="token namespace">PRIVATE</span>
        <span class="token inserted class-name">Boost::filesystem</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Linking against <code>Boost::filesystem</code> will automatically add <code>Boost::boost</code> and <code>Boost::system</code> dependencies.</p>
<h5 id="Building-the-Example-7"><a href="#Building-the-Example-7" class="headerlink" title="Building the Example"></a>Building the Example</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/K-imported-targets
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/K-imported-targets
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/K-imported-targets/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Found Boost: D:/lyf_computer_language/msys64/mingw64/include <span class="token punctuation">(</span>found suitable version <span class="token string">"1.79.0"</span>, minimum required is <span class="token string">"1.46.1"</span><span class="token punctuation">)</span> found components: filesystem system
boost found
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/K-imported-targets/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/K-imported-targets/build
$ <span class="token function">make</span>
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/imported_targets.dir/main.cpp.obj
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable imported_targets.exe
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target imported_targets

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/K-imported-targets/build
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeFiles            Makefile
CMakeCache.txt       imported_targets.exe

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/K-imported-targets/build
$ ./imported_targets.exe
Hello Third Party Include<span class="token operator">!</span>
Path is relative

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/K-imported-targets/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="L-cpp-standard"><a href="#L-cpp-standard" class="headerlink" title="L-cpp-standard"></a>L-cpp-standard</h4><p>Since the release of <code>C++11</code> and <code>C++14</code> a common use case is to invoke the compiler to use these standards. As CMake has evolved, it has added features to make this easier and new versions of CMake have changed how this is achieved.</p>
<p>The following examples show different methods of setting the C++ standard and what versions of CMake they are available from.</p>
<p>The examples include:</p>
<ul>
<li><p><code>common-method</code> - A simple version that should work with most versions of CMake.</p>
</li>
<li><p><code>cxx-standard</code> - Using the <code>CMAKE_CXX_STANDARD</code> variable introduced in <code>CMake v3.1</code>.</p>
</li>
<li><p><code>compile-features</code> - Using the <code>target_compile_features</code> function introduced in <code>CMake v3.1</code>.</p>
</li>
</ul>
<h5 id="i-common-method"><a href="#i-common-method" class="headerlink" title="i-common-method"></a>i-common-method</h5><h6 id="Files-11"><a href="#Files-11" class="headerlink" title="Files"></a>Files</h6><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /f/vscode/cpp_projects/cmake-examples/01-basic/
<span class="token function">mkdir</span> L-cpp-standard
<span class="token builtin class-name">cd</span> L-cpp-standard
<span class="token function">mkdir</span> i-common-method
<span class="token builtin class-name">cd</span> i-common-method<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Set the minimum version of CMake that can be used</span>
<span class="token comment"># To find the cmake version run</span>
<span class="token comment"># $ cmake --version</span>
<span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">2.8</span><span class="token punctuation">)</span>

<span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>hello_cpp11<span class="token punctuation">)</span>

<span class="token comment"># try conditional compilation</span>
<span class="token keyword">include</span><span class="token punctuation">(</span>CheckCXXCompilerFlag<span class="token punctuation">)</span>
<span class="token function">CHECK_CXX_COMPILER_FLAG</span><span class="token punctuation">(</span><span class="token string">"-std=c++11"</span> COMPILER_SUPPORTS_CXX11<span class="token punctuation">)</span>
<span class="token function">CHECK_CXX_COMPILER_FLAG</span><span class="token punctuation">(</span><span class="token string">"-std=c++0x"</span> COMPILER_SUPPORTS_CXX0X<span class="token punctuation">)</span>

<span class="token comment"># check results and add flag</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>COMPILER_SUPPORTS_CXX11<span class="token punctuation">)</span>
        <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_FLAGS</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_CXX_FLAGS</span><span class="token punctuation">&#125;</span></span> -std=c++11"</span><span class="token punctuation">)</span>
<span class="token keyword">elseif</span><span class="token punctuation">(</span>COMPILER_SUPPORTS_CXX0X<span class="token punctuation">)</span>
        <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_FLAGS</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_CXX_FLAGS</span><span class="token punctuation">&#125;</span></span> -std=c++0x"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">message</span><span class="token punctuation">(</span>STATUS <span class="token string">"The compiler <span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_CXX_COMPILER</span><span class="token punctuation">&#125;</span></span> has no C++11 support. Please use a different C++ compiler."</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Add an executable</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello_cpp11 main.cpp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

int main(int argc, char *argv[])
&#123;
        auto message &#x3D; &quot;Hello C++11&quot;;
        std::cout &lt;&lt; message &lt;&lt; std::endl;
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="Introduction-11"><a href="#Introduction-11" class="headerlink" title="Introduction"></a>Introduction</h6><p>This example shows a common method to set the C++ Standard. This can be used with most versions of CMake. However, if you are targeting a recent version of CMake there are more convenient methods available.</p>
<p>The files in this tutorial are below:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
└── main.cpp

<span class="token number">0</span> directories, <span class="token number">2</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code> - Contains the CMake commands you wish to run.</p>
</li>
<li><p><code>main.cpp</code> - A simple “Hello World” cpp file targeting C++11.</p>
</li>
</ul>
<h6 id="Concepts-11"><a href="#Concepts-11" class="headerlink" title="Concepts"></a>Concepts</h6><p><strong>Checking Compile flags</strong></p>
<p>CMake has support for attempting to compile a program with any flags you pass into the function <code>CMAKE_CXX_COMPILER_FLAG</code>. The result is then stored in a variable that you pass in.</p>
<p>For example:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">include</span><span class="token punctuation">(</span>CheckCXXCompilerFlag<span class="token punctuation">)</span>
<span class="token function">CHECK_CXX_COMPILER_FLAG</span><span class="token punctuation">(</span><span class="token string">"-std=c++11"</span> COMPILER_SUPPORTS_CXX11<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>This example will attempt to compile a program with the flag <code>-std=c++11</code> and store the result in the variable <code>COMPILER_SUPPORTS_CXX11</code>.</p>
<p>The line <code>include(CheckCXXCompilerFlag)</code> tells CMake to include this function to make it available for use.</p>
<p><strong>Adding the flag</strong></p>
<p>Once you have determined if the compile supports a flag, you can then use the standard cmake methods to add this flag to a target. In this example we use the <code>CMAKE_CXX_FLAGS</code> to propegate the flag to all targets.</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">if</span><span class="token punctuation">(</span>COMPILER_SUPPORTS_CXX11<span class="token punctuation">)</span><span class="token comment">#</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_FLAGS</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_CXX_FLAGS</span><span class="token punctuation">&#125;</span></span> -std=c++11"</span><span class="token punctuation">)</span>
<span class="token keyword">elseif</span><span class="token punctuation">(</span>COMPILER_SUPPORTS_CXX0X<span class="token punctuation">)</span><span class="token comment">#</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_FLAGS</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_CXX_FLAGS</span><span class="token punctuation">&#125;</span></span> -std=c++0x"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">message</span><span class="token punctuation">(</span>STATUS <span class="token string">"The compiler <span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_CXX_COMPILER</span><span class="token punctuation">&#125;</span></span> has no C++11 support. Please use a different C++ compiler."</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The above example only checks for the gcc version of the compile flags and supports fallback from <code>C++11</code> to the <code>pre-standardisation C+\+0x</code> flag. In real usage you may want to check for <code>C14</code>, or add support for different methods of setting the compile, e.g. <code>-std=gnu11</code>.</p>
<h6 id="Building-the-Examples-2"><a href="#Building-the-Examples-2" class="headerlink" title="Building the Examples"></a>Building the Examples</h6><p>Below is sample output from building this example.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
CMake Deprecation Warning at CMakeLists.txt:4 <span class="token punctuation">(</span>cmake_minimum_required<span class="token punctuation">)</span>:
  Compatibility with CMake <span class="token operator">&lt;</span> <span class="token number">2.8</span>.12 will be removed from a future version of
  CMake.

  Update the VERSION argument <span class="token operator">&lt;</span>min<span class="token operator">></span> value or use a <span class="token punctuation">..</span>.<span class="token operator">&lt;</span>max<span class="token operator">></span> suffix to tell
  CMake that the project does not need compatibility with older versions.


-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Performing Test COMPILER_SUPPORTS_CXX11
-- Performing Test COMPILER_SUPPORTS_CXX11 - Success
-- Performing Test COMPILER_SUPPORTS_CXX0X
-- Performing Test COMPILER_SUPPORTS_CXX0X - Success
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build
$ <span class="token function">make</span> <span class="token assign-left variable">VERBOSE</span><span class="token operator">=</span><span class="token number">1</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe -S/F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method -B/F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build --check-build-system CMakeFiles/Makefile.cmake <span class="token number">0</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build/CMakeFiles /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build//CMakeFiles/progress.marks
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/Makefile2 all
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/hello_cpp11.dir/build.make CMakeFiles/hello_cpp11.dir/depend
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build”
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_depends <span class="token string">"MSYS Makefiles"</span> /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build/CMakeFiles/hello_cpp11.dir/DependInfo.cmake <span class="token parameter variable">--color</span><span class="token operator">=</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/hello_cpp11.dir/build.make CMakeFiles/hello_cpp11.dir/build
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build”
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello_cpp11.dir/main.cpp.obj
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe   <span class="token parameter variable">-std</span><span class="token operator">=</span>c++11 <span class="token parameter variable">-MD</span> <span class="token parameter variable">-MT</span> CMakeFiles/hello_cpp11.dir/main.cpp.obj <span class="token parameter variable">-MF</span> CMakeFiles/hello_cpp11.dir/main.cpp.obj.d <span class="token parameter variable">-o</span> CMakeFiles/hello_cpp11.dir/main.cpp.obj <span class="token parameter variable">-c</span> /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/main.cpp
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable hello_cpp11.exe
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> CMakeFiles/hello_cpp11.dir/objects.a
/D/lyf_computer_language/msys64/mingw64/bin/ar.exe qc CMakeFiles/hello_cpp11.dir/objects.a <span class="token string">"CMakeFiles/hello_cpp11.dir/main.cpp.obj"</span>
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe  <span class="token parameter variable">-std</span><span class="token operator">=</span>c++11 -Wl,--whole-archive CMakeFiles/hello_cpp11.dir/objects.a -Wl,--no-whole-archive <span class="token parameter variable">-o</span> hello_cpp11.exe -Wl,--out-implib,libhello_cpp11.dll.a -Wl,--major-image-version,0,--minor-image-version,0  <span class="token parameter variable">-lkernel32</span> <span class="token parameter variable">-luser32</span> <span class="token parameter variable">-lgdi32</span> <span class="token parameter variable">-lwinspool</span> <span class="token parameter variable">-lshell32</span> <span class="token parameter variable">-lole32</span> <span class="token parameter variable">-loleaut32</span> <span class="token parameter variable">-luuid</span> <span class="token parameter variable">-lcomdlg32</span> <span class="token parameter variable">-ladvapi32</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build”
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target hello_cpp11
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build”
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build/CMakeFiles <span class="token number">0</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeCache.txt  CMakeFiles  hello_cpp11.exe  Makefile

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build
$ ./hello_cpp11.exe
Hello C++11

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/i-common-method/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="ii-cxx-standard"><a href="#ii-cxx-standard" class="headerlink" title="ii-cxx-standard"></a>ii-cxx-standard</h5><h6 id="Files-12"><a href="#Files-12" class="headerlink" title="Files"></a>Files</h6><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/
<span class="token function">mkdir</span> ii-cxx-standard
<span class="token builtin class-name">cd</span> ii-cxx-standard<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Set the minimum version of CMake that can be used</span>
<span class="token comment"># To find the cmake version run</span>
<span class="token comment"># $ cmake --version</span>
<span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.1</span><span class="token punctuation">)</span>

<span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>hello_cpp11<span class="token punctuation">)</span>

<span class="token comment"># Set the C++ standard to C++ 11</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_STANDARD</span> <span class="token number">11</span><span class="token punctuation">)</span>

<span class="token comment"># Add an executable</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello_cpp11 main.cpp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

int main(int argc, char *argv[])
&#123;
        auto message &#x3D; &quot;Hello C++11&quot;;
        std::cout &lt;&lt; message &lt;&lt; std::endl;
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="Introduction-12"><a href="#Introduction-12" class="headerlink" title="Introduction"></a>Introduction</h6><p>This example shows how to set the C++ standard using the <code>CMAKE_CXX_STANDARD</code> variable. This is available since CMake v3.1.</p>
<p>The files in this tutorial are below:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
└── main.cpp

<span class="token number">0</span> directories, <span class="token number">2</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code> - Contains the CMake commands you wish to run.</p>
</li>
<li><p><code>main.cpp</code> - A simple “Hello World” cpp file targeting C++11.</p>
</li>
</ul>
<h6 id="Concepts-12"><a href="#Concepts-12" class="headerlink" title="Concepts"></a>Concepts</h6><p><strong>Using CXX_STANDARD property</strong></p>
<p>Setting the <code>CMAKE_CXX_STANDARD</code> variable causes the <code>CXX_STANDARD</code> property on all targets. This causes CMake to set the appropriate flag at compille time.</p>
<p>The <code>CMAKE_CXX_STANDARD</code> variable falls back to the closest appropriate standard without a failure. For example, if you request <code>-std=gnu11</code> you may end up with <code>-std=gnu0x</code>.</p>
<p>This can result in an unexpected failure at compile time.</p>
<h6 id="Building-the-Examples-3"><a href="#Building-the-Examples-3" class="headerlink" title="Building the Examples"></a>Building the Examples</h6><p>Below is sample output from building this example.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build
$ <span class="token function">make</span> <span class="token assign-left variable">VERBOSE</span><span class="token operator">=</span><span class="token number">1</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe -S/F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard -B/F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build --check-build-system CMakeFiles/Makefile.cmake <span class="token number">0</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build/CMakeFiles /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build//CMakeFiles/progress.marks
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/Makefile2 all
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/hello_cpp11.dir/build.make CMakeFiles/hello_cpp11.dir/depend
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build”
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_depends <span class="token string">"MSYS Makefiles"</span> /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build/CMakeFiles/hello_cpp11.dir/DependInfo.cmake <span class="token parameter variable">--color</span><span class="token operator">=</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/hello_cpp11.dir/build.make CMakeFiles/hello_cpp11.dir/build
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build”
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello_cpp11.dir/main.cpp.obj
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe   <span class="token parameter variable">-std</span><span class="token operator">=</span>gnu++11 <span class="token parameter variable">-MD</span> <span class="token parameter variable">-MT</span> CMakeFiles/hello_cpp11.dir/main.cpp.obj <span class="token parameter variable">-MF</span> CMakeFiles/hello_cpp11.dir/main.cpp.obj.d <span class="token parameter variable">-o</span> CMakeFiles/hello_cpp11.dir/main.cpp.obj <span class="token parameter variable">-c</span> /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/main.cpp
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable hello_cpp11.exe
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> CMakeFiles/hello_cpp11.dir/objects.a
/D/lyf_computer_language/msys64/mingw64/bin/ar.exe qc CMakeFiles/hello_cpp11.dir/objects.a <span class="token string">"CMakeFiles/hello_cpp11.dir/main.cpp.obj"</span>
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe -Wl,--whole-archive CMakeFiles/hello_cpp11.dir/objects.a -Wl,--no-whole-archive <span class="token parameter variable">-o</span> hello_cpp11.exe -Wl,--out-implib,libhello_cpp11.dll.a -Wl,--major-image-version,0,--minor-image-version,0  <span class="token parameter variable">-lkernel32</span> <span class="token parameter variable">-luser32</span> <span class="token parameter variable">-lgdi32</span> <span class="token parameter variable">-lwinspool</span> <span class="token parameter variable">-lshell32</span> <span class="token parameter variable">-lole32</span> <span class="token parameter variable">-loleaut32</span> <span class="token parameter variable">-luuid</span> <span class="token parameter variable">-lcomdlg32</span> <span class="token parameter variable">-ladvapi32</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build”
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target hello_cpp11
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build”
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build/CMakeFiles <span class="token number">0</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeCache.txt  CMakeFiles  hello_cpp11.exe  Makefile

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build
$ ./hello_cpp11.exe
Hello C++11

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/ii-cxx-standard/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="iii-compile-features"><a href="#iii-compile-features" class="headerlink" title="iii-compile-features"></a>iii-compile-features</h5><h6 id="Files-13"><a href="#Files-13" class="headerlink" title="Files"></a>Files</h6><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/
<span class="token function">mkdir</span> iii-compile-features
<span class="token builtin class-name">cd</span> iii-compile-features<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Set the minimum version of CMake that can be used</span>
<span class="token comment"># To find the cmake version run</span>
<span class="token comment"># $ cmake --version</span>
<span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.1</span><span class="token punctuation">)</span>

<span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>hello_cpp11<span class="token punctuation">)</span>

<span class="token comment"># Add an executable</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>hello_cpp11 main.cpp<span class="token punctuation">)</span>

<span class="token comment"># set the C++ standard to the appropriate standard for using auto</span>
<span class="token keyword">target_compile_features</span><span class="token punctuation">(</span>hello_cpp11 <span class="token namespace">PUBLIC</span> <span class="token property">cxx_auto_type</span><span class="token punctuation">)</span>

<span class="token comment"># Print the list of known compile features for this version of CMake</span>
<span class="token keyword">message</span><span class="token punctuation">(</span><span class="token string">"List of compile features: <span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_CXX_COMPILE_FEATURES</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

int main(int argc, char *argv[])
&#123;
        auto message &#x3D; &quot;Hello C++11&quot;;
        std::cout &lt;&lt; message &lt;&lt; std::endl;
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="Introduction-13"><a href="#Introduction-13" class="headerlink" title="Introduction"></a>Introduction</h6><p>This example shows how to set the C++ standard using the <code>target_compile_features</code> function. This is available since CMake v3.1.</p>
<p>The files in this tutorial are below:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
└── main.cpp

<span class="token number">0</span> directories, <span class="token number">2</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code> - Contains the CMake commands you wish to run.</p>
</li>
<li><p><code>main.cpp</code> - A simple “Hello World” cpp file targeting C++11.</p>
</li>
</ul>
<h6 id="Concepts-13"><a href="#Concepts-13" class="headerlink" title="Concepts"></a>Concepts</h6><p><strong>Using target_compile_features</strong></p>
<p>Calling the <code>target_compile_features</code> function on a target will look at the passed in feature and determine the correct compiler flag to use for your target.</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">target_compile_features</span><span class="token punctuation">(</span>hello_cpp11 <span class="token namespace">PUBLIC</span> <span class="token property">cxx_auto_type</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>As with other <code>target_*</code> functions, you can specify the scope of the feature for the selected target. This populates the <code>INTERFACE_COMPILE_FEATURES</code> property for the target.</p>
<p>The list of available features can be found from the <code>CMAKE_CXX_COMPILE_FEATURES</code> variable. You can obtain a list of the available features using the following code:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">message</span><span class="token punctuation">(</span><span class="token string">"List of compile features: <span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_CXX_COMPILE_FEATURES</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="Building-the-Examples-4"><a href="#Building-the-Examples-4" class="headerlink" title="Building the Examples"></a>Building the Examples</h6><p>Below is sample output from building this example.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
List of compile features: cxx_std_98<span class="token punctuation">;</span>cxx_template_template_parameters<span class="token punctuation">;</span>cxx_std_11<span class="token punctuation">;</span>cxx_alias_templates<span class="token punctuation">;</span>cxx_alignas<span class="token punctuation">;</span>cxx_alignof<span class="token punctuation">;</span>cxx_attributes<span class="token punctuation">;</span>cxx_auto_type<span class="token punctuation">;</span>cxx_constexpr<span class="token punctuation">;</span>cxx_decltype<span class="token punctuation">;</span>cxx_decltype_incomplete_return_types<span class="token punctuation">;</span>cxx_default_function_template_args<span class="token punctuation">;</span>cxx_defaulted_functions<span class="token punctuation">;</span>cxx_defaulted_move_initializers<span class="token punctuation">;</span>cxx_delegating_constructors<span class="token punctuation">;</span>cxx_deleted_functions<span class="token punctuation">;</span>cxx_enum_forward_declarations<span class="token punctuation">;</span>cxx_explicit_conversions<span class="token punctuation">;</span>cxx_extended_friend_declarations<span class="token punctuation">;</span>cxx_extern_templates<span class="token punctuation">;</span>cxx_final<span class="token punctuation">;</span>cxx_func_identifier<span class="token punctuation">;</span>cxx_generalized_initializers<span class="token punctuation">;</span>cxx_inheriting_constructors<span class="token punctuation">;</span>cxx_inline_namespaces<span class="token punctuation">;</span>cxx_lambdas<span class="token punctuation">;</span>cxx_local_type_template_args<span class="token punctuation">;</span>cxx_long_long_type<span class="token punctuation">;</span>cxx_noexcept<span class="token punctuation">;</span>cxx_nonstatic_member_init<span class="token punctuation">;</span>cxx_nullptr<span class="token punctuation">;</span>cxx_override<span class="token punctuation">;</span>cxx_range_for<span class="token punctuation">;</span>cxx_raw_string_literals<span class="token punctuation">;</span>cxx_reference_qualified_functions<span class="token punctuation">;</span>cxx_right_angle_brackets<span class="token punctuation">;</span>cxx_rvalue_references<span class="token punctuation">;</span>cxx_sizeof_member<span class="token punctuation">;</span>cxx_static_assert<span class="token punctuation">;</span>cxx_strong_enums<span class="token punctuation">;</span>cxx_thread_local<span class="token punctuation">;</span>cxx_trailing_return_types<span class="token punctuation">;</span>cxx_unicode_literals<span class="token punctuation">;</span>cxx_uniform_initialization<span class="token punctuation">;</span>cxx_unrestricted_unions<span class="token punctuation">;</span>cxx_user_literals<span class="token punctuation">;</span>cxx_variadic_macros<span class="token punctuation">;</span>cxx_variadic_templates<span class="token punctuation">;</span>cxx_std_14<span class="token punctuation">;</span>cxx_aggregate_default_initializers<span class="token punctuation">;</span>cxx_attribute_deprecated<span class="token punctuation">;</span>cxx_binary_literals<span class="token punctuation">;</span>cxx_contextual_conversions<span class="token punctuation">;</span>cxx_decltype_auto<span class="token punctuation">;</span>cxx_digit_separators<span class="token punctuation">;</span>cxx_generic_lambdas<span class="token punctuation">;</span>cxx_lambda_init_captures<span class="token punctuation">;</span>cxx_relaxed_constexpr<span class="token punctuation">;</span>cxx_return_type_deduction<span class="token punctuation">;</span>cxx_variable_templates<span class="token punctuation">;</span>cxx_std_17<span class="token punctuation">;</span>cxx_std_20<span class="token punctuation">;</span>cxx_std_23
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build
$ <span class="token function">make</span> <span class="token assign-left variable">VERBOSE</span><span class="token operator">=</span><span class="token number">1</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe -S/F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features -B/F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build --check-build-system CMakeFiles/Makefile.cmake <span class="token number">0</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build/CMakeFiles /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build//CMakeFiles/progress.marks
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/Makefile2 all
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/hello_cpp11.dir/build.make CMakeFiles/hello_cpp11.dir/depend
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build”
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_depends <span class="token string">"MSYS Makefiles"</span> /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build/CMakeFiles/hello_cpp11.dir/DependInfo.cmake <span class="token parameter variable">--color</span><span class="token operator">=</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/hello_cpp11.dir/build.make CMakeFiles/hello_cpp11.dir/build
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build”
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/hello_cpp11.dir/main.cpp.obj
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe    <span class="token parameter variable">-MD</span> <span class="token parameter variable">-MT</span> CMakeFiles/hello_cpp11.dir/main.cpp.obj <span class="token parameter variable">-MF</span> CMakeFiles/hello_cpp11.dir/main.cpp.obj.d <span class="token parameter variable">-o</span> CMakeFiles/hello_cpp11.dir/main.cpp.obj <span class="token parameter variable">-c</span> /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/main.cpp
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable hello_cpp11.exe
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> CMakeFiles/hello_cpp11.dir/objects.a
/D/lyf_computer_language/msys64/mingw64/bin/ar.exe qc CMakeFiles/hello_cpp11.dir/objects.a <span class="token string">"CMakeFiles/hello_cpp11.dir/main.cpp.obj"</span>
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe -Wl,--whole-archive CMakeFiles/hello_cpp11.dir/objects.a -Wl,--no-whole-archive <span class="token parameter variable">-o</span> hello_cpp11.exe -Wl,--out-implib,libhello_cpp11.dll.a -Wl,--major-image-version,0,--minor-image-version,0  <span class="token parameter variable">-lkernel32</span> <span class="token parameter variable">-luser32</span> <span class="token parameter variable">-lgdi32</span> <span class="token parameter variable">-lwinspool</span> <span class="token parameter variable">-lshell32</span> <span class="token parameter variable">-lole32</span> <span class="token parameter variable">-loleaut32</span> <span class="token parameter variable">-luuid</span> <span class="token parameter variable">-lcomdlg32</span> <span class="token parameter variable">-ladvapi32</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build”
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target hello_cpp11
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build”
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build/CMakeFiles <span class="token number">0</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeCache.txt  CMakeFiles  hello_cpp11.exe  Makefile

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build
$ ./hello_cpp11.exe
Hello C++11

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/01-basic/L-cpp-standard/iii-compile-features/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="02-sub-projects"><a href="#02-sub-projects" class="headerlink" title="02-sub-projects"></a>02-sub-projects</h3><p>Many large projects are made up of different libraries and binaries. These can be organised into multiple folders and sub-projects to ease development.</p>
<p>The examples included are</p>
<ul>
<li><code>basic</code> - This basic example includes a static library, a header only library and an executable.</li>
</ul>
<h4 id="A-basic"><a href="#A-basic" class="headerlink" title="A-basic"></a>A-basic</h4><h5 id="Files-14"><a href="#Files-14" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /f/vscode/cpp_projects/cmake-examples/
<span class="token function">mkdir</span> 02-sub-projects
<span class="token builtin class-name">cd</span> 02-sub-projects
<span class="token function">mkdir</span> A-basic
<span class="token builtin class-name">cd</span> A-basic<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token keyword">project</span><span class="token punctuation">(</span>subprojects<span class="token punctuation">)</span>

<span class="token comment"># Add sub directories</span>
<span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span>sublibrary1<span class="token punctuation">)</span>
<span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span>sublibrary2<span class="token punctuation">)</span>
<span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span>subbinary<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>subbinary/CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">project</span><span class="token punctuation">(</span>subbinary<span class="token punctuation">)</span>

<span class="token comment"># Create the executable</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span> main.cpp<span class="token punctuation">)</span>

<span class="token comment"># Link the static library from subproject1 using its alias sub::lib1</span>
<span class="token comment"># Link the header only library from subproject2 using its alias sub::lib2</span>
<span class="token comment"># This will cause the include directories for that target to be added to this project</span>
<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span>
        <span class="token inserted class-name">sub::lib1</span>
        <span class="token inserted class-name">sub::lib2</span>
        <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>创建 <code>subbinary/main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &quot;sublib1&#x2F;sublib1.h&quot;
#include &quot;sublib2&#x2F;sublib2.h&quot;

int main(int argc, char *argv[])
&#123;
        sublib1 hi;
        hi.print();

        sublib2 howdy;
        howdy.print();

        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>创建 <code>sublibrary1/CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>sublibrary1<span class="token punctuation">)</span>

<span class="token comment"># Add a library with the above sources</span>
<span class="token keyword">add_library</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span> src/sublib1.cpp<span class="token punctuation">)</span>
<span class="token keyword">add_library</span><span class="token punctuation">(</span><span class="token inserted class-name">sub::lib1</span> ALIAS <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">target_include_directories</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span>
        <span class="token namespace">PUBLIC</span> <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/include
        <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="6">
<li>创建 <code>sublibrary1/include/sublib1/sublib1.h</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#ifndef __SUBLIB_1_H__
#define __SUBLIB_1_H__

class sublib1
&#123;
public:
        void print();
&#125;;

#endif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="7">
<li>创建 <code>sublibrary1/src/sublib1.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

#include &quot;sublib1&#x2F;sublib1.h&quot;

void sublib1::print()
&#123;
        std::cout &lt;&lt; &quot;Hello sub-library 1!&quot; &lt;&lt; std::endl;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="8">
<li>创建 <code>sublibrary2/CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>sublibrary2<span class="token punctuation">)</span>

<span class="token keyword">add_library</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span> <span class="token namespace">INTERFACE</span><span class="token punctuation">)</span>
<span class="token keyword">add_library</span><span class="token punctuation">(</span><span class="token inserted class-name">sub::lib2</span> ALIAS <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">target_include_directories</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span>
        <span class="token namespace">INTERFACE</span>
        <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/include
        <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="9">
<li>创建 <code>sublibrary2/include/sublib2/sublib2.h</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#ifndef __SUBLIB_2_H__
#define __SUBLIB_2_H__

#include &lt;iostream&gt;

class sublib2
&#123;
public:
        void print()
        &#123;
                std::cout &lt;&lt; &quot;Hello header only sub-library 2!&quot; &lt;&lt; std::endl;
        &#125;
&#125;;

#endif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-14"><a href="#Introduction-14" class="headerlink" title="Introduction"></a>Introduction</h5><p>This example shows how to setup a CMake project that includes sub-projects. The top level CMakeLists.txt calls the CMakeLists.txt in the sub directories to create the following:</p>
<ul>
<li><p><code>sublibrary1</code> - A static library</p>
</li>
<li><p><code>sublibrary2</code> - A header only library</p>
</li>
<li><p><code>subbinary</code> - An executable</p>
</li>
</ul>
<p>The files included in this example are:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/02-sub-projects/A-basic
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
├── subbinary
│   ├── CMakeLists.txt
│   └── main.cpp
├── sublibrary1
│   ├── CMakeLists.txt
│   ├── include
│   │   └── sublib1
│   │       └── sublib1.h
│   └── src
│       └── sublib1.cpp
└── sublibrary2
    ├── CMakeLists.txt
    └── include
        └── sublib2
            └── sublib2.h

<span class="token number">8</span> directories, <span class="token number">8</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code> - Top level CMakeLists.txt</p>
</li>
<li><p><code>subbinary/CMakeLists.txt</code> - to make the executable</p>
</li>
<li><p><code>subbinary/main.cpp</code> - source for the executable</p>
</li>
<li><p><code>sublibrary1/CMakeLists.txt</code> - to make a static library</p>
</li>
<li><p><code>sublibrary1/include/sublib1/sublib1.h</code> - The header file of the static library</p>
</li>
<li><p><code>sublibrary1/src/sublib1.cpp</code> - The source file of the static library</p>
</li>
<li><p><code>sublibrary2/CMakeLists.txt</code> - to setup header only library</p>
</li>
<li><p><code>sublibrary2/include/sublib2/sublib2.h</code> - The header file of the header only library</p>
</li>
</ul>
<p>In this example I have moved the header files to a subfolder under each projects include directory, while <code>leaving the target include as the root include folder</code>. This is a good idea to prevent filename clashes because you have to include a file like below:</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &quot;sublib1&#x2F;sublib1.h&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>This also means that if you install your library for other users the default install location would be <code>/usr/local/include/sublib1/sublib1.h</code>.</p>
<h5 id="Concepts-14"><a href="#Concepts-14" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="Adding-a-Sub-Directory"><a href="#Adding-a-Sub-Directory" class="headerlink" title="Adding a Sub-Directory"></a>Adding a Sub-Directory</h6><p>A <code>CMakeLists.txt</code> file can include and call sub-directories which include a <code>CMakeLists.txt</code> files.</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span>sublibrary1<span class="token punctuation">)</span>
<span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span>sublibrary2<span class="token punctuation">)</span>
<span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span>subbinary<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h6 id="Referencing-Sub-Project-Directories"><a href="#Referencing-Sub-Project-Directories" class="headerlink" title="Referencing Sub-Project Directories"></a>Referencing Sub-Project Directories</h6><p>When a project is created using the <code>project()</code> command, CMake will automatically create a number of variables which can be used to reference details about the project. <code>These variables can then be used by other sub-projects or the main project.</code> For example, to reference the source directory for a different project you can use.</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token punctuation">$&#123;</span><span class="token variable">sublibrary1_SOURCE_DIR</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">$&#123;</span><span class="token variable">sublibrary2_SOURCE_DIR</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>The variables created by <code>CMake</code> include:</p>
<table>
<thead>
<tr>
<th align="center">Variable</th>
<th align="center">Info</th>
</tr>
</thead>
<tbody><tr>
<td align="center">PROJECT_NAME</td>
<td align="center">The name of the project set by the current <code>project()</code>.</td>
</tr>
<tr>
<td align="center">CMAKE_PROJECT_NAME</td>
<td align="center">the name of the first project set by the <code>project()</code> command, i.e. <code>the top level project</code>.</td>
</tr>
<tr>
<td align="center">PROJECT_SOURCE_DIR</td>
<td align="center">The source directory of the current project.</td>
</tr>
<tr>
<td align="center">PROJECT_BINARY_DIR</td>
<td align="center">The build directory for the current project.</td>
</tr>
<tr>
<td align="center">name_SOURCE_DIR</td>
<td align="center">The source directory of the project called “name”. In this example the source directories created would be <code>sublibrary1_SOURCE_DIR</code>, <code>sublibrary2_SOURCE_DIR</code>, and <code>subbinary_SOURCE_DIR</code>.</td>
</tr>
<tr>
<td align="center">name_BINARY_DIR</td>
<td align="center">The binary directory of the project called “name”. In this example the binary directories created would be <code>sublibrary1_BINARY_DIR</code>, <code>sublibrary2_BINARY_DIR</code>, and <code>subbinary_BINARY_DIR</code>.</td>
</tr>
</tbody></table>
<h6 id="Header-only-Libraries"><a href="#Header-only-Libraries" class="headerlink" title="Header only Libraries"></a>Header only Libraries</h6><p>If you have a library that is created as a header only library, cmake supports the <code>INTERFACE</code> target to allow creating a target without any build output.</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">add_library</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span> <span class="token namespace">INTERFACE</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>When creating the target you can also include directories for that target using the <code>INTERFACE</code> scope. The <code>INTERFACE</code> scope is use to make target requirements that are used in any Libraries that link this target but not in the compilation of the target itself.</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">target_include_directories</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span>
    <span class="token namespace">INTERFACE</span>
        <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/include
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="Referencing-Libraries-from-Sub-Projects"><a href="#Referencing-Libraries-from-Sub-Projects" class="headerlink" title="Referencing Libraries from Sub-Projects"></a>Referencing Libraries from Sub-Projects</h6><p>If a sub-project creates a library, it can be referenced by other projects by calling the name of the target in the <code>target_link_libraries()</code> command. This means that you don’t have to reference the full path of the new library and it is added as a dependency.</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>subbinary
    <span class="token namespace">PUBLIC</span>
        sublibrary1
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Alternatively, you can create an alias target which allows you to reference the target in read only contexts.</p>
<p>To create an alias target run:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">add_library</span><span class="token punctuation">(</span>sublibrary2<span class="token punctuation">)</span>
<span class="token keyword">add_library</span><span class="token punctuation">(</span><span class="token inserted class-name">sub::lib2</span> ALIAS sublibrary2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>To reference the alias, just it as follows:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>subbinary
    <span class="token inserted class-name">sub::lib2</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h6 id="Include-directories-from-sub-projects"><a href="#Include-directories-from-sub-projects" class="headerlink" title="Include directories from sub-projects"></a>Include directories from sub-projects</h6><p>When adding the libraries from the sub-projects, starting from cmake v3, there is no need to add the projects include directories in the include directories of the binary using them.</p>
<p>This is controlled by the scope in the <code>target_include_directories()</code> command when creating the libraries. In this example because the subbinary executable links the sublibrary1 and sublibrary2 libraries it will automatically include the <code>$&#123;sublibrary1_SOURCE_DIR&#125;/include</code> and <code>$&#123;sublibrary2_SOURCE_DIR&#125;/include</code> folders as they are exported with the <code>PUBLIC</code> and <code>INTERFACE</code> scopes of the libraries.</p>
<h5 id="Building-the-example"><a href="#Building-the-example" class="headerlink" title="Building the example"></a>Building the example</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/02-sub-projects/A-basic
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/02-sub-projects/A-basic
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/02-sub-projects/A-basic/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/02-sub-projects/A-basic/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/02-sub-projects/A-basic/build
$ <span class="token function">make</span>
<span class="token punctuation">[</span> <span class="token number">25</span>%<span class="token punctuation">]</span> Building CXX object sublibrary1/CMakeFiles/sublibrary1.dir/src/sublib1.cpp.obj
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Linking CXX static library libsublibrary1.a
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Built target sublibrary1
<span class="token punctuation">[</span> <span class="token number">75</span>%<span class="token punctuation">]</span> Building CXX object subbinary/CMakeFiles/subbinary.dir/main.cpp.obj
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable subbinary.exe
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target subbinary

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/02-sub-projects/A-basic/build
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeFiles  subbinary    sublibrary2
CMakeCache.txt       Makefile    sublibrary1

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/02-sub-projects/A-basic/build
$ <span class="token builtin class-name">cd</span> subbinary/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/02-sub-projects/A-basic/build/subbinary
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeFiles  Makefile  subbinary.exe

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/02-sub-projects/A-basic/build/subbinary
$ ./subbinary.exe
Hello sub-library <span class="token number">1</span><span class="token operator">!</span>
Hello header only sub-library <span class="token number">2</span><span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/02-sub-projects/A-basic/build/subbinary
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="03-code-generation"><a href="#03-code-generation" class="headerlink" title="03-code-generation"></a>03-code-generation</h3><p>Code generation can be useful to create source code in different languages from a common description file. This can reduce the amount of manual code to write and increase interoperability.</p>
<p>Examples showing code generation using variables from CMake and also using some common tools.</p>
<ul>
<li><p><code>configure-file</code> - Using the <code>CMake</code> <code>configure_file</code> function to inject CMake variables.</p>
</li>
<li><p><code>Protocol Buffers</code> - Using <code>Google Protocol Buffers</code> to generate C++ source.</p>
</li>
</ul>
<h4 id="configure-files"><a href="#configure-files" class="headerlink" title="configure-files"></a>configure-files</h4><h5 id="Files-15"><a href="#Files-15" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /f/vscode/cpp_projects/cmake-examples/
<span class="token function">mkdir</span> 03-code-generation
<span class="token builtin class-name">cd</span> 03-code-generation/
<span class="token function">mkdir</span> configure-files
<span class="token builtin class-name">cd</span> configure-files/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>cf_example<span class="token punctuation">)</span>

<span class="token comment"># Set a project version</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">cf_example_VERSION_MAJOR</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">cf_example_VERSION_MINOR</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">cf_example_VERSION_PATCH</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">cf_example_VERSION</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">cf_example_VERSION_MAJOR</span><span class="token punctuation">&#125;</span></span>.<span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">cf_example_VERSION_MINOR</span><span class="token punctuation">&#125;</span></span>.<span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">cf_example_VERSION_PATCH</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">)</span>

<span class="token comment"># Call configure files on ver.h.in to set the version.</span>
<span class="token comment"># Uses the standard $&#123;VARIABLE&#125; syntax in the file</span>
<span class="token keyword">configure_file</span><span class="token punctuation">(</span>ver.h.in <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_BINARY_DIR</span><span class="token punctuation">&#125;</span>/ver.h<span class="token punctuation">)</span>

<span class="token comment"># configure the path.h.in file.</span>
<span class="token comment"># This file can only use the @VARIABLE@ syntax in the file</span>
<span class="token keyword">configure_file</span><span class="token punctuation">(</span>path.h.in <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_BINARY_DIR</span><span class="token punctuation">&#125;</span>/path.h @ONLY<span class="token punctuation">)</span>

<span class="token comment"># Add an executable</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>cf_example
        main.cpp
        <span class="token punctuation">)</span>

<span class="token comment"># include the directory with the new files</span>
<span class="token keyword">target_include_directories</span><span class="token punctuation">(</span>cf_example
        <span class="token namespace">PUBLIC</span>
        <span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_BINARY_DIR</span><span class="token punctuation">&#125;</span>
        <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;
#include &quot;ver.h&quot;
#include &quot;path.h&quot;

int main(int argc, char *argv[])
&#123;
        std::cout &lt;&lt; &quot;Hello Version &quot; &lt;&lt; ver &lt;&lt; &quot;!&quot; &lt;&lt; std::endl;
        std::cout &lt;&lt; &quot;Path is &quot; &lt;&lt; path &lt;&lt; std::endl;
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>创建 <code>path.h.in</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#ifndef __PATH_H__
#define __PATH_H__

&#x2F;&#x2F; version variable that will be substituted by cmake
&#x2F;&#x2F; This shows an example using the @ variable type
const char* path &#x3D; &quot;@CMAKE_SOURCE_DIR@&quot;;

#endif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>创建 <code>ver.h.in</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#ifndef __VER_H__
#define __VER_H__

&#x2F;&#x2F; version variable that will be substituted by cmake
&#x2F;&#x2F; This shows an example using the $ variable type
const char* ver &#x3D; &quot;$&#123;cf_example_VERSION&#125;&quot;;

#endif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-15"><a href="#Introduction-15" class="headerlink" title="Introduction"></a>Introduction</h5><p>During the call to cmake it is possible to create files that use variables from the CMakeLists.txt and cmake cache. During CMake generation the file is copied to a new location and any cmake variables are replaced.</p>
<p>The files in this tutorial are below:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
├── main.cpp
├── path.h.in
└── ver.h.in

<span class="token number">0</span> directories, <span class="token number">4</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code> - Contains the CMake commands you wish to run</p>
</li>
<li><p><code>main.cpp</code> - The source file with main</p>
</li>
<li><p><code>path.h.in</code> - File to contain a path to the build directory</p>
</li>
<li><p><code>ver.h.in</code> - File to contain the version of the project</p>
</li>
</ul>
<h5 id="Concepts-15"><a href="#Concepts-15" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="Configure-Files"><a href="#Configure-Files" class="headerlink" title="Configure Files"></a>Configure Files</h6><p>To do variable substitution in a file you can use the <code>configure_file()</code> function in CMake. This core arguments for this function are source file and destination file.</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">configure_file</span><span class="token punctuation">(</span>ver.h.in <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_BINARY_DIR</span><span class="token punctuation">&#125;</span>/ver.h<span class="token punctuation">)</span>

<span class="token keyword">configure_file</span><span class="token punctuation">(</span>path.h.in <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_BINARY_DIR</span><span class="token punctuation">&#125;</span>/path.h @ONLY<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>The first example above, allows the variable to be defined like a CMake variables using the <code>$&#123;&#125;</code> syntax or an <code>@@</code> in the <code>ver.h.in</code> file. After generation a new file <code>ver.h</code> will be available in the <code>PROJECT_BINARY_DIR</code>.</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">const char* ver &#x3D; &quot;$&#123;cf_example_VERSION&#125;&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>The second example, only allows variables to be defined using the <code>@@</code> syntax in the <code>path.h.in</code> file. After generation a new file <code>path.h</code> will be available in the <code>PROJECT_BINARY_DIR</code>.</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">const char* path &#x3D; &quot;@CMAKE_SOURCE_DIR@&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="Building-the-Example-8"><a href="#Building-the-Example-8" class="headerlink" title="Building the Example"></a>Building the Example</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files/build
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeCache.txt  CMakeFiles  Makefile  path.h  ver.h

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files/build
$ <span class="token function">cat</span> path.h
<span class="token comment">#ifndef __PATH_H__</span>
<span class="token comment">#define __PATH_H__</span>

// version variable that will be substituted by cmake
// This shows an example using the @ variable <span class="token builtin class-name">type</span>
const char* path <span class="token operator">=</span> <span class="token string">"F:/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files"</span><span class="token punctuation">;</span>

<span class="token comment">#endif</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files/build
$ <span class="token function">cat</span> ver.h
<span class="token comment">#ifndef __VER_H__</span>
<span class="token comment">#define __VER_H__</span>

// version variable that will be substituted by cmake
// This shows an example using the $ variable <span class="token builtin class-name">type</span>
const char* ver <span class="token operator">=</span> <span class="token string">"0.2.1"</span><span class="token punctuation">;</span>

<span class="token comment">#endif</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files/build
$ <span class="token function">make</span>
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/cf_example.dir/main.cpp.obj
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable cf_example.exe
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target cf_example

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files/build
$ <span class="token function">ls</span>
cf_example.exe       CMakeCache.txt  Makefile  ver.h
cmake_install.cmake  CMakeFiles      path.h

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files/build
$ ./cf_example.exe
Hello Version <span class="token number">0.2</span>.1<span class="token operator">!</span>
Path is F:/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/configure-files/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="protobuf"><a href="#protobuf" class="headerlink" title="protobuf"></a>protobuf</h4><h5 id="Files-16"><a href="#Files-16" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /f/vscode/cpp_projects/cmake-examples/03-code-generation/
<span class="token function">mkdir</span> protobuf
<span class="token builtin class-name">cd</span> protobuf/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>AddressBook.proto</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">package tutorial;

message Person &#123;
        required string name &#x3D; 1;
        required int32 id &#x3D; 2;
        optional string email &#x3D; 3;

        enum PhoneType &#123;
                MOBILE &#x3D; 0;
                HOME &#x3D; 1;
                WORK &#x3D; 2;
        &#125;

        message PhoneNumber &#123;
                required string number &#x3D; 1;
                optional PhoneType type &#x3D; 2 [default &#x3D; HOME];
        &#125;

        repeated PhoneNumber phone &#x3D; 4;
&#125;

message AddressBook &#123;
        repeated Person person &#x3D; 1;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token comment"># Set the project name</span>
<span class="token keyword">project</span> <span class="token punctuation">(</span>protobuf_example<span class="token punctuation">)</span>

<span class="token comment"># find the protobuf compiler and libraries</span>
<span class="token keyword">find_package</span><span class="token punctuation">(</span>Protobuf REQUIRED<span class="token punctuation">)</span>

<span class="token comment"># check if protobuf was found</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>PROTOBUF_FOUND<span class="token punctuation">)</span>
    <span class="token keyword">message</span> <span class="token punctuation">(</span><span class="token string">"protobuf found"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">message</span> <span class="token punctuation">(</span>FATAL_ERROR <span class="token string">"Cannot find Protobuf"</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Generate the .h and .cxx files</span>
<span class="token function">PROTOBUF_GENERATE_CPP</span><span class="token punctuation">(</span>PROTO_SRCS PROTO_HDRS AddressBook.proto<span class="token punctuation">)</span>

<span class="token comment"># Print path to generated files</span>
<span class="token keyword">message</span> <span class="token punctuation">(</span><span class="token string">"PROTO_SRCS = <span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">PROTO_SRCS</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">)</span>
<span class="token keyword">message</span> <span class="token punctuation">(</span><span class="token string">"PROTO_HDRS = <span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">PROTO_HDRS</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">)</span>

<span class="token comment"># Add an executable</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>protobuf_example
    main.cpp
    <span class="token punctuation">$&#123;</span>PROTO_SRCS<span class="token punctuation">&#125;</span>
    <span class="token punctuation">$&#123;</span>PROTO_HDRS<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">target_include_directories</span><span class="token punctuation">(</span>protobuf_example
    <span class="token namespace">PUBLIC</span>
    <span class="token punctuation">$&#123;</span>PROTOBUF_INCLUDE_DIRS<span class="token punctuation">&#125;</span>
    <span class="token punctuation">$&#123;</span><span class="token variable">CMAKE_CURRENT_BINARY_DIR</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span>

<span class="token comment"># link the exe against the libraries</span>
<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>protobuf_example
    <span class="token namespace">PUBLIC</span>
    <span class="token punctuation">$&#123;</span>PROTOBUF_LIBRARIES<span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>创建 <code>main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;
#include &lt;fstream&gt;
#include &lt;string&gt;
#include &quot;AddressBook.pb.h&quot;
using namespace std;

&#x2F;&#x2F; This function fills in a Person message based on user input.
void PromptForAddress(tutorial::Person* person) &#123;
  cout &lt;&lt; &quot;Enter person ID number: &quot;;
  int id;
  cin &gt;&gt; id;
  person-&gt;set_id(id);
  cin.ignore(256, &#39;\n&#39;);

  cout &lt;&lt; &quot;Enter name: &quot;;
  getline(cin, *person-&gt;mutable_name());

  cout &lt;&lt; &quot;Enter email address (blank for none): &quot;;
  string email;
  getline(cin, email);
  if (!email.empty()) &#123;
    person-&gt;set_email(email);
  &#125;

  while (true) &#123;
    cout &lt;&lt; &quot;Enter a phone number (or leave blank to finish): &quot;;
    string number;
    getline(cin, number);
    if (number.empty()) &#123;
      break;
    &#125;

    tutorial::Person::PhoneNumber* phone_number &#x3D; person-&gt;add_phone();
    phone_number-&gt;set_number(number);

    cout &lt;&lt; &quot;Is this a mobile, home, or work phone? &quot;;
    string type;
    getline(cin, type);
    if (type &#x3D;&#x3D; &quot;mobile&quot;) &#123;
      phone_number-&gt;set_type(tutorial::Person::MOBILE);
    &#125; else if (type &#x3D;&#x3D; &quot;home&quot;) &#123;
      phone_number-&gt;set_type(tutorial::Person::HOME);
    &#125; else if (type &#x3D;&#x3D; &quot;work&quot;) &#123;
      phone_number-&gt;set_type(tutorial::Person::WORK);
    &#125; else &#123;
      cout &lt;&lt; &quot;Unknown phone type.  Using default.&quot; &lt;&lt; endl;
    &#125;
  &#125;
&#125;

&#x2F;&#x2F; Main function:  Reads the entire address book from a file,
&#x2F;&#x2F;   adds one person based on user input, then writes it back out to the same
&#x2F;&#x2F;   file.
int main(int argc, char* argv[]) &#123;
  &#x2F;&#x2F; Verify that the version of the library that we linked against is
  &#x2F;&#x2F; compatible with the version of the headers we compiled against.
  GOOGLE_PROTOBUF_VERIFY_VERSION;

  if (argc !&#x3D; 2) &#123;
    cerr &lt;&lt; &quot;Usage:  &quot; &lt;&lt; argv[0] &lt;&lt; &quot; ADDRESS_BOOK_FILE&quot; &lt;&lt; endl;
    return -1;
  &#125;

  tutorial::AddressBook address_book;

  &#123;
    &#x2F;&#x2F; Read the existing address book.
    fstream input(argv[1], ios::in | ios::binary);
    if (!input) &#123;
      cout &lt;&lt; argv[1] &lt;&lt; &quot;: File not found.  Creating a new file.&quot; &lt;&lt; endl;
    &#125; else if (!address_book.ParseFromIstream(&amp;input)) &#123;
      cerr &lt;&lt; &quot;Failed to parse address book.&quot; &lt;&lt; endl;
      return -1;
    &#125;
  &#125;

  &#x2F;&#x2F; Add an address.
  PromptForAddress(address_book.add_person());

  &#123;
    &#x2F;&#x2F; Write the new address book back to disk.
    fstream output(argv[1], ios::out | ios::trunc | ios::binary);
    if (!address_book.SerializeToOstream(&amp;output)) &#123;
      cerr &lt;&lt; &quot;Failed to write address book.&quot; &lt;&lt; endl;
      return -1;
    &#125;
  &#125;

  &#x2F;&#x2F; Optional:  Delete all global objects allocated by libprotobuf.
  google::protobuf::ShutdownProtobufLibrary();

  return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-16"><a href="#Introduction-16" class="headerlink" title="Introduction"></a>Introduction</h5><p>This example shows how to generate source files using <code>protobuf</code>. <code>Protocol Buffers is a data serialization format from Google.</code> A user provides a <code>.proto</code> file with a description of the data. Then using the protobuf compiler, <code>the proto file can be translated into source code in a number of languages including C++</code>.</p>
<p>The files in this tutorial are below:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf
$ tree
<span class="token builtin class-name">.</span>
├── AddressBook.proto
├── CMakeLists.txt
└── main.cpp

<span class="token number">0</span> directories, <span class="token number">3</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>AddressBook.proto</code> - proto file from main protocol buffer example</p>
</li>
<li><p><code>CMakeLists.txt</code> - Contains the CMake commands you wish to run</p>
</li>
<li><p><code>main.cpp</code> - The source file from the protobuf example.</p>
</li>
</ul>
<h5 id="Requirements-2"><a href="#Requirements-2" class="headerlink" title="Requirements"></a>Requirements</h5><p>This example requires the protocol buffers binary and libraries to be installed.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MSYS ~
$ pacman <span class="token parameter variable">-S</span> mingw-w64-x86_64-protobuf mingw-w64-x86_64-protobuf-c protobuf-de
vel
正在解析依赖关系<span class="token punctuation">..</span>.
正在查找软件包冲突<span class="token punctuation">..</span>.

软件包 <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> protobuf-3.16.0-1  mingw-w64-x86_64-protobuf-3.16.0-3
           mingw-w64-x86_64-protobuf-c-1.3.3-2  protobuf-devel-3.16.0-1

全部安装大小：  <span class="token number">58.05</span> MiB

:: 进行安装吗？ <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span>
<span class="token punctuation">(</span><span class="token number">4</span>/4<span class="token punctuation">)</span> 正在检查密钥环里的密钥                       <span class="token punctuation">[</span><span class="token comment">##################] 100%</span>
<span class="token punctuation">(</span><span class="token number">4</span>/4<span class="token punctuation">)</span> 正在检查软件包完整性                         <span class="token punctuation">[</span><span class="token comment">##################] 100%</span>
<span class="token punctuation">(</span><span class="token number">4</span>/4<span class="token punctuation">)</span> 正在加载软件包文件                           <span class="token punctuation">[</span><span class="token comment">##################] 100%</span>
<span class="token punctuation">(</span><span class="token number">4</span>/4<span class="token punctuation">)</span> 正在检查文件冲突                             <span class="token punctuation">[</span><span class="token comment">##################] 100%</span>
<span class="token punctuation">(</span><span class="token number">4</span>/4<span class="token punctuation">)</span> 正在检查可用存储空间                         <span class="token punctuation">[</span><span class="token comment">##################] 100%</span>
:: 正在处理软件包的变化<span class="token punctuation">..</span>.
<span class="token punctuation">(</span><span class="token number">1</span>/4<span class="token punctuation">)</span> 正在安装 mingw-w64-x86_64-protobuf           <span class="token punctuation">[</span><span class="token comment">##################] 100%</span>
<span class="token punctuation">(</span><span class="token number">2</span>/4<span class="token punctuation">)</span> 正在安装 mingw-w64-x86_64-protobuf-c         <span class="token punctuation">[</span><span class="token comment">##################] 100%</span>
<span class="token punctuation">(</span><span class="token number">3</span>/4<span class="token punctuation">)</span> 正在安装 protobuf                            <span class="token punctuation">[</span><span class="token comment">##################] 100%</span>
<span class="token punctuation">(</span><span class="token number">4</span>/4<span class="token punctuation">)</span> 正在安装 protobuf-devel                      <span class="token punctuation">[</span><span class="token comment">##################] 100%</span>

lyf@DESKTOP-GV2QHKN MSYS ~
$ pacman <span class="token parameter variable">-Ss</span> protobuf
mingw32/mingw-w64-i686-protobuf <span class="token number">3.16</span>.0-3
    Protocol Buffers - Google<span class="token string">'s data interchange format (mingw-w64)
mingw32/mingw-w64-i686-protobuf-c 1.3.3-2
    Protocol Buffers implementation in C (mingw-w64)
mingw32/mingw-w64-i686-python-protobuf 3.16.0-3
    Protocol Buffers (mingw-w64)
mingw64/mingw-w64-x86_64-protobuf 3.16.0-3 [已安装]
    Protocol Buffers - Google'</span>s data interchange <span class="token function">format</span> <span class="token punctuation">(</span>mingw-w64<span class="token punctuation">)</span>
mingw64/mingw-w64-x86_64-protobuf-c <span class="token number">1.3</span>.3-2 <span class="token punctuation">[</span>已安装<span class="token punctuation">]</span>
    Protocol Buffers implementation <span class="token keyword">in</span> C <span class="token punctuation">(</span>mingw-w64<span class="token punctuation">)</span>
mingw64/mingw-w64-x86_64-python-protobuf <span class="token number">3.16</span>.0-3
    Protocol Buffers <span class="token punctuation">(</span>mingw-w64<span class="token punctuation">)</span>
ucrt64/mingw-w64-ucrt-x86_64-protobuf <span class="token number">3.16</span>.0-3
    Protocol Buffers - Google<span class="token string">'s data interchange format (mingw-w64)
ucrt64/mingw-w64-ucrt-x86_64-protobuf-c 1.3.3-2
    Protocol Buffers implementation in C (mingw-w64)
ucrt64/mingw-w64-ucrt-x86_64-python-protobuf 3.16.0-3
    Protocol Buffers (mingw-w64)
clang32/mingw-w64-clang-i686-protobuf 3.16.0-3
    Protocol Buffers - Google'</span>s data interchange <span class="token function">format</span> <span class="token punctuation">(</span>mingw-w64<span class="token punctuation">)</span>
clang32/mingw-w64-clang-i686-protobuf-c <span class="token number">1.3</span>.3-2
    Protocol Buffers implementation <span class="token keyword">in</span> C <span class="token punctuation">(</span>mingw-w64<span class="token punctuation">)</span>
clang32/mingw-w64-clang-i686-python-protobuf <span class="token number">3.16</span>.0-3
    Protocol Buffers <span class="token punctuation">(</span>mingw-w64<span class="token punctuation">)</span>
clang64/mingw-w64-clang-x86_64-protobuf <span class="token number">3.16</span>.0-3
    Protocol Buffers - Google<span class="token string">'s data interchange format (mingw-w64)
clang64/mingw-w64-clang-x86_64-protobuf-c 1.3.3-2
    Protocol Buffers implementation in C (mingw-w64)
clang64/mingw-w64-clang-x86_64-python-protobuf 3.16.0-3
    Protocol Buffers (mingw-w64)
msys/protobuf 3.16.0-1 (libraries) [已安装]
    Protocol Buffers - Google'</span>s data interchange <span class="token function">format</span>
msys/protobuf-devel <span class="token number">3.16</span>.0-1 <span class="token punctuation">(</span>development<span class="token punctuation">)</span> <span class="token punctuation">[</span>已安装<span class="token punctuation">]</span>
    Protobuf headers and libraries

lyf@DESKTOP-GV2QHKN MSYS ~
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Concepts-16"><a href="#Concepts-16" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="Exported-Variables-1"><a href="#Exported-Variables-1" class="headerlink" title="Exported Variables"></a>Exported Variables</h6><p>The variables exported by the <code>CMake protobuf package</code> and used in this example include:</p>
<ul>
<li><p><code>PROTOBUF_FOUND</code> - If Protocol Buffers is installed</p>
</li>
<li><p><code>PROTOBUF_INCLUDE_DIRS</code> - The protobuf header files</p>
</li>
<li><p><code>PROTOBUF_LIBRARIES</code> - The protobuf library</p>
</li>
</ul>
<p>More variables are defined and can be found by examining the documentation at the top of your <code>FindProtobuf.cmake</code> file.</p>
<h6 id="Generating-Source"><a href="#Generating-Source" class="headerlink" title="Generating Source"></a>Generating Source</h6><p><code>The protobuf CMake package</code> includes a number of helper functions to make the code generation easier. In this example we are generating C++ source and use the following code:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token function">PROTOBUF_GENERATE_CPP</span><span class="token punctuation">(</span>PROTO_SRCS PROTO_HDRS AddressBook.proto<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>The arguments are:</p>
<ul>
<li><p><code>PROTO_SRCS</code> - Name of the variable that will store the <code>.pb.cc</code> files.</p>
</li>
<li><p><code>PROTO_HDRS</code> - Name of the variable that will store the <code>.pb.h</code> files.</p>
</li>
<li><p><code>AddressBook.proto</code> - The <code>.proto</code> file to generate code from.</p>
</li>
</ul>
<h6 id="Generated-Files"><a href="#Generated-Files" class="headerlink" title="Generated Files"></a>Generated Files</h6><p>After the <code>PROTOBUF_GENERATE_CPP</code> function is called, you will have the above mentioned variables available. These will be marked as the output to a custom command which calls the protobuf compiler binary to generate them.</p>
<p>To then have the files generated you should add them to a library or executable. For example:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">add_executable</span><span class="token punctuation">(</span>protobuf_example
    main.cpp
    <span class="token punctuation">$&#123;</span>PROTO_SRCS<span class="token punctuation">&#125;</span>
    <span class="token punctuation">$&#123;</span>PROTO_HDRS<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>This will cause the protobuf compiler to be called when you call <code>make</code> on that executables target.</p>
<p>When changes are made to the <code>.proto</code> file, the associated source files will be autogenerated again. However, if no changes are made to the <code>.proto</code> file and you re-run make, then nothing will be done.</p>
<h5 id="Building-the-Example-9"><a href="#Building-the-Example-9" class="headerlink" title="Building the Example"></a>Building the Example</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Found Protobuf: D:/lyf_computer_language/msys64/mingw64/lib/libprotobuf.dll.a <span class="token punctuation">(</span>found version <span class="token string">"3.16.0"</span><span class="token punctuation">)</span>
protobuf found
PROTO_SRCS <span class="token operator">=</span> F:/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build/AddressBook.pb.cc
PROTO_HDRS <span class="token operator">=</span> F:/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build/AddressBook.pb.h
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeCache.txt  CMakeFiles  Makefile

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build
$ <span class="token function">make</span> <span class="token assign-left variable">VERBOSE</span><span class="token operator">=</span><span class="token number">1</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe -S/F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf -B/F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build --check-build-system CMakeFiles/Makefile.cmake <span class="token number">0</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build/CMakeFiles /F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build//CMakeFiles/progress.marks
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/Makefile2 all
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/protobuf_example.dir/build.make CMakeFiles/protobuf_example.dir/depend
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build”
<span class="token punctuation">[</span> <span class="token number">25</span>%<span class="token punctuation">]</span> Running cpp protocol buffer compiler on AddressBook.proto
/D/lyf_computer_language/msys64/mingw64/bin/protoc.exe <span class="token parameter variable">--cpp_out</span> F:/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build <span class="token parameter variable">-I</span> F:/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf F:/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/AddressBook.proto
<span class="token punctuation">[</span>libprotobuf WARNING C:/_/M/mingw-w64-protobuf/src/build-x86_64-shared/src/google/protobuf/compiler/parser.cc:651<span class="token punctuation">]</span> No syntax specified <span class="token keyword">for</span> the proto file: AddressBook.proto. Please use <span class="token string">'syntax = "proto2";'</span> or <span class="token string">'syntax = "proto3";'</span> to specify a syntax version. <span class="token punctuation">(</span>Defaulted to proto2 syntax.<span class="token punctuation">)</span>
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_depends <span class="token string">"MSYS Makefiles"</span> /F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf /F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf /F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build /F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build /F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build/CMakeFiles/protobuf_example.dir/DependInfo.cmake <span class="token parameter variable">--color</span><span class="token operator">=</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build”
<span class="token function">make</span>  <span class="token parameter variable">-f</span> CMakeFiles/protobuf_example.dir/build.make CMakeFiles/protobuf_example.dir/build
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build”
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/protobuf_example.dir/main.cpp.obj
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe  -I/F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build  <span class="token parameter variable">-MD</span> <span class="token parameter variable">-MT</span> CMakeFiles/protobuf_example.dir/main.cpp.obj <span class="token parameter variable">-MF</span> CMakeFiles/protobuf_example.dir/main.cpp.obj.d <span class="token parameter variable">-o</span> CMakeFiles/protobuf_example.dir/main.cpp.obj <span class="token parameter variable">-c</span> /F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/main.cpp
<span class="token punctuation">[</span> <span class="token number">75</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/protobuf_example.dir/AddressBook.pb.cc.obj
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe  -I/F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build  <span class="token parameter variable">-MD</span> <span class="token parameter variable">-MT</span> CMakeFiles/protobuf_example.dir/AddressBook.pb.cc.obj <span class="token parameter variable">-MF</span> CMakeFiles/protobuf_example.dir/AddressBook.pb.cc.obj.d <span class="token parameter variable">-o</span> CMakeFiles/protobuf_example.dir/AddressBook.pb.cc.obj <span class="token parameter variable">-c</span> /F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build/AddressBook.pb.cc
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable protobuf_example.exe
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> CMakeFiles/protobuf_example.dir/objects.a
/D/lyf_computer_language/msys64/mingw64/bin/ar.exe qc CMakeFiles/protobuf_example.dir/objects.a <span class="token string">"CMakeFiles/protobuf_example.dir/main.cpp.obj"</span> <span class="token string">"CMakeFiles/protobuf_example.dir/AddressBook.pb.cc.obj"</span>
/D/lyf_computer_language/msys64/mingw64/bin/c++.exe -Wl,--whole-archive CMakeFiles/protobuf_example.dir/objects.a -Wl,--no-whole-archive <span class="token parameter variable">-o</span> protobuf_example.exe -Wl,--out-implib,libprotobuf_example.dll.a -Wl,--major-image-version,0,--minor-image-version,0  /D/lyf_computer_language/msys64/mingw64/lib/libprotobuf.dll.a <span class="token parameter variable">-lkernel32</span> <span class="token parameter variable">-luser32</span> <span class="token parameter variable">-lgdi32</span> <span class="token parameter variable">-lwinspool</span> <span class="token parameter variable">-lshell32</span> <span class="token parameter variable">-lole32</span> <span class="token parameter variable">-loleaut32</span> <span class="token parameter variable">-luuid</span> <span class="token parameter variable">-lcomdlg32</span> <span class="token parameter variable">-ladvapi32</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build”
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target protobuf_example
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build”
/D/lyf_computer_language/msys64/mingw64/bin/cmake.exe <span class="token parameter variable">-E</span> cmake_progress_start /F/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build/CMakeFiles <span class="token number">0</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build
$ <span class="token function">ls</span>
AddressBook.pb.cc  cmake_install.cmake  CMakeFiles  protobuf_example.exe
AddressBook.pb.h   CMakeCache.txt       Makefile

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build
$ ./protobuf_example.exe test.db
test.db: File not found.  Creating a new file.
Enter person ID number: <span class="token number">1</span>
Enter name: lyf
Enter email address <span class="token punctuation">(</span>blank <span class="token keyword">for</span> none<span class="token punctuation">)</span>: xxx@qq.com
Enter a phone number <span class="token punctuation">(</span>or leave blank to finish<span class="token punctuation">)</span>: <span class="token number">12345678901</span>
Is this a mobile, home, or work phone? home
Enter a phone number <span class="token punctuation">(</span>or leave blank to finish<span class="token punctuation">)</span>:

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build
$ <span class="token function">ls</span>
AddressBook.pb.cc  cmake_install.cmake  CMakeFiles  protobuf_example.exe
AddressBook.pb.h   CMakeCache.txt       Makefile    test.db

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build
$ <span class="token function">cat</span> test.db

$
lyf
xxx@qq.com<span class="token string">"

12345678901
lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build
$ ./protobuf_example.exe test.db
Enter person ID number: 2
Enter name: zhy
Enter email address (blank for none): xxx@qq.com
Enter a phone number (or leave blank to finish): 12345678902
Is this a mobile, home, or work phone? mobile
Enter a phone number (or leave blank to finish): 99999999999
Is this a mobile, home, or work phone? work
Enter a phone number (or leave blank to finish):

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build
$ ls
AddressBook.pb.cc  cmake_install.cmake  CMakeFiles  protobuf_example.exe
AddressBook.pb.h   CMakeCache.txt       Makefile    test.db

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build
$ cat test.db

$
lyf
xxx@qq.com"</span>

<span class="token number">12345678901</span>
<span class="token number">5</span>
zhy
xxx@qq.com<span class="token string">"

12345678902"</span>

<span class="token number">99999999999</span>
lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/03-code-generation/protobuf/build
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="04-static-analysis"><a href="#04-static-analysis" class="headerlink" title="04-static-analysis"></a>04-static-analysis</h3><p>Static analysis is the analysis of code without executing it. It can be used to find common programming errors and enforce coding guidelines. Examples of errors that can be found using static analysis tools include:</p>
<ul>
<li><p>Out of bounds errors</p>
</li>
<li><p>Memory leaks</p>
</li>
<li><p>Usage of uninitialized variables</p>
</li>
<li><p>Use of unsafe functions</p>
</li>
</ul>
<p>Analysis tools can detect errors early and are becoming a standard tool in most build chains. Some build tools such as <code>Clang</code> include a build in static analysis tool. However standalone tools also exist.</p>
<p>The examples here include using the following tools:</p>
<ul>
<li><p><code>CppCheck</code></p>
</li>
<li><p><code>Clang Static Analyzer</code></p>
</li>
<li><p><code>Clang Format</code></p>
</li>
</ul>
<h4 id="clang-analyzer"><a href="#clang-analyzer" class="headerlink" title="clang-analyzer"></a>clang-analyzer</h4><h5 id="Files-17"><a href="#Files-17" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MSYS”，安装 <code>Clang toolchain</code>。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman <span class="token parameter variable">-S</span> <span class="token parameter variable">--needed</span> base-devel mingw-w64-clang-x86_64-toolchain
pacman <span class="token parameter variable">-S</span> cmake<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="2">
<li>运行开始菜单的 “MSYS2 MinGW Clang x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /f/vscode/cpp_projects/cmake-examples/
<span class="token function">mkdir</span> 04-static-analysis
<span class="token builtin class-name">cd</span> 04-static-analysis/
<span class="token function">mkdir</span> clang-analyzer
<span class="token builtin class-name">cd</span> clang-analyzer/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token keyword">project</span><span class="token punctuation">(</span>cppcheck_analysis<span class="token punctuation">)</span>

<span class="token comment"># Use debug build as recommended</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_BUILD_TYPE</span> Debug<span class="token punctuation">)</span>

<span class="token comment"># Have cmake create a compile database</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_EXPORT_COMPILE_COMMANDS</span> <span class="token boolean">ON</span><span class="token punctuation">)</span>

<span class="token comment"># Add sub directories</span>
<span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span>subproject1<span class="token punctuation">)</span>
<span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span>subproject2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>创建 <code>subproject1/CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>subproject1<span class="token punctuation">)</span>

<span class="token comment"># Add an executable with the above sources</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span> main1.cpp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>创建 <code>subproject1/main1.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

int main(int argc, char *argv[])
&#123;
        std::cout &lt;&lt; &quot;Hello Main1!&quot; &lt;&lt; std::endl;
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="6">
<li>创建 <code>subproject2/CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Set the project name</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>subproject2<span class="token punctuation">)</span>

<span class="token comment"># Add an executable with the above sources</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">&#125;</span> main2.cpp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="7">
<li>创建 <code>subproject2/main2.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

int main(int argc, char *argv[])
&#123;
        std::cout &lt;&lt; &quot;Hello Main2!&quot; &lt;&lt; std::endl;
        int* x &#x3D; NULL;
        std::cout &lt;&lt; *x &lt;&lt; std::endl;
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-17"><a href="#Introduction-17" class="headerlink" title="Introduction"></a>Introduction</h5><p>This example shows how to call <code>the Clang Static Analyzer</code> to do static analysis using <code>the scan-build tool</code>.</p>
<p>The files included in this example are:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer
$ tree
<span class="token builtin class-name">.</span>
├── CMakeLists.txt
├── subproject1
│   ├── CMakeLists.txt
│   └── main1.cpp
└── subproject2
    ├── CMakeLists.txt
    └── main2.cpp

<span class="token number">2</span> directories, <span class="token number">5</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code> - Top level CMakeLists.txt</p>
</li>
<li><p><code>subproject1/CMakeLists.txt</code> - CMake commands for subproject 1</p>
</li>
<li><p><code>subproject1/main1.cpp</code> - source for a subproject with no errors</p>
</li>
<li><p><code>subproject2/CMakeLists.txt</code> - CMake commands for subproject 2</p>
</li>
<li><p><code>subproject2/main2.cpp</code> - source for a subproject that includes errors</p>
</li>
</ul>
<h5 id="Requirements-3"><a href="#Requirements-3" class="headerlink" title="Requirements"></a>Requirements</h5><p>To run this example you must have <code>clang analyzer</code> and the <code>scan-build tool</code> installed. </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman <span class="token parameter variable">-S</span> <span class="token parameter variable">--needed</span> base-devel mingw-w64-clang-x86_64-toolchain<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>It will result in the tool being available as:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer
$ <span class="token function">which</span> scan-build
/clang64/bin/scan-build<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h5 id="Concepts-17"><a href="#Concepts-17" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="scan-build"><a href="#scan-build" class="headerlink" title="scan-build"></a>scan-build</h6><p>To run <code>clang static analyzer</code> you can use the tool <code>scan-build</code> to run the analyzer when you also run the compiler. This overrides the <code>CC</code> and <code>CXX</code> environment variables and replaces them with it’s own tools. To run it you can do</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ scan-build-3.6 cmake <span class="token punctuation">..</span>
$ scan-build-3.6 <span class="token function">make</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>By default this will run the standard compiler for your platform, i.e. <code>gcc</code> on linux. However, if you want to override this you can change the command to:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ scan-build-3.6 --use-cc<span class="token operator">=</span>clang-3.6 --use-c+<span class="token operator">+=</span>clang++-3.6 <span class="token parameter variable">-o</span> ./scanbuildout/ <span class="token function">make</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="scan-build-output"><a href="#scan-build-output" class="headerlink" title="scan-build output"></a>scan-build output</h6><p><code>scan-build</code> will only output warnings during compile time and will also generate a list of HTML files which contain detailed analysis of the error.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">cd</span> scanbuildout/
$ tree
<span class="token builtin class-name">.</span>
└── <span class="token number">2017</span>-07-03-213514-3653-1
    ├── index.html
    ├── report-42eba1.html
    ├── scanview.css
    └── sorttable.js

<span class="token number">1</span> directory, <span class="token number">4</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>By default these are output to <code>/tmp/scanbuildout/&#123;run folder&#125;</code>. You can change this using <code>scan-build -o /output/folder</code>.</p>
<h5 id="Building-the-example-1"><a href="#Building-the-example-1" class="headerlink" title="Building the example"></a>Building the example</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build
$ scan-build <span class="token parameter variable">-o</span> ./scanbuildout cmake <span class="token punctuation">..</span>
scan-build: Using <span class="token string">'/clang64/bin/clang'</span> <span class="token keyword">for</span> static analysis
-- The C compiler identification is Clang <span class="token number">14.0</span>.4
-- The CXX compiler identification is Clang <span class="token number">14.0</span>.4
System is unknown to cmake, create:
Platform/MINGW64_NT-10.0-19044 to use this system, please post your config <span class="token function">file</span> on discourse.cmake.org so it can be added to cmake
-- Detecting C compiler ABI info
System is unknown to cmake, create:
Platform/MINGW64_NT-10.0-19044 to use this system, please post your config <span class="token function">file</span> on discourse.cmake.org so it can be added to cmake
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: /clang64/libexec/ccc-analyzer - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
System is unknown to cmake, create:
Platform/MINGW64_NT-10.0-19044 to use this system, please post your config <span class="token function">file</span> on discourse.cmake.org so it can be added to cmake
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: /clang64/libexec/c++-analyzer - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build
scan-build: Analysis run complete.
scan-build: Removing directory <span class="token string">'/f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build/scanbuildout/2022-08-12-144922-1147-1'</span> because it contains no reports.
scan-build: No bugs found.

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build
$ scan-build <span class="token parameter variable">-o</span> ./scanbuildout <span class="token function">make</span>
scan-build: Using <span class="token string">'/clang64/bin/clang'</span> <span class="token keyword">for</span> static analysis
<span class="token punctuation">[</span> <span class="token number">25</span>%<span class="token punctuation">]</span> Building CXX object subproject1/CMakeFiles/subproject1.dir/main1.cpp.obj
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Linking CXX executable subproject1
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Built target subproject1
<span class="token punctuation">[</span> <span class="token number">75</span>%<span class="token punctuation">]</span> Building CXX object subproject2/CMakeFiles/subproject2.dir/main2.cpp.obj
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable subproject2
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target subproject2
scan-build: Analysis run complete.
scan-build: Removing directory <span class="token string">'/f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build/scanbuildout/2022-08-12-144942-1200-1'</span> because it contains no reports.
scan-build: No bugs found.

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeFiles             Makefile      subproject1
CMakeCache.txt       compile_commands.json  scanbuildout  subproject2

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build
$ <span class="token builtin class-name">cd</span> scanbuildout/

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build/scanbuildout
$ <span class="token function">ls</span>

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build/scanbuildout
$ <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/subproject1

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build/subproject1
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeFiles  Makefile  subproject1.exe

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build/subproject1
$ ./subproject1.exe
Hello Main1<span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build/subproject1
$ <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/subproject2

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build/subproject2
$ <span class="token function">ls</span>
cmake_install.cmake  CMakeFiles  Makefile  subproject2.exe

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build/subproject2
$ ./subproject2.exe
Hello Main2<span class="token operator">!</span>
Segmentation fault

lyf@DESKTOP-GV2QHKN CLANG64 /f/vscode/cpp_projects/cmake-examples/04-static-analysis/clang-analyzer/build/subproject2
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="06-installer"><a href="#06-installer" class="headerlink" title="06-installer"></a>06-installer</h3><p><code>CMake</code> has the ability to create installers for multiple platforms using a program called <code>CPack</code>. <code>CPack</code> includes the ability to create <code>Linux</code> <code>RPM</code>, <code>deb</code> and <code>gzip</code> distributions of both binaries and source code. It also includes the ability to create <code>NSIS files</code> for <code>Microsoft Windows</code>.</p>
<h4 id="deb"><a href="#deb" class="headerlink" title="deb"></a>deb</h4><h5 id="Files-18"><a href="#Files-18" class="headerlink" title="Files"></a>Files</h5><ol>
<li>运行开始菜单的 “MSYS2 MinGW x64”，运行下面命令构建项目目录。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /f/vscode/cpp_projects/cmake-examples/
<span class="token function">mkdir</span> 06-installer
<span class="token builtin class-name">cd</span> 06-installer/
<span class="token function">mkdir</span> deb
<span class="token builtin class-name">cd</span> deb/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建 <code>cmake-examples.conf</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none"># Sample configuration file that could be installed<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li>创建 <code>CMakeLists.txt</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span>

<span class="token keyword">project</span><span class="token punctuation">(</span>cmake_examples_zip<span class="token punctuation">)</span>

<span class="token comment"># set a project version</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">deb_example_VERSION_MAJOR</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">deb_example_VERSION_MINOR</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">deb_example_VERSION_PATCH</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">deb_example_VERSION</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">deb_example_VERSION_MAJOR</span><span class="token punctuation">&#125;</span></span>.<span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">deb_example_VERSION_MINOR</span><span class="token punctuation">&#125;</span></span>.<span class="token interpolation"><span class="token punctuation">$&#123;</span><span class="token variable">deb_example_VERSION_PATCH</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">)</span>

<span class="token comment">#######################################</span>
<span class="token comment"># Create a library</span>
<span class="token comment">#######################################</span>

<span class="token comment"># Generate the shared library from the library sources</span>
<span class="token keyword">add_library</span><span class="token punctuation">(</span>cmake_examples_zip <span class="token namespace">SHARED</span> src/Hello.cpp<span class="token punctuation">)</span>

<span class="token keyword">target_include_directories</span><span class="token punctuation">(</span>cmake_examples_zip
        <span class="token namespace">PUBLIC</span>
        <span class="token punctuation">$&#123;</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">&#125;</span>/include
        <span class="token punctuation">)</span>

<span class="token comment">########################################</span>
<span class="token comment"># Create an executable</span>
<span class="token comment">########################################</span>

<span class="token comment"># Add an executable with the above sources</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>cmake_examples_zip_bin src/main.cpp<span class="token punctuation">)</span>

<span class="token comment"># link the new hello_library target with the hello_binary target</span>
<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>cmake_examples_zip_bin
        <span class="token namespace">PUBLIC</span>
        cmake_examples_zip
        <span class="token punctuation">)</span>

<span class="token comment">###########################################</span>
<span class="token comment"># Install</span>
<span class="token comment">###########################################</span>

<span class="token comment"># Binaries</span>
<span class="token keyword">install</span><span class="token punctuation">(</span>TARGETS cmake_examples_zip_bin
        DESTINATION bin<span class="token punctuation">)</span>

<span class="token comment"># Library</span>
<span class="token comment"># Note: may not work on windows</span>
<span class="token keyword">install</span><span class="token punctuation">(</span>TARGETS cmake_examples_zip
        LIBRARY DESTINATION lib<span class="token punctuation">)</span>

<span class="token comment"># Config</span>
<span class="token keyword">install</span><span class="token punctuation">(</span>FILES cmake-examples.conf
        DESTINATION etc<span class="token punctuation">)</span>

<span class="token comment">############################################</span>
<span class="token comment"># Create DEB</span>
<span class="token comment">############################################</span>

<span class="token comment"># Tell CPack to generate a .deb package</span>
<span class="token keyword">set</span><span class="token punctuation">(</span>CPACK_GENERATOR <span class="token string">"ZIP"</span><span class="token punctuation">)</span>

<span class="token comment"># Set a Package Maintainer.</span>
<span class="token comment"># This is required</span>
<span class="token keyword">set</span><span class="token punctuation">(</span>CPACK_DEBIAN_PACKAGE_MAINTAINER <span class="token string">"luyanfeng"</span><span class="token punctuation">)</span>

<span class="token comment"># Set a Package Version</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CPACK_PACKAGE_VERSION</span> <span class="token punctuation">$&#123;</span><span class="token variable">deb_example_VERSION</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment"># Include CPack</span>
<span class="token keyword">include</span><span class="token punctuation">(</span>CPack<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>创建 <code>include/Hello.h</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#ifndef __HELLO_H__
#define __HELLO_H__

class Hello
&#123;
public:
        void print();
&#125;;

#endif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>创建 <code>src/Hello.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;

#include &quot;Hello.h&quot;

void Hello::print()
&#123;
        std::cout &lt;&lt; &quot;Hello Install!&quot; &lt;&lt; std::endl;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="6">
<li>创建 <code>src/main.cpp</code> 文件，粘贴下面代码。</li>
</ol>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &quot;Hello.h&quot;

int main(int argc, char *argv[])
&#123;
        Hello hi;
        hi.print();
        return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Introduction-18"><a href="#Introduction-18" class="headerlink" title="Introduction"></a>Introduction</h5><p>This example shows how to generate a <code>Linux</code> installers using the <code>ZIP</code> format.</p>
<p>The files in this tutorial are below:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb
$ tree
<span class="token builtin class-name">.</span>
├── cmake-examples.conf
├── CMakeLists.txt
├── include
│   └── Hello.h
└── src
    ├── Hello.cpp
    └── main.cpp

<span class="token number">2</span> directories, <span class="token number">5</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>CMakeLists.txt</code> - Contains the CMake commands you wish to run</p>
</li>
<li><p><code>cmake-examples.conf</code> - An example configuration file</p>
</li>
<li><p><code>include/Hello.h</code> - The header file to include</p>
</li>
<li><p><code>src/Hello.cpp</code> - A source file to compile</p>
</li>
<li><p><code>src/main.cpp</code> - The source file with main</p>
</li>
</ul>
<h5 id="Requirements-4"><a href="#Requirements-4" class="headerlink" title="Requirements"></a>Requirements</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman <span class="token parameter variable">-S</span> <span class="token function">zip</span>
pacman <span class="token parameter variable">-S</span> <span class="token function">unzip</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="Concepts-18"><a href="#Concepts-18" class="headerlink" title="Concepts"></a>Concepts</h5><h6 id="CPack-Generator"><a href="#CPack-Generator" class="headerlink" title="CPack Generator"></a>CPack Generator</h6><p>A CPack Generator can be used by a <code>make package</code> target to create an installer.</p>
<p>In the case of Debian packages you can tell CMake to create a generator using the following:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">set</span><span class="token punctuation">(</span>CPACK_GENERATOR <span class="token string">"DEB"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>After setting various settings to describe the package you must then tell <code>CMake</code> to include the <code>CPack generator</code> using</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">include</span><span class="token punctuation">(</span>CPack<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Once included all files that would typically be installed using a <code>make install</code> target can now be packaged into <code>a Debian package</code>.</p>
<h6 id="Debian-Package-Settings"><a href="#Debian-Package-Settings" class="headerlink" title="Debian Package Settings"></a>Debian Package Settings</h6><p>Various settings for the package are exposed by <code>CPack</code>. In this example we set the following:</p>
<pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token comment"># Set a Package Maintainer.</span>
<span class="token comment"># This is required</span>
<span class="token keyword">set</span><span class="token punctuation">(</span>CPACK_DEBIAN_PACKAGE_MAINTAINER <span class="token string">"Thom Troy"</span><span class="token punctuation">)</span>

<span class="token comment"># Set a Package Version</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CPACK_PACKAGE_VERSION</span> <span class="token punctuation">$&#123;</span><span class="token variable">deb_example_VERSION</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Which sets the maintainer and version. More debian specific settings are specified below.</p>
<table>
<thead>
<tr>
<th align="center">Variable</th>
<th align="center">Info</th>
</tr>
</thead>
<tbody><tr>
<td align="center">CPACK_DEBIAN_PACKAGE_MAINTAINER</td>
<td align="center">Maintainer information.</td>
</tr>
<tr>
<td align="center">CPACK_PACKAGE_DESCRIPTION_SUMMARY</td>
<td align="center">Package short description.</td>
</tr>
<tr>
<td align="center">CPACK_PACKAGE_DESCRIPTION</td>
<td align="center">Package description.</td>
</tr>
<tr>
<td align="center">CPACK_DEBIAN_PACKAGE_DEPENDS</td>
<td align="center">For advanced users to add custom scripts.</td>
</tr>
<tr>
<td align="center">CPACK_DEBIAN_PACKAGE_CONTROL_EXTRA</td>
<td align="center">The build directory you are currently in.</td>
</tr>
<tr>
<td align="center">CPACK_DEBIAN_PACKAGE_SECTION</td>
<td align="center">Package section (see <a href="http://packages.debian.org/stable/">here</a>).</td>
</tr>
<tr>
<td align="center">CPACK_DEBIAN_PACKAGE_VERSION</td>
<td align="center">Package version.</td>
</tr>
</tbody></table>
<h5 id="Building-the-Example-10"><a href="#Building-the-Example-10" class="headerlink" title="Building the Example"></a>Building the Example</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb
$ <span class="token function">mkdir</span> build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb
$ <span class="token builtin class-name">cd</span> build/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb/build
$ cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> <span class="token string">"MSYS Makefiles"</span>
-- The C compiler identification is GNU <span class="token number">12.1</span>.0
-- The CXX compiler identification is GNU <span class="token number">12.1</span>.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working C compiler: D:/lyf_computer_language/msys64/mingw64/bin/cc.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - <span class="token keyword">done</span>
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="token keyword">done</span>
-- Check <span class="token keyword">for</span> working CXX compiler: D:/lyf_computer_language/msys64/mingw64/bin/c++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - <span class="token keyword">done</span>
-- Configuring <span class="token keyword">done</span>
-- Generating <span class="token keyword">done</span>
-- Build files have been written to: F:/vscode/cpp_projects/cmake-examples/06-installer/deb/build

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb/build
$ <span class="token function">make</span> <span class="token builtin class-name">help</span>
The following are some of the valid targets <span class="token keyword">for</span> this Makefile:
<span class="token punctuation">..</span>. all <span class="token punctuation">(</span>the default <span class="token keyword">if</span> no target is provided<span class="token punctuation">)</span>
<span class="token punctuation">..</span>. clean
<span class="token punctuation">..</span>. depend
<span class="token punctuation">..</span>. edit_cache
<span class="token punctuation">..</span>. <span class="token function">install</span>
<span class="token punctuation">..</span>. install/local
<span class="token punctuation">..</span>. install/strip
<span class="token punctuation">..</span>. list_install_components
<span class="token punctuation">..</span>. package
<span class="token punctuation">..</span>. package_source
<span class="token punctuation">..</span>. rebuild_cache
<span class="token punctuation">..</span>. cmake_examples_zip
<span class="token punctuation">..</span>. cmake_examples_zip_bin
<span class="token punctuation">..</span>. src/Hello.obj
<span class="token punctuation">..</span>. src/Hello.i
<span class="token punctuation">..</span>. src/Hello.s
<span class="token punctuation">..</span>. src/main.obj
<span class="token punctuation">..</span>. src/main.i
<span class="token punctuation">..</span>. src/main.s

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb/build
$ <span class="token function">make</span> package
<span class="token punctuation">[</span> <span class="token number">25</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/cmake_examples_zip.dir/src/Hello.cpp.obj
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Linking CXX shared library libcmake_examples_zip.dll
<span class="token punctuation">[</span> <span class="token number">50</span>%<span class="token punctuation">]</span> Built target cmake_examples_zip
<span class="token punctuation">[</span> <span class="token number">75</span>%<span class="token punctuation">]</span> Building CXX object CMakeFiles/cmake_examples_zip_bin.dir/src/main.cpp.obj
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Linking CXX executable cmake_examples_zip_bin.exe
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target cmake_examples_zip_bin
Run CPack packaging tool<span class="token punctuation">..</span>.
CPack: Create package using ZIP
CPack: Install projects
CPack: - Run preinstall target for: cmake_examples_zip
CPack: - Install project: cmake_examples_zip <span class="token punctuation">[</span><span class="token punctuation">]</span>
CPack: Create package
CPack: - package: F:/vscode/cpp_projects/cmake-examples/06-installer/deb/build/cmake_examples_zip-0.2.2-win64.zip generated.

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb/build
$ <span class="token function">ls</span>
_CPack_Packages                     CPackConfig.cmake
cmake_examples_zip_bin.exe          CPackSourceConfig.cmake
cmake_examples_zip-0.2.2-win64.zip  install_manifest.txt
cmake_install.cmake                 libcmake_examples_zip.dll
CMakeCache.txt                      libcmake_examples_zip.dll.a
CMakeFiles                          Makefile

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb/build
$ <span class="token function">unzip</span> cmake_examples_zip-0.2.2-win64.zip
Archive:  cmake_examples_zip-0.2.2-win64.zip
   creating: cmake_examples_zip-0.2.2-win64/bin/
  inflating: cmake_examples_zip-0.2.2-win64/bin/cmake_examples_zip_bin.exe
  inflating: cmake_examples_zip-0.2.2-win64/bin/libcmake_examples_zip.dll
   creating: cmake_examples_zip-0.2.2-win64/etc/
  inflating: cmake_examples_zip-0.2.2-win64/etc/cmake-examples.conf
   creating: cmake_examples_zip-0.2.2-win64/lib/
  inflating: cmake_examples_zip-0.2.2-win64/lib/libcmake_examples_zip.dll.a

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb/build
$ <span class="token function">ls</span>
_CPack_Packages                     CPackConfig.cmake
cmake_examples_zip_bin.exe          CPackSourceConfig.cmake
cmake_examples_zip-0.2.2-win64      install_manifest.txt
cmake_examples_zip-0.2.2-win64.zip  libcmake_examples_zip.dll
cmake_install.cmake                 libcmake_examples_zip.dll.a
CMakeCache.txt                      Makefile
CMakeFiles

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb/build
$ <span class="token builtin class-name">cd</span> cmake_examples_zip-0.2.2-win64/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb/build/cmake_examples_zip-0.2.2-win64
$ <span class="token function">ls</span>
bin  etc  lib

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb/build/cmake_examples_zip-0.2.2-win64
$ <span class="token builtin class-name">cd</span> bin/

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb/build/cmake_examples_zip-0.2.2-win64/bin
$ <span class="token function">ls</span>
cmake_examples_zip_bin.exe  libcmake_examples_zip.dll

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb/build/cmake_examples_zip-0.2.2-win64/bin
$ ./cmake_examples_zip_bin.exe
Hello Install<span class="token operator">!</span>

lyf@DESKTOP-GV2QHKN MINGW64 /f/vscode/cpp_projects/cmake-examples/06-installer/deb/build/cmake_examples_zip-0.2.2-win64/bin
$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>第二十二篇博文写完，开心！！！！</p>
<p>今天，也是充满希望的一天。</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">LuYF-Lemon-love</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://luyf-lemon-love.space/2022/08/05/00022-cmake-examples-xue-xi-bi-ji/">https://luyf-lemon-love.space/2022/08/05/00022-cmake-examples-xue-xi-bi-ji/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">LuYF-Lemon-love</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/C/">
                                    <span class="chip bg-color">C++</span>
                                </a>
                            
                                <a href="/tags/make/">
                                    <span class="chip bg-color">make</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">谢谢小主！</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="https://cos.luyf-lemon-love.space/images/20220511162303.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="https://cos.luyf-lemon-love.space/images/20220511162220.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/08/16/00023-xian-dai-c-jiao-cheng-xue-xi-bi-ji-yi/">
                    <div class="card-image">
                        
                        <img src="https://cos.luyf-lemon-love.space/images/shadow_ruination_03.jpg" class="responsive-img" alt="00023-现代 C++ 教程学习笔记（一）">
                        
                        <span class="card-title">00023-现代 C++ 教程学习笔记（一）</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-08-16
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/C/" class="post-category">
                                    C++
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/C/">
                        <span class="chip bg-color">C++</span>
                    </a>
                    
                    <a href="/tags/make/">
                        <span class="chip bg-color">make</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/08/02/00021-msys2-jiao-cheng/">
                    <div class="card-image">
                        
                        <img src="https://cos.luyf-lemon-love.space/images/下载 (1).png" class="responsive-img" alt="00021-MSYS2 教程">
                        
                        <span class="card-title">00021-MSYS2 教程</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-08-02
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" class="post-category">
                                    计算机基础
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/C/">
                        <span class="chip bg-color">C++</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
    });
</script>



    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022-2025</span>
            
            <a href="/about" target="_blank">LuYF-Lemon-love</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2022";
                        var startMonth = "5";
                        var startDate = "7";
                        var startHour = "4";
                        var startMinute = "53";
                        var startSecond = "32";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
                <span id="icp"><img src="/medias/icp.png"
                                    style="vertical-align: text-bottom;"/>
                <a href="https://beian.miit.gov.cn" target="_blank">冀ICP备2022012632号-1</a>
            </span>
            
            <br>
            
                <span id="gongan"><img src="https://cos.luyf-lemon-love.space/images/备案图标.png"
                                    style="vertical-align: text-bottom;"/>
                <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=32011502011618" target="_blank">苏公网安备 32011502011618号</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/yanfeng98" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:luyanfeng_nlp@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/star.js"><\/script>');
            }
        </script>
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
